/*
 * Wallaby.js - v1.0.444
 * http://wallabyjs.com
 * Copyright (c) 2014-2017 Wallaby.js - All Rights Reserved.
 *
 * This source code file is a part of Wallaby.js and is a proprietary (closed source) software.

 * IMPORTANT:
 * Wallaby.js is a tool made by software developers for software developers with passion and love for what we do.
 * Pirating the tool is not only illegal and just morally wrong,
 * it is also unfair to other fellow programmers who are using it legally,
 * and very harmful for the tool and its future.
 */
!function e(t,n,i){function s(r,o){if(!n[r]){if(!t[r]){var l="function"==typeof require&&require;if(!o&&l)return l(r,!0);if(a)return a(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[r]={exports:{}};t[r][0].call(u.exports,function(e){var n=t[r][1][e];return s(n?n:e)},u,u.exports,e,t,n,i)}return n[r].exports}for(var a="function"==typeof require&&require,r=0;r<i.length;r++)s(i[r]);return s}({1:[function(e,t,n){"use strict";t.exports=function(e){function t(e,t){var n=this.startNode(),i=!0,a={};for(n.properties=[],this.next();!this.eat(s.braceR);){if(i)i=!1;else if(this.expect(s.comma),this.afterTrailingComma(s.braceR))break;var r,o,l,c,u=this.startNode();if(this.options.ecmaVersion>=6){if(this.type===s.ellipsis){u=this.parseSpread(),u.type=e?"RestProperty":"SpreadProperty",n.properties.push(u);continue}u.method=!1,u.shorthand=!1,(e||t)&&(l=this.start,c=this.startLoc),e||(r=this.eat(s.star))}this.parsePropertyName(u),e||!(this.options.ecmaVersion>=8)||r||u.computed||"Identifier"!==u.key.type||"async"!==u.key.name||this.type===s.parenL||this.type===s.colon||this.canInsertSemicolon()?o=!1:(o=!0,this.parsePropertyName(u,t)),this.parsePropertyValue(u,e,r,o,l,c,t),this.checkPropClash(u,a),n.properties.push(this.finishNode(u,"Property"))}return this.finishNode(n,e?"ObjectPattern":"ObjectExpression")}function n(e,t){if(this.options.ecmaVersion>=6&&e)switch(e.type){case"AssignmentPattern":break;case"Property":this.toAssignable(e.value,t);break;case"SpreadProperty":e.type="RestProperty";break;case"ObjectExpression":e.type="ObjectPattern";for(var n=0;n<e.properties.length;n++){var i=e.properties[n];"SpreadProperty"!==i.type&&("init"!==i.kind&&this.raise(i.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(i.value,t))}break;default:o.call(this,e,t)}return e}function i(e,t,n){switch(e.type){case"ObjectPattern":for(var i=0;i<e.properties.length;i++){var s=e.properties[i];"Property"===s.type&&(s=s.value),"SpreadProperty"!==s.type&&this.checkLVal(s,t,n)}break;case"RestProperty":this.checkLVal(e.argument,t,n);break;default:r.call(this,e,t,n)}}var s=e.tokTypes,a=e.Parser.prototype,r=a.checkLVal,o=a.toAssignable;return e.plugins.objectSpread=function(e){a.checkLVal=i,a.parseObj=t,a.toAssignable=n},e}},{}],2:[function(e,t,n){e("./global"),process.on("uncaughtException",function(t){if(!(t&&"spawn"===t.syscall&&"OK"===t.code||(t&&t.message&&_.isString(t.message)&&0===t.message.indexOf("payload cannot exceed")&&(t.stack="One of the files specified in your `files`/`tests` list is too large, "+t.stack),t&&t.message&&_.isString(t.message)&&~t.message.indexOf("EADDRINUSE")&&~t.message.indexOf("51245")))){try{if(t instanceof Error){var n=e("path").dirname(process.mainModule.filename);t.stack=_.filter(t.stack.split("\n"),function(e,t){return!t||!_.contains(e,n)}).join("\n")}}catch(i){}console.error(t instanceof Error?t.stack:util.inspect(t))}}),t.exports={start:function(t){t.onConnected=function(n){t.Project=e("./project"),t.diffMatchPatch=new(e("./diffMatchPatch"));var i=new t.Receiver(t),s=process.exit,a=function(){i.stop(),console.log("wallaby.js stopped"),s.apply(process,arguments)},r=process.exit=function(){a.apply(null,arguments)};return process.on("SIGINT",function(){r.apply(null,arguments)}),i.on("message",function(e){!e._internal&&n.send(e)}),n.receive=function(e){var t="unknown";try{if(t=e.type,!("string"==typeof t&&t.length>0&&"_"!==t[0]))throw new Error("Incorrect incoming message format");var n=i[t](e);n&&n.fail&&n.fail(function(e){e.noDetails?console.error(e.message):console.error("Failed to execute "+t+" operation, "+e.stack)})}catch(s){console.error("Failed to start "+t+" operation, "+s.stack)}},i.configure(),i}}}},{"./diffMatchPatch":7,"./global":10,"./project":18,path:void 0}],3:[function(e,t,n){"use strict";var i,s,a=function(){function e(e,t){for(var n in t){var i=t[n];i.configurable=!0,i.value&&(i.writable=!0)}Object.defineProperties(e,t)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=e("path"),l=e("semver"),c="5.0.9",u=function(){function e(t,n,i){r(this,e);var a=this;_.isEmpty(t)||t.babelrc||(t.babelrc=!1),this._opts=_.extend({filename:n},t||{}),!this._opts.filename&&n&&(this._opts.filename=n),this._opts.filenameRelative||delete this._opts.filenameRelative,this._opts.sourceMaps=this._opts.sourceMap=!0,this._opts.retainLines=this._opts.retainLines||!1,this._opts.compact=this._opts.compact||!1,this._opts.comments=this._opts.comments!==!1,_.isString(this._opts.plugins)&&(this._opts.plugins=[this._opts.plugins]),this._opts.plugins=(this._opts.plugins||[]).slice(),this._opts.plugins.unshift(new s("wallaby.js",{Statement:function(e){switch(e.type){case"DoWhileStatement":case"WhileStatement":case"IfStatement":case"ForStatement":e.test&&a._pushRange(e.test.loc);break;case"ForOfStatement":case"ForInStatement":e.right&&a._pushRange(e.right.loc);break;case"SwitchStatement":a._pushRange(e.discriminant.loc);break;case"BreakStatement":case"ContinueStatement":case"ThrowStatement":case"VariableDeclaration":case"ExpressionStatement":case"ReturnStatement":a._pushRange(e.loc)}},ArrowFunctionExpression:function(e){e.expression&&a._pushRange(e.body.loc)},LogicalExpression:function(e){a._pushRange(e.left.loc),a._pushRange(e.right.loc)},ConditionalExpression:function(e){a._pushRange(e.consequent.loc),a._pushRange(e.alternate.loc)}})),i&&(this._opts.presets=(this._opts.presets||[]).slice(),this._opts.presets.push(i))}return a(e,{_pushRange:{value:function(e){e&&this._ranges.push([e.start.line,e.start.column,e.end.line,e.end.column])}},run:{value:function(e){this._ranges=[];var t=i.transform(e.content,this._opts);return{map:t.map,code:t.code,ranges:this._ranges}}}}),e}();t.exports=function(t){return function(n){if(n=n||{},process.env.BABEL_ENV||(process.env.BABEL_ENV="test"),n.babel)i=n.babel;else try{i=e(o.join(t,"node_modules","babel-core"))}catch(a){try{i=e(o.join(t,"node_modules","babel"))}catch(r){throw new Error("babel or babel-core must be installed locally"+(process.env.quokka?"":" or babel instance must be passed in opts.babel, for example `wallaby.compilers.babel({ babel: require('babel') })`"))}}return l.valid(i.version)&&l.lt(i.version,c)?void console.error("Babel version for compiler must be >= "+c):(s=i.Transformer||function(e,t){return _.each(t,function(e,n){t[n]=function(t){return e(t.node)}}),{visitor:{Program:function(e){e.traverse(t)}}}},delete n.babel,function(e){var t=e.additionalPreset;return delete e.additionalPreset,new u(n,e.path,t).run(e)})}}},{path:void 0,semver:void 0}],4:[function(e,t,n){var i,s=e("path"),a=e("graceful-fs"),r=e("express"),o=a.readFileSync(s.join(__dirname,"runners","browser","sandbox.html")).toString(),l="__wallaby__",c=e("./fileCacheMiddleware"),u=function(t,n){var a=this;i=e("debug")("wallaby:browserRunner"),a._project=t,a._workerPool=n,a._baseDir=a._project._instrumentedRoot+s.sep,a._initializer=t.settings().bootstrap,a._reportUnhandledPromises=!!t.settings().reportUnhandledPromises,a._sandboxHtml={},a._report404AsError=t.settings().env.report404AsError,a._lruCache=a._project._lruCache,a._wallabyFileIdPrefix=a._workerPool.wallabyFileIdPrefix(),a._app=r(),a._app.use("/wallaby_sandbox:id.html",function(e,t){t.send(a._sandboxHtml[e.params.id])}),t.settings().testFramework.path&&a._app.use("/"+l+"/"+t.settings().testFramework.version+"/framework.js",c.create(s.join(t._localRoot,t.settings().testFramework.path))),a._app.use("/"+l+"/tracer.js",c.create(s.join(__dirname,"tracer.js"))),a._app.use("/"+l,c.create(s.join(__dirname,"runners","browser"))),t.settings().middleware(a._app,r),a._app.use(c.create(a._baseDir,a._lruCache,a._report404AsError))};u.prototype={prepareSandbox:function(e,t,n){var s=this;e.allFilesHash=_.reduce(e.allFiles.concat(e.allTestFiles),function(e,t){return e[t.normalizedRelativePath]={ts:t.ts,id:t.tmp&&t.originalId?t.originalId:t.id},e},{});var a=e.allFiles.concat(e.allTestFiles),r=e.filesToLoad.concat(e.testFilesToLoad),c=_.reduce(e.testFilesToLoad,function(e,t){return e[t.id]=t,e},{});i("Total files to load in sandbox: "+r.length);var u=s._workerPool.receiverPort();s._sandboxHtml[n]=o.replace("<inject/>",function(){return _.reduce(a,function(e,t){return e+(_.isNumber(t.id)?"file = window.$_$coverage["+t.id+"]=[]; for(i=0, len="+t.rangesLength+"; i < len; i++) file[i] = {};":"")},"<script>(function() {window.$_$receiverPort = "+u+';window.$_$session="'+t+'";window.$_$baseDir='+JSON.stringify(s._baseDir)+";window.$_$initialSpecId="+1e5*(n+1)+";window.$_$reportUnhanledPromises="+s._reportUnhandledPromises+";window.$_$coverage=[]; var file, i, len;")+"window.$_$slow="+s._project.settings().slowTestThreshold+";window.$_$files="+JSON.stringify(e.allFilesHash)+";window.$_$tests="+(e.tests?JSON.stringify(e.tests):"null")+";window.$_$testFiles="+JSON.stringify(_.chain(e.allTestFiles).filter(function(e){return!e.shadowed}).map(function(t){return{path:t.relativePath,loaded:t.include&&!!c[t.id],id:(e.allFilesHash[t.normalizedRelativePath]||{}).id}}).value())+';})();</script><script src="'+l+'/tracer.js"></script><script src="'+l+"/"+e.framework.version+'/framework.js"></script><script src="'+l+"/"+e.framework.configurator+'/configurator.js"></script><script src="'+l+"/"+e.framework.reporter+'/reporter.js"></script>'+_.reduce(r,function(e,t){var n=t.tmp,a=t.ts+(n?t.originalId?s._wallabyFileIdPrefix+t.originalId:"":s._wallabyFileIdPrefix+t.id);switch(t.type){case"js":case"jsx":case"es6":return e+'<script src="'+t.normalizedRelativePath+"?"+a+'"></script>';case"html":case"htm":return e+'<link href="'+t.normalizedRelativePath+"?"+t.ts+'" rel="import">';case"css":return e+'<link rel="stylesheet" type="text/css" href="'+t.normalizedRelativePath+"?"+a+'"></link>';default:return i("File type "+t.type+" can not be included via script/link tag into sandbox"),e}},"")+(s._initializer?"<script>("+s._initializer+")(window.wallaby);</script>":"")+'<script src="'+l+"/"+e.framework.starter+'/starter.js"></script>'});var h=s.sandboxRootUrl()+"wallaby_sandbox"+n+".html";return i("Sandbox is generated [%s]: %s",s.sandboxName(n,t),h),Q.when(h)},sandboxRootUrl:function(){return this._sandboxRootUrl?this._sandboxRootUrl:(this._sandboxRootUrl="http://localhost:"+this._workerPool.receiverPort()+"/",this._sandboxRootUrl)},webApp:function(){return this._app},sandboxName:function(e,t){return"worker #"+e+", session #"+t}},t.exports=u},{"./fileCacheMiddleware":9,debug:void 0,express:void 0,"graceful-fs":void 0,path:void 0}],5:[function(e,t,n){"use strict";var i,s,a,r=function(){function e(e,t){for(var n in t){var i=t[n];i.configurable=!0,i.value&&(i.writable=!0)}Object.defineProperties(e,t)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},l=e("path"),c={},u={},h=function(){function e(t){o(this,e);var n=this;this._opts=_.extend({},t||{}),this._noRename=this._opts.noFileRename,delete this._opts.noFileRename,this._nodeVisitor("Block",function(e){_.each(e.expressions,function(e){e.expression?n._pushRange(e.expression):n._pushRange(e)})}),this._nodeVisitor("Op",function(e){("&&"===e.operator||"||"===e.operator||"?"===e.operator)&&(n._pushRange(e.first),n._pushRange(e.second))})}return r(e,{_nodeVisitor:{value:function(e,t){if(u[e]=t,!c[e]){var n=i[e].prototype.compileNode;i[e].prototype.compileNode=function(){return u[e](this),n.apply(this,arguments)},c[e]=!0}}},_pushRange:{value:function(e){if(e){var t=e.locationData;t?this._ranges.push([t.first_line+1,t.first_column,t.last_line+1,t.last_column+1]):e.args&&e.args.length&&this._pushRange(e.args[0])}}},run:{value:function(e){this._ranges=[];var t=s.compile(e.content,_.extend({},this._opts,{filename:e.path,sourceMap:!0,literate:a.isLiterate(e.path)}));return this._noRename||e.changeExt("js"),{map:t.v3SourceMap,code:t.js,ranges:this._ranges}}}}),e}();t.exports=function(t){try{i=e(l.join(t,"node_modules","coffee-script","lib","coffee-script","nodes")),s=e(l.join(t,"node_modules","coffee-script"))}catch(n){i=e("coffee-script/lib/coffee-script/nodes"),s=e("coffee-script")}return a=s.helpers,function(e){return function(t){return new h(e).run(t)}}}},{"coffee-script":void 0,"coffee-script/lib/coffee-script/nodes":void 0,path:void 0}],6:[function(e,t,n){"use strict";var i,s=function(){function e(e,t){for(var n in t){var i=t[n];i.configurable=!0,i.value&&(i.writable=!0)}Object.defineProperties(e,t)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=e("path"),o={node:{"mocha@2.1.0":{},"jest@0.4.3":{},"jasmine@2.3.4":{},"ava@0.3.0":{jsPreprocessor:function(e){return e.replace(/import test from ["|']ava["|']/,'var test = require("ava")')}},"tape@4.2.2":{jsPreprocessor:function(e){return e.replace(/import test from ["|']tape["|']/,'var test = require("tape")')}}},browser:{"jasmine@1.3.1":{},"jasmine@2.1.3":{},"jasmine@2.2.1":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.3.4":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.4.1":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.5.1":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.5.2":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.6.3":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"mocha@2.0.1":{},"mocha@2.2.4":{configurator:"mocha@2.0.1",reporter:"mocha@2.0.1",starter:"mocha@2.0.1"},"mocha@3.2.0":{configurator:"mocha@2.0.1",reporter:"mocha@2.0.1",starter:"mocha@2.0.1"},"qunit@1.16.0":{},"qunit@1.18.0":{configurator:"qunit@1.16.0",reporter:"qunit@1.16.0",starter:"qunit@1.16.0"}}},l={typeScript:"**/*.ts?(x)",coffeeScript:"**/*.?(lit)coffee?(.md)"},c={files:{ignore:!1,instrument:!0,trigger:!0,load:!0},tests:{ignore:!1,instrument:!0,trigger:!0,load:!0}},u=function(){function t(n,i){a(this,t);var s=r.dirname(n);this._configFile=n,this._root=i,this._builtinCompilers={coffeeScript:e("./coffeeScriptCompiler")(s),babel:e("./babelCompiler")(s),typeScript:function(t){return t&&t.forceFileLevelCompiler?e("./typeScriptCompiler")(t):{replaceWithPostprocessor:!0,localProjectDir:s,opts:t}}},this._builtinPostprocessors={typeScript:e("./typeScriptPostprocessor")(s)}}return s(t,{load:{value:function(){var t=this,n=this;if(n._settings)return Q.when(n._settings);var i={localProjectDir:r.dirname(n._configFile)+r.sep,projectCacheDir:n._root,compilers:n._builtinCompilers,postprocessors:n._builtinPostprocessors,defaults:{files:_.extend({},c.files),tests:_.extend({},c.tests)}};return Q.promise(function(t,s){try{var a=e(n._configFile);a&&a.__esModule&&a["default"]&&(a=a["default"]),_.isFunction(a)?2===a.length?a(i,function(e){return t(e)}):t(a(i)):t(a)}catch(r){s(r)}}).then(function(s){if(n._settings=s,!_.isArray(s.files)||!s.files.length)throw new Error("Files property must be non-empty array of files/file patterns");if(!_.isArray(s.tests)||!s.tests.length)throw new Error("Tests property must be non-empty array of test files/file patterns");if(s.filesWithNoCoverageCalculated=s.filesWithNoCoverageCalculated||[],s.runAllTestsInAffectedTestFile=s.runAllTestsInAffectedTestFile||!1,s.compilers=s.compilers||{},!_.isObject(s.compilers))throw new Error("If defined, compilers property must be an object.");if(s.compilers[l.coffeeScript]||(s.compilers[l.coffeeScript]=n._builtinCompilers.coffeeScript()),s.compilers[l.typeScript]||(s.compilers[l.typeScript]=n._builtinCompilers.typeScript()),s.preprocessors=s.preprocessors||{},!_.isObject(s.preprocessors))throw new Error("If defined, preprocessors property must be an object.");if(s.postprocessor&&!_.isFunction(s.postprocessor))throw new Error("Postprocessor must be a function if set");if(n._adjustTypeScriptCompilers(s),_.isFunction(s.middleware)||(s.middleware=_.noop),s.maxConsoleMessagesPerTest=s.maxConsoleMessagesPerTest||100,s.reportUnhandledPromises=s.reportUnhandledPromises!==!1,s.telemetry=s.telemetry!==!1,s.autoConsoleLog=s.autoConsoleLog!==!1,s.delays=s.delays||{},s.delays.edit=s.delays.edit||100,s.delays.update=s.delays.update||0,s.delays.run=s.delays.run||0,s.workers=s.workers||{},s.workers.initial=s.workers.initial||0,s.workers.regular=s.workers.regular||0,s.workers.recycle=!!s.workers.recycle,s.bootstrap&&s.setup)throw new Error("The `setup` and `bootstrap` functions are alias of the same setting, so only one of them is allowed in the config.");var a=s.bootstrap||s.setup;if(s.bootstrap=a&&a.toString(),delete s.setup,s.teardown=s.teardown&&s.teardown.toString(),n._normalizeFunction(s,"bootstrap"),n._normalizeFunction(s,"teardown"),s.hints=s.hints||{},s.hints.ignoreCoverage=t._serializeHintRegExp(s.hints.ignoreCoverage||""),s.hints.commentAutoLog="?",s.extesnions=s.extesnions||{},s.env=s.env||{type:"browser",kind:"phantomjs"},!_.isObject(s.env))throw new Error("Environment is not specified correctly");if(s.env.type=s.env.type||"browser",s.env.params=s.env.params||{},"browser"===s.env.type&&(s.env.kind=s.env.kind||"phantomjs"),s.env.kind&&"phantomjs"!==s.env.kind&&"electron"!==s.env.kind)throw new Error('Specified browser environment kind "'+s.env.kind+'" is not supported');if("node"!==s.env.type||s.env.runner||(s.env.runner=process.execPath),"electron"===s.env.kind&&!s.env.runner)try{try{s.env.runner=e(r.join(i.localProjectDir,"node_modules","electron"))}catch(o){s.env.runner=e(r.join(i.localProjectDir,"node_modules","electron-prebuilt"))}}catch(u){throw new Error("Electron runner path is not specified and `electron` module was not found.\nEither specify a path in `env.runner` or install the electron module by running `npm install electron --save-dev`")}return s.env.viewportSize=_.extend({width:800,height:600},s.env.viewportSize||{}),s.env.options=_.extend({},s.env.viewportSize,s.env.options||{}),s.env.bundle!==!1&&(s.env.bundle=!0),s.testFramework=s.testFramework||("browser"===s.env.type?"jasmine@2.6.3":"mocha@2.1.0"),s.testFramework=n._normalizeTestFramework(s),s.files=_.map(s.files,n._normalizeFileObject.bind(n,i.defaults&&i.defaults.files||_.extend({},c.files))),s.tests=_.map(s.tests,n._normalizeFileObject.bind(n,i.defaults&&i.defaults.tests||_.extend({},c.tests))),s.slowTestThreshold=s.slowTestThreshold||75,s.lowCoverageThreshold=s.lowCoverageThreshold||80,0!==s.testFramework.version.indexOf("jest")||_.find(s.files,function(e){return e&&"package.json"===e.pattern})||s.files.push(n._normalizeFileObject({ignore:!1,instrument:!1,trigger:!0,load:!0},"package.json")),Q.when(s)})}},_serializeHintRegExp:{value:function(e){if(_.isRegExp(e))return"__REGEXP "+e.toString();if(_.isString(e))return e;throw new Error("Hints must be strings or regular expressions")}},_normalizeFunction:{value:function(e,t){if(e[t]&&0!==e[t].indexOf("function")){e[t]="function "+e[t];var n=e[t].split("\n")[0],i=n.indexOf("=>"),s=n.indexOf("{");if(i>0&&(-1===s||s>i)&&(e[t]=e[t].replace("=>","{")+"}"),i>0&&n.indexOf("(")<0){n=e[t].split("\n")[0];var a=n.indexOf("{"),r=n.substring("function ".length,a);e[t]=e[t].replace(r,"("+r+")")}}}},_normalizeTestFramework:{value:function(e){var t=this,n=o[e.env.type];if(!n)throw new Error("Environment ["+e.env.type+"] is not supported");var i=t._resolveTestFrameworkVersion(e,n),s=_.extend({version:i,configurator:i,reporter:i,starter:i},n[i]);return e.testFramework.path&&(s.path=e.testFramework.path),s}},_resolveTestFrameworkVersion:{value:function(e,t){var n=_.isString(e.testFramework)?e.testFramework:e.testFramework.type;if(~n.indexOf("@")){if(!t[n])throw new Error("Test framework ["+n+"] is not supported");return n}var i=function(){var e={};_.each(t,function(t,n){var i=n.substr(0,n.indexOf("@"));e[i]=n});var i=e[n];if(!i)throw new Error("Test framework ["+n+"] is not supported");return{v:i}}();return"object"==typeof i?i.v:void 0}},_adjustTypeScriptCompilers:{value:function(e){var t=!!e.postprocessor,n={files:{}};if(_.each(e.compilers,function(i,s){i&&i.replaceWithPostprocessor&&(delete e.compilers[s],t&&(i.opts=i.opts||{}),n.files[s]=i.opts,i.opts&&i.opts.typescript&&(n.typescript=i.opts.typescript,delete i.opts.typescript))}),!_.isEmpty(n.files)){var i=this._builtinPostprocessors.typeScript(n);t?e.postprocessor=[i,e.postprocessor]:e.postprocessor=i}}},_normalizeFileObject:{value:function(e,t){if(_.isString(t))t={pattern:t};else if(!t.pattern)throw new Error("File/test entry must either be a string or an object that contains pattern property");var n=_.defaults(t,e);return"!"===n.pattern[0]&&(n.ignore=!n.ignore,n.pattern=n.pattern.substring(1)),"/"===n.pattern[0]&&(n.pattern=n.pattern.substring(1)),"."===n.pattern[0]&&"/"===n.pattern[1]&&(n.pattern=n.pattern.substring(2)),n}}}),t}();t.exports=function(e,t,n){return i&&!n?i.load():(i=new u(e,t),i.load())}},{"./babelCompiler":3,"./coffeeScriptCompiler":5,"./typeScriptCompiler":23,"./typeScriptPostprocessor":24,path:void 0}],7:[function(e,t,n){function i(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}var s=-1,a=1,r=0;i.Diff,i.prototype.diff_main=function(e,t,n,i){"undefined"==typeof i&&(i=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var s=i;if(null==e||null==t)throw new Error("Null input. (diff_main)");if(e==t)return e?[[r,e]]:[];"undefined"==typeof n&&(n=!0);var a=n,o=this.diff_commonPrefix(e,t),l=e.substring(0,o);e=e.substring(o),t=t.substring(o),o=this.diff_commonSuffix(e,t);var c=e.substring(e.length-o);e=e.substring(0,e.length-o),t=t.substring(0,t.length-o);var u=this.diff_compute_(e,t,a,s);return l&&u.unshift([r,l]),c&&u.push([r,c]),this.diff_cleanupMerge(u),u},i.prototype.diff_compute_=function(e,t,n,i){var o;if(!e)return[[a,t]];if(!t)return[[s,e]];var l=e.length>t.length?e:t,c=e.length>t.length?t:e,u=l.indexOf(c);if(-1!=u)return o=[[a,l.substring(0,u)],[r,c],[a,l.substring(u+c.length)]],e.length>t.length&&(o[0][0]=o[2][0]=s),o;if(1==c.length)return[[s,e],[a,t]];var h=this.diff_halfMatch_(e,t);if(h){var d=h[0],f=h[1],_=h[2],v=h[3],p=h[4],g=this.diff_main(d,_,n,i),m=this.diff_main(f,v,n,i);return g.concat([[r,p]],m)}return n&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,i):this.diff_bisect_(e,t,i)},i.prototype.diff_lineMode_=function(e,t,n){var i=this.diff_linesToChars_(e,t);e=i.chars1,t=i.chars2;var o=i.lineArray,l=this.diff_main(e,t,!1,n);this.diff_charsToLines_(l,o),this.diff_cleanupSemantic(l),l.push([r,""]);for(var c=0,u=0,h=0,d="",f="";c<l.length;){switch(l[c][0]){case a:h++,f+=l[c][1];break;case s:u++,d+=l[c][1];break;case r:if(u>=1&&h>=1){l.splice(c-u-h,u+h),c=c-u-h;for(var i=this.diff_main(d,f,!1,n),_=i.length-1;_>=0;_--)l.splice(c,0,i[_]);c+=i.length}h=0,u=0,d="",f=""}c++}return l.pop(),l},i.prototype.diff_bisect_=function(e,t,n){for(var i=e.length,r=t.length,o=Math.ceil((i+r)/2),l=o,c=2*o,u=new Array(c),h=new Array(c),d=0;c>d;d++)u[d]=-1,h[d]=-1;u[l+1]=0,h[l+1]=0;for(var f=i-r,_=f%2!=0,v=0,p=0,g=0,m=0,y=0;o>y&&!((new Date).getTime()>n);y++){for(var T=-y+v;y-p>=T;T+=2){var b,R=l+T;b=T==-y||T!=y&&u[R-1]<u[R+1]?u[R+1]:u[R-1]+1;for(var V=b-T;i>b&&r>V&&e.charAt(b)==t.charAt(V);)b++,V++;if(u[R]=b,b>i)p+=2;else if(V>r)v+=2;else if(_){var F=l+f-T;if(F>=0&&c>F&&-1!=h[F]){var k=i-h[F];if(b>=k)return this.diff_bisectSplit_(e,t,b,V,n)}}}for(var N=-y+g;y-m>=N;N+=2){var k,F=l+N;k=N==-y||N!=y&&h[F-1]<h[F+1]?h[F+1]:h[F-1]+1;for(var j=k-N;i>k&&r>j&&e.charAt(i-k-1)==t.charAt(r-j-1);)k++,j++;if(h[F]=k,k>i)m+=2;else if(j>r)g+=2;else if(!_){var R=l+f-N;if(R>=0&&c>R&&-1!=u[R]){var b=u[R],V=l+b-R;if(k=i-k,b>=k)return this.diff_bisectSplit_(e,t,b,V,n)}}}}return[[s,e],[a,t]]},i.prototype.diff_bisectSplit_=function(e,t,n,i,s){var a=e.substring(0,n),r=t.substring(0,i),o=e.substring(n),l=t.substring(i),c=this.diff_main(a,r,!1,s),u=this.diff_main(o,l,!1,s);return c.concat(u)},i.prototype.diff_linesToChars_=function(e,t){function n(e){for(var t="",n=0,a=-1,r=i.length;a<e.length-1;){a=e.indexOf("\n",n),-1==a&&(a=e.length-1);var o=e.substring(n,a+1);n=a+1,(s.hasOwnProperty?s.hasOwnProperty(o):void 0!==s[o])?t+=String.fromCharCode(s[o]):(t+=String.fromCharCode(r),s[o]=r,i[r++]=o)}return t}var i=[],s={};i[0]="";var a=n(e),r=n(t);return{chars1:a,chars2:r,lineArray:i}},i.prototype.diff_wordMode=function(e,t){var n=this.diff_linesToWords_(e,t),i=n.chars1,s=n.chars2,a=n.lineArray,r=this.diff_main(i,s,!1);return this.diff_charsToLines_(r,a),r},i.prototype.diff_linesToWords_=function(e,t){function n(e){for(var t=e.split(/(\s+|\b)/),n=0;n<t.length-1;n++)!t[n+1]&&t[n+2]&&r.test(t[n])&&r.test(t[n+2])&&(t[n]+=t[n+2],t.splice(n+1,2),n--);return t}function i(e){for(var t="",i=n(e),r=s.length,o=0,l=i.length;l>o;o++){var c=i[o];(a.hasOwnProperty?a.hasOwnProperty(c):void 0!==a[c])?t+=String.fromCharCode(a[c]):(t+=String.fromCharCode(r),a[c]=r,s[r++]=c)}return t}var s=[],a={};s[0]="";var r=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,o=i(e),l=i(t);return{chars1:o,chars2:l,lineArray:s}},i.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var i=e[n][1],s=[],a=0;a<i.length;a++)s[a]=t[i.charCodeAt(a)];e[n][1]=s.join("")}},i.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,i=Math.min(e.length,t.length),s=i,a=0;s>n;)e.substring(a,s)==t.substring(a,s)?(n=s,a=n):i=s,s=Math.floor((i-n)/2+n);return s},i.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,i=Math.min(e.length,t.length),s=i,a=0;s>n;)e.substring(e.length-s,e.length-a)==t.substring(t.length-s,t.length-a)?(n=s,a=n):i=s,s=Math.floor((i-n)/2+n);return s},i.prototype.diff_commonOverlap_=function(e,t){var n=e.length,i=t.length;if(0==n||0==i)return 0;n>i?e=e.substring(n-i):i>n&&(t=t.substring(0,n));var s=Math.min(n,i);if(e==t)return s;for(var a=0,r=1;;){var o=e.substring(s-r),l=t.indexOf(o);if(-1==l)return a;r+=l,(0==l||e.substring(s-r)==t.substring(0,r))&&(a=r,r++)}},i.prototype.diff_halfMatch_=function(e,t){function n(e,t,n){for(var i,s,a,o,l=e.substring(n,n+Math.floor(e.length/4)),c=-1,u="";-1!=(c=t.indexOf(l,c+1));){var h=r.diff_commonPrefix(e.substring(n),t.substring(c)),d=r.diff_commonSuffix(e.substring(0,n),t.substring(0,c));u.length<d+h&&(u=t.substring(c-d,c)+t.substring(c,c+h),i=e.substring(0,n-d),s=e.substring(n+h),a=t.substring(0,c-d),o=t.substring(c+h))}return 2*u.length>=e.length?[i,s,a,o,u]:null}if(this.Diff_Timeout<=0)return null;var i=e.length>t.length?e:t,s=e.length>t.length?t:e;if(i.length<4||2*s.length<i.length)return null;var a,r=this,o=n(i,s,Math.ceil(i.length/4)),l=n(i,s,Math.ceil(i.length/2));if(!o&&!l)return null;a=l?o&&o[4].length>l[4].length?o:l:o;var c,u,h,d;e.length>t.length?(c=a[0],u=a[1],h=a[2],d=a[3]):(h=a[0],d=a[1],c=a[2],u=a[3]);var f=a[4];return[c,u,h,d,f]},i.prototype.diff_cleanupSemantic=function(e){for(var t=!1,n=[],i=0,o=null,l=0,c=0,u=0,h=0,d=0;l<e.length;)e[l][0]==r?(n[i++]=l,c=h,u=d,h=0,d=0,o=e[l][1]):(e[l][0]==a?h+=e[l][1].length:d+=e[l][1].length,o&&o.length<=Math.max(c,u)&&o.length<=Math.max(h,d)&&(e.splice(n[i-1],0,[s,o]),e[n[i-1]+1][0]=a,i--,i--,l=i>0?n[i-1]:-1,c=0,u=0,h=0,d=0,o=null,t=!0)),l++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),l=1;l<e.length;){if(e[l-1][0]==s&&e[l][0]==a){var f=e[l-1][1],_=e[l][1],v=this.diff_commonOverlap_(f,_),p=this.diff_commonOverlap_(_,f);v>=p?(v>=f.length/2||v>=_.length/2)&&(e.splice(l,0,[r,_.substring(0,v)]),e[l-1][1]=f.substring(0,f.length-v),e[l+1][1]=_.substring(v),l++):(p>=f.length/2||p>=_.length/2)&&(e.splice(l,0,[r,f.substring(0,p)]),e[l-1][0]=a,e[l-1][1]=_.substring(0,_.length-p),e[l+1][0]=s,e[l+1][1]=f.substring(p),l++),l++}l++}},i.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var n=e.charAt(e.length-1),s=t.charAt(0),a=n.match(i.nonAlphaNumericRegex_),r=s.match(i.nonAlphaNumericRegex_),o=a&&n.match(i.whitespaceRegex_),l=r&&s.match(i.whitespaceRegex_),c=o&&n.match(i.linebreakRegex_),u=l&&s.match(i.linebreakRegex_),h=c&&e.match(i.blanklineEndRegex_),d=u&&t.match(i.blanklineStartRegex_);return h||d?5:c||u?4:a&&!o&&l?3:o||l?2:a||r?1:0}for(var n=1;n<e.length-1;){if(e[n-1][0]==r&&e[n+1][0]==r){var s=e[n-1][1],a=e[n][1],o=e[n+1][1],l=this.diff_commonSuffix(s,a);if(l){var c=a.substring(a.length-l);s=s.substring(0,s.length-l),a=c+a.substring(0,a.length-l),o=c+o}for(var u=s,h=a,d=o,f=t(s,a)+t(a,o);a.charAt(0)===o.charAt(0);){s+=a.charAt(0),a=a.substring(1)+o.charAt(0),o=o.substring(1);var _=t(s,a)+t(a,o);_>=f&&(f=_,u=s,h=a,d=o)}e[n-1][1]!=u&&(u?e[n-1][1]=u:(e.splice(n-1,1),n--),e[n][1]=h,d?e[n+1][1]=d:(e.splice(n+1,1),n--))}n++}},i.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,i.whitespaceRegex_=/\s/,i.linebreakRegex_=/[\r\n]/,i.blanklineEndRegex_=/\n\r?\n$/,i.blanklineStartRegex_=/^\r?\n\r?\n/,i.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,n=[],i=0,o=null,l=0,c=!1,u=!1,h=!1,d=!1;l<e.length;)e[l][0]==r?(e[l][1].length<this.Diff_EditCost&&(h||d)?(n[i++]=l,c=h,u=d,o=e[l][1]):(i=0,o=null),h=d=!1):(e[l][0]==s?d=!0:h=!0,o&&(c&&u&&h&&d||o.length<this.Diff_EditCost/2&&c+u+h+d==3)&&(e.splice(n[i-1],0,[s,o]),e[n[i-1]+1][0]=a,i--,o=null,c&&u?(h=d=!0,i=0):(i--,l=i>0?n[i-1]:-1,h=d=!1),t=!0)),l++;t&&this.diff_cleanupMerge(e)},i.prototype.diff_cleanupMerge=function(e){e.push([r,""]);for(var t,n=0,i=0,o=0,l="",c="";n<e.length;)switch(e[n][0]){case a:o++,c+=e[n][1],n++;break;case s:i++,l+=e[n][1],n++;break;case r:i+o>1?(0!==i&&0!==o&&(t=this.diff_commonPrefix(c,l),0!==t&&(n-i-o>0&&e[n-i-o-1][0]==r?e[n-i-o-1][1]+=c.substring(0,t):(e.splice(0,0,[r,c.substring(0,t)]),n++),c=c.substring(t),l=l.substring(t)),t=this.diff_commonSuffix(c,l),0!==t&&(e[n][1]=c.substring(c.length-t)+e[n][1],c=c.substring(0,c.length-t),l=l.substring(0,l.length-t))),0===i?e.splice(n-o,i+o,[a,c]):0===o?e.splice(n-i,i+o,[s,l]):e.splice(n-i-o,i+o,[s,l],[a,c]),n=n-i-o+(i?1:0)+(o?1:0)+1):0!==n&&e[n-1][0]==r?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,o=0,i=0,l="",c=""}""===e[e.length-1][1]&&e.pop();var u=!1;for(n=1;n<e.length-1;)e[n-1][0]==r&&e[n+1][0]==r&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)==e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),u=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),u=!0)),n++;u&&this.diff_cleanupMerge(e)},i.prototype.diff_xIndex=function(e,t){var n,i=0,r=0,o=0,l=0;for(n=0;n<e.length&&(e[n][0]!==a&&(i+=e[n][1].length),e[n][0]!==s&&(r+=e[n][1].length),!(i>t));n++)o=i,l=r;return e.length!=n&&e[n][0]===s?l:l+(t-o)},i.prototype.diff_prettyHtml=function(e){for(var t=[],n=/&/g,i=/</g,o=/>/g,l=/\n/g,c=0;c<e.length;c++){var u=e[c][0],h=e[c][1],d=h.replace(n,"&amp;").replace(i,"&lt;").replace(o,"&gt;").replace(l,"&para;<br>");switch(u){case a:t[c]='<ins style="background:#e6ffe6;">'+d+"</ins>";break;case s:t[c]='<del style="background:#ffe6e6;">'+d+"</del>";break;case r:t[c]="<span>"+d+"</span>"}}return t.join("")},i.prototype.diff_text1=function(e){for(var t=[],n=0;n<e.length;n++)e[n][0]!==a&&(t[n]=e[n][1]);return t.join("")},i.prototype.diff_text2=function(e){for(var t=[],n=0;n<e.length;n++)e[n][0]!==s&&(t[n]=e[n][1]);return t.join("")},i.prototype.diff_levenshtein=function(e){for(var t=0,n=0,i=0,o=0;o<e.length;o++){var l=e[o][0],c=e[o][1];switch(l){case a:n+=c.length;break;case s:i+=c.length;break;case r:t+=Math.max(n,i),n=0,i=0}}return t+=Math.max(n,i)},i.prototype.diff_toDelta=function(e){for(var t=[],n=0;n<e.length;n++)switch(e[n][0]){case a:t[n]="+"+encodeURI(e[n][1]);break;case s:t[n]="-"+e[n][1].length;break;case r:t[n]="="+e[n][1].length}return t.join("	").replace(/%20/g," ")},i.prototype.diff_fromDelta=function(e,t){for(var n=[],i=0,o=0,l=t.split(/\t/g),c=0;c<l.length;c++){
var u=l[c].substring(1);switch(l[c].charAt(0)){case"+":try{n[i++]=[a,decodeURI(u)]}catch(h){throw new Error("Illegal escape in diff_fromDelta: "+u)}break;case"-":case"=":var d=parseInt(u,10);if(isNaN(d)||0>d)throw new Error("Invalid number in diff_fromDelta: "+u);var f=e.substring(o,o+=d);"="==l[c].charAt(0)?n[i++]=[r,f]:n[i++]=[s,f];break;default:if(l[c])throw new Error("Invalid diff operation in diff_fromDelta: "+l[c])}}if(o!=e.length)throw new Error("Delta length ("+o+") does not equal source text length ("+e.length+").");return n},i.prototype.match_main=function(e,t,n){if(null==e||null==t||null==n)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,e.length)),e==t?0:e.length?e.substring(n,n+t.length)==t?n:this.match_bitap_(e,t,n):-1},i.prototype.match_bitap_=function(e,t,n){function i(e,i){var s=e/t.length,r=Math.abs(n-i);return a.Match_Distance?s+r/a.Match_Distance:r?1:s}if(t.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var s=this.match_alphabet_(t),a=this,r=this.Match_Threshold,o=e.indexOf(t,n);-1!=o&&(r=Math.min(i(0,o),r),o=e.lastIndexOf(t,n+t.length),-1!=o&&(r=Math.min(i(0,o),r)));var l=1<<t.length-1;o=-1;for(var c,u,h,d=t.length+e.length,f=0;f<t.length;f++){for(c=0,u=d;u>c;)i(f,n+u)<=r?c=u:d=u,u=Math.floor((d-c)/2+c);d=u;var _=Math.max(1,n-u+1),v=Math.min(n+u,e.length)+t.length,p=Array(v+2);p[v+1]=(1<<f)-1;for(var g=v;g>=_;g--){var m=s[e.charAt(g-1)];if(0===f?p[g]=(p[g+1]<<1|1)&m:p[g]=(p[g+1]<<1|1)&m|((h[g+1]|h[g])<<1|1)|h[g+1],p[g]&l){var y=i(f,g-1);if(r>=y){if(r=y,o=g-1,!(o>n))break;_=Math.max(1,2*n-o)}}}if(i(f+1,n)>r)break;h=p}return o},i.prototype.match_alphabet_=function(e){for(var t={},n=0;n<e.length;n++)t[e.charAt(n)]=0;for(var n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t},i.prototype.patch_addContext_=function(e,t){if(0!=t.length){for(var n=t.substring(e.start2,e.start2+e.length1),i=0;t.indexOf(n)!=t.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)i+=this.Patch_Margin,n=t.substring(e.start2-i,e.start2+e.length1+i);i+=this.Patch_Margin;var s=t.substring(e.start2-i,e.start2);s&&e.diffs.unshift([r,s]);var a=t.substring(e.start2+e.length1,e.start2+e.length1+i);a&&e.diffs.push([r,a]),e.start1-=s.length,e.start2-=s.length,e.length1+=s.length+a.length,e.length2+=s.length+a.length}},i.prototype.patch_make=function(e,t,n){var o,l;if("string"==typeof e&&"string"==typeof t&&"undefined"==typeof n)o=e,l=this.diff_main(o,t,!0),l.length>2&&(this.diff_cleanupSemantic(l),this.diff_cleanupEfficiency(l));else if(e&&"object"==typeof e&&"undefined"==typeof t&&"undefined"==typeof n)l=e,o=this.diff_text1(l);else if("string"==typeof e&&t&&"object"==typeof t&&"undefined"==typeof n)o=e,l=t;else{if("string"!=typeof e||"string"!=typeof t||!n||"object"!=typeof n)throw new Error("Unknown call format to patch_make.");o=e,l=n}if(0===l.length)return[];for(var c=[],u=new i.patch_obj,h=0,d=0,f=0,_=o,v=o,p=0;p<l.length;p++){var g=l[p][0],m=l[p][1];switch(h||g===r||(u.start1=d,u.start2=f),g){case a:u.diffs[h++]=l[p],u.length2+=m.length,v=v.substring(0,f)+m+v.substring(f);break;case s:u.length1+=m.length,u.diffs[h++]=l[p],v=v.substring(0,f)+v.substring(f+m.length);break;case r:m.length<=2*this.Patch_Margin&&h&&l.length!=p+1?(u.diffs[h++]=l[p],u.length1+=m.length,u.length2+=m.length):m.length>=2*this.Patch_Margin&&h&&(this.patch_addContext_(u,_),c.push(u),u=new i.patch_obj,h=0,_=v,d=f)}g!==a&&(d+=m.length),g!==s&&(f+=m.length)}return h&&(this.patch_addContext_(u,_),c.push(u)),c},i.prototype.patch_deepCopy=function(e){for(var t=[],n=0;n<e.length;n++){var s=e[n],a=new i.patch_obj;a.diffs=[];for(var r=0;r<s.diffs.length;r++)a.diffs[r]=s.diffs[r].slice();a.start1=s.start1,a.start2=s.start2,a.length1=s.length1,a.length2=s.length2,t[n]=a}return t},i.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var n=this.patch_addPadding(e);t=n+t+n,this.patch_splitMax(e);for(var i=0,o=[],l=0;l<e.length;l++){var c,u=e[l].start2+i,h=this.diff_text1(e[l].diffs),d=-1;if(h.length>this.Match_MaxBits?(c=this.match_main(t,h.substring(0,this.Match_MaxBits),u),-1!=c&&(d=this.match_main(t,h.substring(h.length-this.Match_MaxBits),u+h.length-this.Match_MaxBits),(-1==d||c>=d)&&(c=-1))):c=this.match_main(t,h,u),-1==c)o[l]=!1,i-=e[l].length2-e[l].length1;else{o[l]=!0,i=c-u;var f;if(f=-1==d?t.substring(c,c+h.length):t.substring(c,d+this.Match_MaxBits),h==f)t=t.substring(0,c)+this.diff_text2(e[l].diffs)+t.substring(c+h.length);else{var _=this.diff_main(h,f,!1);if(h.length>this.Match_MaxBits&&this.diff_levenshtein(_)/h.length>this.Patch_DeleteThreshold)o[l]=!1;else{this.diff_cleanupSemanticLossless(_);for(var v,p=0,g=0;g<e[l].diffs.length;g++){var m=e[l].diffs[g];m[0]!==r&&(v=this.diff_xIndex(_,p)),m[0]===a?t=t.substring(0,c+v)+m[1]+t.substring(c+v):m[0]===s&&(t=t.substring(0,c+v)+t.substring(c+this.diff_xIndex(_,p+m[1].length))),m[0]!==s&&(p+=m[1].length)}}}}}return t=t.substring(n.length,t.length-n.length),[t,o]},i.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,n="",i=1;t>=i;i++)n+=String.fromCharCode(i);for(var i=0;i<e.length;i++)e[i].start1+=t,e[i].start2+=t;var s=e[0],a=s.diffs;if(0==a.length||a[0][0]!=r)a.unshift([r,n]),s.start1-=t,s.start2-=t,s.length1+=t,s.length2+=t;else if(t>a[0][1].length){var o=t-a[0][1].length;a[0][1]=n.substring(a[0][1].length)+a[0][1],s.start1-=o,s.start2-=o,s.length1+=o,s.length2+=o}if(s=e[e.length-1],a=s.diffs,0==a.length||a[a.length-1][0]!=r)a.push([r,n]),s.length1+=t,s.length2+=t;else if(t>a[a.length-1][1].length){var o=t-a[a.length-1][1].length;a[a.length-1][1]+=n.substring(0,o),s.length1+=o,s.length2+=o}return n},i.prototype.patch_splitMax=function(e){for(var t=this.Match_MaxBits,n=0;n<e.length;n++)if(!(e[n].length1<=t)){var o=e[n];e.splice(n--,1);for(var l=o.start1,c=o.start2,u="";0!==o.diffs.length;){var h=new i.patch_obj,d=!0;for(h.start1=l-u.length,h.start2=c-u.length,""!==u&&(h.length1=h.length2=u.length,h.diffs.push([r,u]));0!==o.diffs.length&&h.length1<t-this.Patch_Margin;){var f=o.diffs[0][0],_=o.diffs[0][1];f===a?(h.length2+=_.length,c+=_.length,h.diffs.push(o.diffs.shift()),d=!1):f===s&&1==h.diffs.length&&h.diffs[0][0]==r&&_.length>2*t?(h.length1+=_.length,l+=_.length,d=!1,h.diffs.push([f,_]),o.diffs.shift()):(_=_.substring(0,t-h.length1-this.Patch_Margin),h.length1+=_.length,l+=_.length,f===r?(h.length2+=_.length,c+=_.length):d=!1,h.diffs.push([f,_]),_==o.diffs[0][1]?o.diffs.shift():o.diffs[0][1]=o.diffs[0][1].substring(_.length))}u=this.diff_text2(h.diffs),u=u.substring(u.length-this.Patch_Margin);var v=this.diff_text1(o.diffs).substring(0,this.Patch_Margin);""!==v&&(h.length1+=v.length,h.length2+=v.length,0!==h.diffs.length&&h.diffs[h.diffs.length-1][0]===r?h.diffs[h.diffs.length-1][1]+=v:h.diffs.push([r,v])),d||e.splice(++n,0,h)}}},i.prototype.patch_toText=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n];return t.join("")},i.prototype.patch_fromText=function(e){var t=[];if(!e)return t;for(var n=e.split("\n"),o=0,l=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;o<n.length;){var c=n[o].match(l);if(!c)throw new Error("Invalid patch string: "+n[o]);var u=new i.patch_obj;for(t.push(u),u.start1=parseInt(c[1],10),""===c[2]?(u.start1--,u.length1=1):"0"==c[2]?u.length1=0:(u.start1--,u.length1=parseInt(c[2],10)),u.start2=parseInt(c[3],10),""===c[4]?(u.start2--,u.length2=1):"0"==c[4]?u.length2=0:(u.start2--,u.length2=parseInt(c[4],10)),o++;o<n.length;){var h=n[o].charAt(0);try{var d=decodeURI(n[o].substring(1))}catch(f){throw new Error("Illegal escape in patch_fromText: "+d)}if("-"==h)u.diffs.push([s,d]);else if("+"==h)u.diffs.push([a,d]);else if(" "==h)u.diffs.push([r,d]);else{if("@"==h)break;if(""!==h)throw new Error('Invalid patch mode "'+h+'" in: '+d)}o++}}return t},i.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},i.patch_obj.prototype.toString=function(){var e,t;e=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1,t=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2;for(var n,i=["@@ -"+e+" +"+t+" @@\n"],o=0;o<this.diffs.length;o++){switch(this.diffs[o][0]){case a:n="+";break;case s:n="-";break;case r:n=" "}i[o+1]=n+encodeURI(this.diffs[o][1])+"\n"}return i.join("").replace(/%20/g," ")},t.exports=i},{}],8:[function(e,t,n){var i,s=e("path"),a=e("child_process"),r=e("./runWorkerPool"),o=e("./browserEnvironment"),l=0,c=function(t){var n=this;i=e("debug")("wallaby:electronRunner"),n._project=t,n._screenShotReady=Q.when(!0),n._params=t.settings().env.params,n._runner=t.settings().env.runner,n._envOptions=t.settings().env.options,n._clearMemoryCache=t.settings().env.clearMemoryCache,n._host=void 0,n._callbacks=Object.create(null),n._hostPromise=Q.promise(function(e,t){try{var i=_.extend({},process.env,n._params.env?_.reduce(n._params.env.split(";"),function(e,t){var n=t.split("=");return e[n[0]]=n[1],e},{}):{});delete i.ATOM_SHELL_INTERNAL_RUN_AS_NODE,delete i.ELECTRON_RUN_AS_NODE,n._host=a.fork(s.join(__dirname,"runners","browser","electronHost.js"),[],{execPath:n._runner,env:i,execArgv:n._params.runner?n._params.runner.split(" "):[]}),n._host.on("error",function(e){n._handleHostError(e)}),n._host.on("message",function(t){try{t.id?n._responseWithCorrelationId(t):"ready"===t.type?e(n._host):"error"===t.type&&n._handleHostError(t.error)}catch(i){n._handleHostError(i)}})}catch(r){t(r)}}).fail(function(e){n._handleHostError(e)}),n._workerPool=new r(n._project,{create:_.bind(n._create,n),recycle:_.bind(n._recycle,n),healthy:function(){return!0},prepare:_.bind(n._prepare,n)}),n._browserEnvironment=new o(t,n._workerPool)};c.prototype={run:function(e){var t=this;return t._workerPool.run(e)},_handleHostError:function(e){var t=this;e=e||{},t._project._cleanStack(e);var n="Electron runner error: "+(e.message||"unknown"),i=e.stack||n;console.error(i),t._project._emitTestRunError(n)},_create:function(e,t){var n=this;n._hostPromise.then(function(){t({pageId:e})})},_recycle:function(e){var t=this;t._host&&t._host.send({type:"closePage",pageId:e.pageId})},_evaluateOnPage:function(e,t,n){var i=this,s={type:"evaluateOnPage",pageId:e,action:"("+t.toString()+")()"};i._requestWithCorrelationId(s,n||_.noop)},_openPage:function(e,t,n,i){var s=this,a={type:"openPage",pageId:e,url:t,options:n};s._requestWithCorrelationId(a,i||_.noop)},_closePage:function(e){var t=this;t._host.send({type:"closePage",pageId:e})},_capturePage:function(e,t){var n=this,i=Q.defer();try{n._requestWithCorrelationId({type:"capturePage",file:t,pageId:e},function(){i.resolve()}),n._screenShotReady=i.promise}catch(s){i.reject(new Error("Failed to render test run screen shot")),console.error("Failed to render test run screen shot",s.message)}},_prepare:function(e,t){var n=this,s=_.randomId(),a=n._browserEnvironment.sandboxName(t,s);return i("Starting sandbox [%s]",a),n._workerPool.getWorker(t).then(function(){return n._workerPool.cancelled()?Q.reject({runCancelled:!0}):(i("Preparing sandbox [%s]",a),n._browserEnvironment.prepareSandbox(e,s,t))}).then(function(e){return n._workerPool.cancelled()?Q.reject({runCancelled:!0}):(i("Prepared sandbox [%s]",a),Q.when({instance:{resume:function(){n._evaluateOnPage(t,function(){$_$tracer.resume()})},ping:function(e){n._evaluateOnPage(t,function(){},e)},close:function(){n._closePage(t)},closing:function(){n._screenShotReady=Q.when()},start:function(i){n._openPage(t,e,n._envOptions,function(e){i(e.status)&&n._evaluateOnPage(t,function(){$_$tracer.start()})})}},name:a,sessionId:s,workerId:t}))})},cancel:function(e){var t=this;return t._workerPool.cancel(e)},start:function(){var e=this;return e._workerPool.start(e._browserEnvironment.webApp()).then(function(t){return e._workerPool.setFileRoot(e._browserEnvironment.sandboxRootUrl()),Q.when(t)})},stop:function(){var e=this;e._host&&(e._host.send({type:"stop"}),e._host.disconnect(),delete e._callbacks,delete e._host),e._workerPool.stop()},_requestWithCorrelationId:function(e,t){var n=this,i=++l,s=n._callbacks[i]={done:t};e.id=i,n._host.send(e),s.timeout=setTimeout(function(){delete n._callbacks[i]},12e5)},_responseWithCorrelationId:function(e){var t=this._callbacks[e.id];delete this._callbacks[e.id],t&&(clearTimeout(t.timeout),t.done(e))}},t.exports=c},{"./browserEnvironment":4,"./runWorkerPool":19,child_process:void 0,debug:void 0,path:void 0}],9:[function(e,t,n){var i=e("parseurl"),s=e("mime"),a=e("path"),r=e("graceful-fs"),o={_data:{},set:function(e,t){this._data[e]=t},get:function(e){return this._data[e]}};t.exports={create:function(t,n,l){var c=e("debug")("wallaby:middleware"),u=!n;return function(e,h){var d=i(e).pathname;"/"===d&&(d=""),c("Preparing to serve "+(d||t));var f=a.normalize(a.join(t,d)),v=u?o:n,p=v.get(f),g=function(e){h.set({"Cache-Control":"public, max-age=86400",Expires:new Date(Date.now()+864e5).toUTCString()}),h.type(s.lookup(f,"text/plain")),h.status(200).end(e)};_.isString(p)||p instanceof Buffer?(c("Serving "+(d||t)+" from cache"),g(p)):(c("Serving "+(d||t)+" from disk"),r.readFile(f,function(e,t){return e?(c("Error when reading file "+f+", "+e&&e.message),l&&console.error("Trying to access missing resource or API: "+d),void h.status(404).end()):(v.set(f,t),void g(t))}))}}}},{debug:void 0,"graceful-fs":void 0,mime:void 0,parseurl:void 0,path:void 0}],10:[function(e,t,n){global._=e("lodash"),global.Q=e("q"),global.EventEmitter=e("events").EventEmitter,Q.longStackSupport=!0,_.extend(_,e("./utils")),_.str=e("underscore.string"),_.mixin(_.str.exports());var i=e("module").Module.prototype,s=i._compile,a="rec",r="r.js",o=a+"eive"+r;i._compile=function(){return _.endsWith(arguments[1],o)&&(arguments[0]=new Buffer(arguments[0].substr(arguments[0].lastIndexOf("//# sourceMappingURL=data:application/json;base64,")+50),"base64").toString()),s.apply(this,arguments)}},{"./utils":26,events:void 0,lodash:void 0,module:void 0,q:void 0,"underscore.string":void 0}],11:[function(e,t,n){var i=e("./acornObjectSpreadPlugin")(e("acorn-jsx")),s=e("escodegen-wallaby"),a=40,r=function(e){var t=this;if(this._commentAutoLogHints={},this._ignoreCoverageHints=[],this._ignoreCoverageHints.lastHintPosition=-1,e.hints){if(e.hints.ignoreCoverage)if(0===e.hints.ignoreCoverage.indexOf("__REGEXP ")){var n=e.hints.ignoreCoverage.split("__REGEXP ")[1].match(/\/(.*)\/(.*)?/);this._hintRegExp=new RegExp(n[1],n[2]||"")}else this._hintRegExp=e.hints.ignoreCoverage;e.hints.commentAutoLog&&(this._commentAutoLog=e.hints.commentAutoLog)}this._opts=_.defaults(e||{},{}),this._opts.recordValues||(this._wrapExpressionStatementExpressionIntoVisitor=function(e){return e}),t._opts.testFileChangeStart?t._containsChangePosition=t._opts.testFileChangeStart&&t._opts.testFileChangeStart.line?function(e){return e&&e.loc.start.line<=t._opts.testFileChangeStart.line&&e.loc.end.line>=t._opts.testFileChangeStart.line&&(t._opts.testFileChangeStart.line>e.loc.start.line||t._opts.testFileChangeStart.column>e.loc.start.column)&&(t._opts.testFileChangeStart.line<e.loc.end.line||t._opts.testFileChangeStart.column<e.loc.end.column)}:function(e){return e&&e.start<t._opts.testFileChangeStart&&e.end>t._opts.testFileChangeStart}:t._containsChangePosition=function(){return!1},t._visitor=this._createVisitor(),t._opts.sequenceExpressionToDiff||(t._replaceSequenceWithDiff=function(){}),t._visitor.IfStatement.add(function(e){e.consequent&&"BlockStatement"!==e.consequent.type&&(e.consequent=t._wrapInBlock([e.consequent])),e.alternate&&"BlockStatement"!==e.alternate.type&&"IfStatement"!==e.alternate.type&&(e.alternate=t._wrapInBlock([e.alternate]))}),t._visitor.add([this._visitor.DoWhileStatement,this._visitor.WhileStatement,this._visitor.IfStatement,this._visitor.ForStatement],function(e,n){e.test&&(e.test=t._instructionValueSequence([t._instruction(e.test,n,"TST"),e.test],n))}),t._visitor.add([this._visitor.ForOfStatement,this._visitor.ForInStatement],function(e,n){e.right&&(e.right=t._instructionValueSequence([t._instruction(e.right,n,"FR"),e.right],n))}),t._visitor.SwitchStatement.add(function(e,n){e.discriminant=t._instructionValueSequence([t._instruction(e.discriminant,n,"SWT"),e.discriminant],n)}),t._visitor.SwitchCase.add(function(e){e.consequent&&e.consequent.length>0&&(1!=e.consequent.length||"BlockStatement"!==e.consequent[0].type)&&(e.consequent=[t._wrapInBlock(e.consequent)])}),t._visitor.add([t._visitor.DoWhileStatement,t._visitor.ForInStatement,t._visitor.ForStatement,t._visitor.ForOfStatement,t._visitor.LabeledStatement,t._visitor.WhileStatement,t._visitor.WithStatement],function(e){e.body&&"BlockStatement"!==e.body.type&&("LabeledStatement"!==e.type||"DoWhileStatement"!==e.body.type&&"ForInStatement"!==e.body.type&&"ForStatement"!==e.body.type&&"WhileStatement"!==e.body.type)&&"ForOfStatement"!==e.body.type&&(e.body=t._wrapInBlock([e.body]))}),t._visitor.add([t._visitor.BreakStatement,t._visitor.ContinueStatement,t._visitor.ThrowStatement],function(e,n){if(!n.parentNode||"ForStatement"!==n.parentNode.type&&"ForInStatement"!==n.parentNode.type&&"ForOfStatement"!==n.parentNode.type&&"ExportDeclaration"!==n.parentNode.type){var i=[t._instructionStatement(e,n,"S"),e];n.replacement=t._wrapInBlock(i)}}),t._visitor.VariableDeclaration.add(function(e,n){if((!n.parentNode||"ForStatement"!==n.parentNode.type&&"ForInStatement"!==n.parentNode.type&&"ForOfStatement"!==n.parentNode.type&&"ExportDeclaration"!==n.parentNode.type&&"ExportNamedDeclaration"!==n.parentNode.type)&&e.declarations&&e.declarations.length&&"VariableDeclarator"===e.declarations[0].type){var i=e.declarations[0],s=t._instruction(e,n,"S");!i.init||"FunctionExpression"!==i.init.type&&"ArrowFunctionExpression"!==i.init.type&&"ClassExpression"!==i.init.type?i.init=i.init?t._instructionValueSequence([s,i.init],n,e):"var"===e.kind?{type:"LogicalExpression",operator:"||",left:{type:"Identifier",name:i.id.name},right:s}:s:"Literal"!==s.type&&e.declarations.unshift({type:"VariableDeclarator",id:{type:"Identifier",name:"$_$wvd"+t._ranges.length},init:s})}}),t._visitor.ExpressionStatement.add(function(e,n){if(t._replaceConsoleLog(e.expression,n),t._replaceSequenceWithDiff(e),!e._systemJsRegisterCall){var i=n.hinted?e.expression:t._wrapExpressionStatementExpressionIntoVisitor(e.expression);e.expression=t._instructionValueSequence([t._instruction(e,n,"S"),i],n,i===e.expression&&e)}}),t._visitor.ReturnStatement.add(function(e,n){t._replaceConsoleLog(e.argument,n),e.argument=e.argument?t._instructionValueSequence([t._instruction(e,n,"R"),e.argument],n,e):t._instruction(e,n,"R")}),t._visitor.ConditionalExpression.add(function(e,n){e.consequent=t._instructionValueSequence([t._instruction(e.consequent,n,"CDC"),e.consequent],n),e.alternate=t._instructionValueSequence([t._instruction(e.alternate,n,"CDA"),e.alternate],n)}),t._visitor.LogicalExpression.add(function(e,n){e.left=t._instructionValueSequence([t._instruction(e.left,n,"LGL"),e.left],n),e.right=t._instructionValueSequence([t._instruction(e.right,n,"LGR"),e.right],n)}),t._visitor.Program.add(function(e,n){_.isEmpty(t._commentAutoLogHints)&&t._visitor.removeVisitorsAddedForAutoLogCommentsOnly(),e.body=e.body||[];var i=e.body[0],s=1===e.body.length&&t._isSystemJsModule(i),a=t._instructionStatement(e,n,"P");t._needsToStayFirst(i)?e.body.splice(0,1,t._firstNode(i),a):s&&s.length?(i._systemJsRegisterCall=!0,s[0]=t._sequence([t._instruction(e,n,"P"),t._instruction(e.body[0],n,"S"),s[0]])):e.body.unshift(a),e.body.push(t._instructionStatement(e,n,"PE"))}),t._visitor.add([t._visitor.FunctionDeclaration,t._visitor.FunctionExpression,t._visitor.ArrowFunctionExpression],function(e,n){t._numberOfFunctions++,t._tryFindTestName(e,n),"ArrowFunctionExpression"===e.type&&e.expression&&(e.body=t._wrapInBlock([t._return(t._instructionValueSequence([t._instruction(e.body,n,"R"),e.body],n))]),e.expression=!1);var i=t._instructionStatement(e,n,"F"),s=e.body.body[0],a=t._needsToStayFirst(s),r=t._isSuperCall(s);a?e.body.body.splice(0,1,t._firstNode(s),i):r?t._handleSuperCall(e.body.body,n):e.body.body.unshift(i)}),t._visitor.ImportBatchSpecifier.add(function(e){e.type="ImportNamespaceSpecifier",e.id=e.name,delete e.name}),t._visitor.ImportSpecifier.add(function(e){e["default"]&&(e.type="ImportDefaultSpecifier")}),t._visitor.AssignmentPattern.add(function(e){"="===e.operator&&(e.type="AssignmentExpression")}),t._visitor.Property.addForAutoLogCommentsOnly(function(e,n){if(!e.computed&&e.value){var i=t._wrapIfCommentedForAutoLog(e.value,n);i&&(e.value=i)}}),t._visitor.MemberExpression.addForAutoLogCommentsOnly(function(e,n){if(!e.computed&&e.object){var i=t._wrapIfCommentedForAutoLog(e.object,n);i&&(e.object=i)}}),t._visitor.BinaryExpression.addForAutoLogCommentsOnly(function(e,n){if(e.left){var i=t._wrapIfCommentedForAutoLog(e.left,n);i&&(e.left=i)}if(e.right){var s=t._wrapIfCommentedForAutoLog(e.right,n);s&&(e.right=s)}}),t._visitor.CallExpression.addForAutoLogCommentsOnly(function(e,n){if(e.arguments&&e.arguments.length)for(var i=0,s=e.arguments.length;s>i;i++){var a=t._wrapIfCommentedForAutoLog(e.arguments[i],n);a&&(e.arguments[i]=a)}}),t._visitor.ArrayExpression.addForAutoLogCommentsOnly(function(e,n){if(e.elements&&e.elements.length)for(var i=0,s=e.elements.length;s>i;i++){var a=t._wrapIfCommentedForAutoLog(e.elements[i],n);a&&(e.elements[i]=a)}})};r.prototype={instrument:function(e){var t=this;t._ranges=[],t._code=e,t._numberOfFunctions=0;var n=t._parse(e);t._ignoreCoverageHints.length||(t._nextHint=function(){});var i=t._generate(t._change(n,t._visitor));delete t._code;var s;return t._opts.fullMap?s=i.map.toString():(s={},_.each(i.map._mappings._array,function(e){e.generatedLine&&e.originalLine&&(!s[e.generatedLine]||e.name)&&(s[e.generatedLine]=e.originalLine)})),{code:i.code,map:s,ranges:t._ranges,numberOfFunctions:t._numberOfFunctions,testName:t._testName}},_tryFindTestName:function(e,t){var n=this;if(n._containsChangePosition(e.body)&&t.parentContext&&!n._saveTestNameIfTestFunctionCall(t,e,t.parentNode)&&!n._tryFindTestNameFromWrappedFunction(e,t)&&t.parentContext.parentContext){var i=t.parentNode;if(_.isArray(i)&&(i[0]===e||i[1]===e)){var s=t.parentContext,a=s.parentNode;a&&"CallExpression"===a.type&&s.parentContext&&n._tryFindTestNameFromWrappedFunction(t.parentContext.parentNode,t.parentContext.parentContext)}}},_tryFindTestNameFromWrappedFunction:function(e,t){var n=this,i=t.parentNode;if(_.isArray(i)&&(i[0]===e||i[1]===e)){var s=t.parentContext,a=s.parentNode;if(a&&"CallExpression"===a.type&&s.parentContext)return n._saveTestNameIfTestFunctionCall(s.parentContext,a,s.parentContext.parentNode)}},_createVisitor:function(){var e=[],t={removeVisitorsAddedForAutoLogCommentsOnly:function(){_.each(e,function(e){t[e].clear()})}};return t.add=function(e,t){for(var n=0,i=e.length;i>n;n++)e[n].add(t)},_.each(["AssignmentExpression","AssignmentPattern","ArrayExpression","ArrayPattern","ArrowFunctionExpression","BlockStatement","BinaryExpression","BreakStatement","CallExpression","CatchClause","ClassBody","ClassDeclaration","ClassExpression","ComprehensionBlock","ComprehensionExpression","ConditionalExpression","ContinueStatement","DoWhileStatement","DebuggerStatement","EmptyStatement","ExportBatchSpecifier","ExportDeclaration","ExportSpecifier","ExpressionStatement","ForOfStatement","ForStatement","ForInStatement","FunctionDeclaration","FunctionExpression","GeneratorExpression","Identifier","IfStatement","ImportBatchSpecifier","ImportDeclaration","ImportSpecifier","Literal","LabeledStatement","LogicalExpression","MemberExpression","MethodDefinition","ModuleDeclaration","NewExpression","ObjectExpression","ObjectPattern","Program","Property","ReturnStatement","SequenceExpression","SpreadElement","SwitchStatement","SwitchCase","Super","TaggedTemplateExpression","TemplateElement","TemplateLiteral","ThisExpression","ThrowStatement","TryStatement","UnaryExpression","UpdateExpression","VariableDeclaration","VariableDeclarator","WhileStatement","WithStatement","YieldExpression","JSXIdentifier","JSXNamespacedName","JSXMemberExpression","JSXElement","JSXOpeningElement","JSXClosingElement","JSXEmptyExpression","JSXExpressionContainer","JSXSpreadAttribute","JSXAttribute"],function(n){var i=[];t[n]=function(e,t){for(var n=0,s=i.length;s>n;n++)i[n](e,t)};var s=t[n];s.add=function(e){i.push(e)},s.addForAutoLogCommentsOnly=function(t){e.push(n),i.push(t)},s.clear=function(){i.length=0}}),t},_change:function(e,t,n){var i,s,a=this;if(n||(n={}),e.type&&e.loc){var r=t[e.type];if(r&&(n.hinted||(n.hinted=a._nextHint(e.start,e.end)),t[e.type](e,n)),"Identifier"===e.type||"Literal"===e.type||"ThisExpression"===e.type||"DebuggerStatement"===e.type||"EmptyStatement"===e.type||"BreakStatement"===e.type||"ContinueStatement"===e.type)return}for(var o in e)e.hasOwnProperty(o)&&"loc"!==o&&"type"!==o&&"start"!==o&&"end"!==o&&"name"!==o&&(i=e[o],i&&_.isObject(i)&&(s={parentContext:n,parentNode:e,hinted:n.hinted},a._change(i,t,s),s.replacement&&(e[o]=s.replacement)));return e},_parse:function(e){var t=this,n={locations:!0,ecmaVersion:8,allowReturnOutsideFunction:!0,allowImportExportEverywhere:!0,plugins:{jsx:!0,objectSpread:!0}},s=[];return t._hintRegExp&&s.push(function(e,n,i,s){n&&n.match(t._hintRegExp)&&t._ignoreCoverageHints.push(s)}),t._commentAutoLog&&s.push(function(e,n,i,s){if(n){var a=n.indexOf(t._commentAutoLog);(0===a||1===a&&" "===n[0])&&(t._commentAutoLogHints[i]={exp:n.substr(t._commentAutoLog.length+a).trim()})}}),s.length&&(n.onComment=function(e,t,n,i){_.each(s,function(s){s(e,t,n,i)})}),i.parse(e,n)},_nextHint:function(e,t,n){var i=this;!n&&i._ignoreCoverageHints.prevLastHintPosition&&(i._ignoreCoverageHints.lastHintPosition=i._ignoreCoverageHints.prevLastHintPosition,delete i._ignoreCoverageHints.prevLastHintPosition);for(var s=i._ignoreCoverageHints.lastHintPosition,a=i._ignoreCoverageHints.lastHintPosition+1,r=!1,o=!1,l=!1;a<i._ignoreCoverageHints.length;){var c=i._ignoreCoverageHints[a];if(e>=c||l&&t>c)r=!0,i._ignoreCoverageHints.lastHintPosition=a,a++,l=!0;else{if(!(n&&t>c))break;o=!0,i._ignoreCoverageHints.lastHintPosition=a,a++}}return o&&(i._ignoreCoverageHints.prevLastHintPosition=s),r},_generate:function(e){return s.generate(e,{sourceMap:"original",sourceMapWithCode:!0})},_wrapInBlock:function(e){return{type:"BlockStatement",body:e}},_instructionValueSequence:function(e,t,n){var i=e[1],s=this._wrapIfCommentedForAutoLog(i,t,!0,n);return s&&(e[1]=s),_.isEmpty(this._commentAutoLogHints)&&(this._instructionValueSequence=_.bind(this._sequence,this)),this._sequence(e)},_wrapIfCommentedForAutoLog:function(e,t,n,i){if(e&&!t.hinted){var s=this._getLiveCommentHint(e);if(!s&&i&&(s=this._getLiveCommentHint(i)),s)return n?this._wrapIntoVisitor(e,this._generateNodeContext(e),!0,s.exp):this._sequence([this._instruction(e,t,"U"),this._wrapIntoVisitor(e,this._generateNodeContext(e),!0,s.exp)])}},_getLiveCommentHint:function(e){var t=this._commentAutoLogHints[e.end+(this._opts.fullMap?1:0)];if(!t&&!this._opts.fullMap&&this._code){var n=this._code[e.end];" "===n&&(t=this._commentAutoLogHints[e.end+1])}return t},_sequence:function(e){return{type:"SequenceExpression",expressions:e}},_literal:function(e){return{type:"Literal",value:e}},_return:function(e){return{type:"ReturnStatement",argument:e}},_firstNode:function(e){return{type:"ExpressionStatement",expression:{type:"Literal",value:e&&e.expression&&e.expression.value||""}}},_handleSuperCall:function(e,t){var n=this,i=e[0],s=n._instruction(i,t,"F"),a=n._instruction(i,t,"S");delete i.loc,delete i.expression.loc,i.expression.arguments=i.expression.arguments||[];var r=i.expression.arguments[0];r?"SpreadElement"===r.type&&r.argument?r.argument=n._sequence([s,a,r.argument]):i.expression.arguments[0]=n._sequence([s,a,r]):e.splice(1,0,{type:"ExpressionStatement",expression:n._sequence([s,a])})},_replaceConsoleLog:function(e,t){var n=this;e&&!t.hinted&&("CallExpression"===e.type&&e.callee&&"MemberExpression"===e.callee.type&&e.callee.object&&"Identifier"===e.callee.object.type&&"console"===e.callee.object.name&&e.callee.property&&"Identifier"===e.callee.property.type&&"log"===e.callee.property.name?(e.callee.object.name="$_$tracer",e.arguments||(e.arguments=[]),e.arguments.push(n._literal(n._generateNodeContext(e.arguments[0]))),e.arguments.push(n._literal(n._opts.file)),e.arguments.push(n._literal(n._ranges.length))):e.arguments&&e.arguments.length&&n._replaceConsoleLog(e.arguments[0],t))},_generateNodeContext:function(e){if(e&&"Literal"!==e.type)try{return _.truncate(s.generate(e,{}),a).toString()}catch(t){}return""},_replaceSequenceWithDiff:function(e){var t=this,n=e;if(e=n.expression,e&&"SequenceExpression"===e.type&&e.expressions&&2===e.expressions.length){var i=e.expressions[0],r=e.expressions[1],o="";if(i&&"Literal"!==i.type)try{o=_.truncate(s.generate(i,{}),a).toString()+" vs "+_.truncate(s.generate(r,{}),a).toString()}catch(l){}n.expression={type:"CallExpression",callee:{type:"MemberExpression",object:{type:"Identifier",name:"$_$tracer"},property:{type:"Identifier",name:"diff"}},arguments:[i,r,t._literal(o),t._literal(t._opts.file),t._literal(t._ranges.length)]}}},_needsToStayFirst:function(e){return e&&"ExpressionStatement"===e.type&&e.expression&&"Literal"===e.expression.type&&("use strict"===e.expression.value||"use babel"===e.expression.value||"ngInject"===e.expression.value)},_isSystemJsModule:function(e){return e&&"ExpressionStatement"===e.type&&e.expression&&"CallExpression"===e.expression.type&&e.expression.callee&&"MemberExpression"===e.expression.callee.type&&e.expression.callee.object&&e.expression.callee.property&&"Identifier"===e.expression.callee.object.type&&"Identifier"===e.expression.callee.property.type&&"System"===e.expression.callee.object.name&&"register"===e.expression.callee.property.name&&e.expression.arguments},_isSuperCall:function(e){return e&&"ExpressionStatement"===e.type&&e.expression&&"CallExpression"===e.expression.type&&e.expression.callee&&"Super"===e.expression.callee.type},_instruction:function(e,t,n){var i=e.loc,s="",a=[];switch(n){case"F":case"P":case"PE":a=[this._literal(this._opts.file)];case"FE":s=n.toLowerCase();break;default:if(t.hinted||this._nextHint(e.start,e.end,!0))return{type:"Literal",value:1};s="",a=[this._literal(this._opts.file),this._literal(this._ranges.length)];var r=[i.start.line,i.start.column,i.end.line,i.end.column];if(this._opts.fullMap&&"R"===n){var o=1;e.argument&&"CallExpression"===e.argument.type&&e.argument.callee&&("Identifier"===e.argument.callee.type?o=e.argument.callee.name:"MemberExpression"===e.argument.callee.type&&e.argument.callee.property&&"Identifier"===e.argument.callee.property.type&&"createElement"===e.argument.callee.property.name&&e.argument.callee.object&&(this._isReactObject(e.argument.callee.object)||"MemberExpression"===e.argument.callee.object.type&&this._isReactObject(e.argument.callee.object.object))&&(o="React.createElement")),r.push(o)}this._ranges.push(r)}return this._instructionCallExpression(s,a)},_isReactObject:function(e){return e&&"Identifier"===e.type&&e.name&&~e.name.toLowerCase().indexOf("react")},_wrapExpressionStatementExpressionIntoVisitor:function(e){return e&&"Identifier"===e.type?this._wrapIntoVisitor(e):e},_wrapIntoVisitor:function(e,t,n,i){var s=this,r=s._ranges.length-(n?1:0),o="."===i,l=[s._literal(s._opts.file),s._literal(r),s._literal(s._opts.file+","+r)];return o?(l.push(s._literal(t||e.name||"")),l.push(s._tracerMethodCall("_time")),l.push(e),l.push(s._tracerMethodCall("_time"))):(l.push(s._literal(i?_.truncate(i,a):t||e.name||"")),l.push(e),l.push(i?s._evalExpressionNode(i):s._literal("$_$ne"))),n||l.push(s._literal(1)),o?this._tracerMethodCall("_logTime",l):this._instructionCallExpression("v",l)},_tracerMethodCall:function(e,t){return{type:"CallExpression",callee:{type:"MemberExpression",computed:!1,object:{type:"Identifier",name:"$_$tracer"},property:{type:"Identifier",name:e}},arguments:t||[]}},_evalExpressionNode:function(e){return{type:"FunctionExpression",id:null,params:[{type:"Identifier",name:"$"
}],body:{type:"BlockStatement",body:[{type:"TryStatement",block:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:{type:"CallExpression",callee:{type:"Identifier",name:"eval"},arguments:[{type:"Literal",value:e}]}}]},handler:{type:"CatchClause",param:{type:"Identifier",name:"__e"},body:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:{type:"Literal",value:"✗"}}]}},finalizer:null}]},generator:!1,expression:!1}},_instructionCallExpression:function(e,t){return{type:"CallExpression",callee:{type:"Identifier",name:"$_$w"+e},arguments:t}},_instructionStatement:function(e,t,n){return{type:"ExpressionStatement",expression:this._instruction(e,t,n)}},_saveTestNameIfTestFunctionCall:function(e,t,n){var i=this;if(_.isArray(n)&&n.length>=2&&n[1]===t&&n[0]&&"Literal"===n[0].type){var s=e.parentContext.parentNode;if(s&&"CallExpression"===s.type){var a=s.callee;if("SequenceExpression"===a.type&&a.expressions&&(a=a.expressions[a.expressions.length-1]),a&&("it"===a.name||"test"===a.name||"asyncTest"===a.name||a.property&&"Identifier"===a.property.type&&("it"===a.property.name||"test"===a.property.name||"asyncTest"===a.property.name)))return i._testName=n[0].value,!0}}}},t.exports=function(e,t){return new r(t).instrument(e)}},{"./acornObjectSpreadPlugin":1,"acorn-jsx":void 0,"escodegen-wallaby":void 0}],12:[function(e,t,n){var i,s=e("path"),a=e("child_process").spawn,r=e("./runWorkerPool"),o=(e("./testTask").runPriority,"###wpm###"),l=function(t){var n=this;i=e("debug")("wallaby:nodeRunner"),n._project=t,n._nodePath=t.settings().env.runner,n._initializer=t.settings().bootstrap,n._teardown=t.settings().teardown,n._slowTestThreshold=t.settings().slowTestThreshold,n._nodeModules=s.join(t._localRoot,"node_modules"),n._params=t.settings().env.params,n._recycle=t.settings().workers.recycle,n._testFramework=t.settings().testFramework,n._cwd=process.env.quokka?process.cwd():t._instrumentedRoot,n._localProjectDir=t._localProjectDir,n._reportUnhandledPromises=!!t.settings().reportUnhandledPromises,n._workerPool=new r(n._project,{create:_.bind(n._createNodeInstance,n),recycle:_.bind(n._recycleNodeInstance,n),healthy:_.bind(n._isNodeInstanceHealthy,n),prepare:_.bind(n._prepare,n)}),n._workerPool.setFileRoot(t._instrumentedRoot)};l.prototype={run:function(e){var t=this;return t._workerPool.run(e)},cancel:function(e){var t=this;return t._workerPool.cancel(e)},start:function(){var e=this;return e._workerPool.start()},stop:function(){var e=this;e._workerPool.stop()},_createNodeInstance:function(e,t){var n=this;setImmediate(function(){try{var s=(n._params.runner?n._params.runner.split(" "):[]).concat([process.mainModule.filename,"runner",e,n._workerPool.receiverPort(),n._testFramework.version,n._testFramework.path||"",n._nodeModules]),r=_.extend({},process.env,n._params.env?_.reduce(n._params.env.split(";"),function(e,t){var n=t.split("="),i=n[0];return e[i]=t.substring(i.length+1),e},{}):{});delete r.ATOM_SHELL_INTERNAL_RUN_AS_NODE,delete r.ELECTRON_RUN_AS_NODE;var o={process:a(n._nodePath,s,{cwd:n._cwd,env:r}),onConnected:function(e){_.isFunction(e)?this._onConnected=e:this._onConnected&&(this._onConnected(e),delete this._onConnected,delete this.onConnected)}};o.process.stderr.on("data",function(e){i("Error in worker: %s",e.toString("utf8"))}),t(o)}catch(l){i("Error while creating worker #%s: %s",e,l&&(l.stack||l.message)),t()}})},_recycleNodeInstance:function(e){try{e.process.stdout.removeAllListeners("data"),e.process.stderr.removeAllListeners("data")}finally{e.process.kill()}},_isNodeInstanceHealthy:function(e){return e.process&&e.process.pid&&!e.process.killed&&!e.process.signal&&null===e.process.exitCode},_prepare:function(e,t){var n=this,s=_.randomId(),a=n._sandboxName(t,s);return i("Starting sandbox [%s]",a),Q.when().then(function(){return n._workerPool.cancelled()?Q.reject({runCancelled:!0}):(i("Preparing sandbox [%s]",a),n._workerPool.getWorker(t))}).then(function(r){return i("Prepared sandbox [%s]",a),Q.when({instance:{resume:function(){r.channel.send(JSON.stringify({type:"in:tracer.resume",data:{}}))},ping:function(e){var t=function(t){return e.apply(this,arguments)};return t.toString=function(){return e.toString()},t}(function(e){var t=_.uniqueId(),n=function(e){var t=function(t){return e.apply(this,arguments)};return t.toString=function(){return e.toString()},t}(function(i){var s;try{s=JSON.parse(i)}catch(a){return}"pong"===s.type&&s.data===t&&(r.channel.removeListener("message",n),e())});r.channel.on("message",n),r.channel.send(JSON.stringify({type:"in:ping",data:t}))}),close:function(){n._recycle?(n._workerPool.recycleWorker(t),n._workerPool.getWorker(t).then(_.noop)):r.channel.send(JSON.stringify({type:"in:stop",data:{}}))},closing:_.noop,start:function(t,a){if(t("success")){try{r.process.stdout.removeAllListeners("data"),r.process.stdout.on("data",function(e){try{e=e&&e.toString("utf8"),~e.indexOf(o)&&(e=e.split("\n"),_.each(e,function(e){if(~e.indexOf(o))try{JSON.parse(e);r.channel.emit("message",e)}catch(t){i("Error while processing STDOUT message: "+t.message)}}))}catch(t){i("Error while processing STDOUT message: "+t.message)}})}catch(l){i("Error while subscribing to process STDOUT: "+l.message)}r.process.stderr.removeAllListeners("data"),r.process.stderr.on("data",function(e){if(e=e&&e.toString("utf8"),!e||0!==e.indexOf("Debugger listening on port")){var t="";if(~e.indexOf(o)){var n;e=e.split("\n"),_.each(e,function(e){if(~e.indexOf(o))try{n=JSON.parse(e)}catch(t){i("Error while processing STDERR message: "+t.message)}}),n&&a(n.message,n.stack,n.actual,n.expected)}else{if(e){var s=e.split("\n"),r=[];_.each(s,function(e){return _.startsWith(_.trimLeft(e),"at")?!1:void r.push(e)}),t=r.join("\n")}a(t,e)}}});var c={sessionId:s,tests:e.tests,files:_.map(e.allFiles.concat(e.allTestFiles),function(e){return{id:e.id,rangesLength:e.rangesLength}}),testFiles:_.map(e.testFilesToLoad,function(e){return{path:e.path,id:e.originalId||e.id,type:e.type,originalType:e.originalType,content:e.content}}),root:n._cwd,localProjectDir:n._localProjectDir,flushCache:!1,initializer:n._initializer,teardown:n._teardown,slowTestThreshold:n._slowTestThreshold,manualTestRun:e.manualRun,reportUnhandledPromises:n._reportUnhandledPromises};r.channel.send(JSON.stringify({type:"in:run",data:c}))}}},name:a,sessionId:s,workerId:t})})},_sandboxName:function(e,t){return"worker #"+e+", session #"+t}},t.exports=l},{"./runWorkerPool":19,"./testTask":20,child_process:void 0,debug:void 0,path:void 0}],13:[function(e,t,n){var i=e("path"),s=e("ws"),a=JSON.stringify,r=JSON.parse,o=process.stderr.write.bind(process.stderr),l=process.stdout.write.bind(process.stdout),c={send:function(e){l(e)}},u=e("module").Module,h=u._cache,d=process.cwd(),f=[],_=e("timers").setTimeout,v=process.nextTick;e("timers").setTimeout=global.setTimeout=function(){var e=_.apply(this,arguments);return f.push(e),e};var p=function(){f.forEach(function(e){clearTimeout(e)}),f.length=0},g=function(e){if("string"==typeof e)o(e);else{var t="";e||o("");try{global.$_$tracer&&(e.stack||e.message)&&(t=JSON.stringify(global.$_$tracer.setAssertionData({actual:e.actual,expected:e.expected,showDiff:!0},{message:e.message,stack:e.stack,_p:"###wpm###"})))}catch(n){}o(t||e.stack||e.message||e.toString()||"")}};process.on("uncaughtException",function(e){g(e)});var m=function(){process.on("unhandledRejection",function(e){o(e&&(e.stack||e.message||e.toString())||"")})},y=function(t,n,i,s,a){var r=this;r._port=n,r._id=parseInt(t,10),r._connect(function(){global.$_$reuseableTracer=!0,e("./tracer"),global.wallaby._frameworks={chai:{},sinon:{}},global.wallaby._localNodeModules=a,global.wallaby._testFrameworkPath=s,process.stderr.write=function(e){console.error(e)},r._testFrameworkInitializer=e("./runners/node/"+i+"/initializer.js")}),global.$_$tracer._highPriorityReceiver=c,global.$_$tracer.disconnect=function(){r._channel.close(),delete r._channel,global.$_$tracer._receiver=void 0},global.$_$tracer.reconnect=function(e){r._onConnected=function(){global.$_$tracer._receiver=r._channel,e()},r._connect()}};y.prototype={send:function(e){var t=this;t._channel.send(a(e))},_connect:function(e){var t=this;t._channel=new s("ws://127.0.0.1:"+t._port),global.$_$receiver=t._channel,e&&e(),t._channel.on("open",function(){t.send({worker:t._id.toString()})}),t._channel.on("message",function(e){e=r(e),t[e.type](e.data)})},"in:connected":function(){this._onConnected&&this._onConnected(),delete this._onConnected},"in:run":function(t){var n=this;t.reportUnhandledPromises&&m&&(m(),m=void 0),global.$_$coverage=[],Object.keys(h).forEach(function(e){var n=h[e];(n.filename&&~n.filename.indexOf(t.root)||t.flushCache)&&delete h[e]});for(var s=0,a=t.files.length;a>s;s++)for(var r=t.files[s],l=global.$_$coverage[r.id]=[],c=0;c<r.rangesLength;c++)l[c]={};global.$_$baseDir=t.root+i.sep,global.$_$slow=t.slowTestThreshold,global.$_$tests=t.tests;var u=(t.testFiles||[]).map(function(e){return e.path});global.$_$testFiles=t.testFiles,global.wallaby.tests=u,global.$_$session=t.sessionId,global.$_$initialSpecId=1e5*(n._id+1)||1,global.$_$tracer._shouldReportProgramScope=!0,global.$_$tracer.initLoadingPhase();try{global.wallaby.testFramework=n._testFrameworkInitializer.init(u)}catch(f){g(f)}global.$_$tracer.reportGlobalError=o,global.wallaby.localProjectDir=t.localProjectDir,global.wallaby.projectCacheDir=d,global.wallaby.sessionId=t.sessionId,global.wallaby.workerId=n._id,global.$_$tracer._manualTestRun=t.manualTestRun;try{e("./runners/node/bootstrap")(t.initializer),global.$_$tracer.start(),n._teardown=t.teardown}catch(f){g(f)}},"in:stop":function(){try{process.nextTick!==v&&(process.nextTick=v),global.$_$tracer.reset(),e("./runners/node/teardown")(this._teardown),delete this._teardown}catch(t){g(t)}p(),delete global.$_$coverage,delete global.$_$tests,delete global.$_$session,delete global.$_$initialSpecId},"in:ping":function(e){this.send({type:"pong",data:e})},"in:tracer.resume":function(){global.$_$tracer.resume()}},t.exports=function(e,t,n,i,s){new y(e,t,n,i,s)}},{"./tracer":21,module:void 0,path:void 0,timers:void 0,ws:void 0}],14:[function(e,t,n){var i,s=e("phantom"),a=e("./runWorkerPool"),r=e("./browserEnvironment"),o=!1,l=function(t){var n=this;i=e("debug")("wallaby:phantomRunner"),n._project=t,n._screenShotReady=Q.when(!0),n._params=t.settings().env.params,n._viewportSize=t.settings().env.viewportSize,n._clearMemoryCache=t.settings().env.clearMemoryCache,n._phantomjsPath=t.settings().env.runner||n._project._phantomjs,n._workerPool=new a(n._project,{create:_.bind(n._createPhantomInstance,n),recycle:_.bind(n._recyclePhantomInstance,n),healthy:_.bind(n._isPhantomInstanceHealthy,n),prepare:_.bind(n._prepare,n)}),n._browserEnvironment=new r(t,n._workerPool)};l.prototype={run:function(e){var t=this;return t._workerPool.run(e)},_createPhantomInstance:function(e,t){var n=this;try{var a={dnodeOpts:{weak:!1}};n._phantomjsPath&&(a.binary=n._phantomjsPath),a.onExit=function(t,n){return"SIGSEGV"!==n||o||(console.error("Looks like the PhantomJs version being used is not supported on your OS.\nTry using a different PhantomJs version (https://wallabyjs.com/docs/integration/phantomjs2.html)\nor Chromium/V8 via Electron runner (https://wallabyjs.com/docs/integration/electron.html)"),o=!0),i("Signal killed phantomjs #%s: %s, exit code: %s",e,n,t)};var r=["--disk-cache=yes","--web-security=false"];n._params.runner&&(r=r.concat(_.filter(n._params.runner.split(" "),function(e){return e&&!(~e.indexOf("--disk-cache=")||~e.indexOf("--web-security="))})));var l=!1;r.push(function(s){if(!l){if(!s)return l=!0,i("Additional attempt to create phantom instance #%s",e),n._createPhantomInstance(e,t);s.set("onError",function(t){i("PhantomJs failure: %s, recycling phantom instance #%s",t,e),n._workerPool.recycleWorker(e)}),l=!0,t(s)}}),r.push(a),s.create.apply(s,r)}catch(c){i("Error while creating worker #%s: %s",e,c&&(c.stack||c.message)),t()}},_recyclePhantomInstance:function(e){e.exit(),e.process.kill()},_isPhantomInstanceHealthy:function(e){return e.process&&e.process.pid&&!e.process.killed&&!e.process.signal&&null===e.process.exitCode},_prepare:function(t,n){var s=this,a=_.randomId(),r=s._browserEnvironment.sandboxName(n,a);return i("Starting sandbox [%s]",r),Q.when().then(function(){return s._workerPool.cancelled()?Q.reject({runCancelled:!0}):(i("Preparing sandbox [%s]",r),Q.all([s._getPage(n),s._browserEnvironment.prepareSandbox(t,a,n)]))}).then(function(o){i("Prepared sandbox [%s]",r);var l=o[0],c=o[1];return Q.when({instance:{resume:function(){l.evaluate(function(){$_$tracer.resume()})},ping:function(e){l.evaluate(function(){},e)},close:function(){t=null,l.stop&&l.stop(),l.close()},closing:function(){s._captureScreenShot(t.screen,l)},start:function(n,i){s._clearMemoryCache&&l.onResourceRequested(function(t,n,i){try{var s=global._urlUtil=global._urlUtil||e("url"),a=t.url;if(!a)return;if(0===a.indexOf("data:"))return;if(~a.indexOf("wallabyFileId"))return;var r=s.parse(t.url),o="/"===r.pathname.charAt(0)?r.pathname.substr(1):r.pathname,c=o&&i[o];if(!c)return;var u=r.search&&r.search.length;n.changeUrl(a+(u?"&":"?")+c.ts+"&wallabyFileId="+c.id),l.clearMemoryCache()}catch(h){console.log(h&&h.message)}},_.noop,t.allFilesHash),l.set("onError",i),l.open(c,function(e){n(e)&&l.evaluate(function(){$_$tracer.start()})})}},name:r,sessionId:a,workerId:n})})},cancel:function(e){var t=this;return t._workerPool.cancel(e)},start:function(){var e=this;return e._workerPool.start(e._browserEnvironment.webApp())},stop:function(){var e=this;e._workerPool.stop()},_captureScreenShot:function(e,t){var n=this,i=Q.defer();try{t.render(e,function(){i.resolve()}),n._screenShotReady=i.promise}catch(s){i.reject(new Error("Failed to render test run screen shot")),console.error("Failed to render test run screen shot",s.message)}},_getPage:function(e){var t=this;return t._workerPool.getWorker(e).then(function(n){return t._workerPool.cancelled()?Q.reject({runCancelled:!0}):(i("Creating page for worker #"+e),t._createPage(n,e))})},_createPage:function(e,t){var n=this;return Q.promise(function(s,a){var r=!1,o=setTimeout(function(){r||(l(),n._workerPool.recycleWorker(t),i("Phantom page is not created in time, recycling it"),a({runCancelled:!0,rerun:!0}))},400),l=function(){r=!0,clearTimeout(o)};try{e.createPage(function(e){r||(l(),i("Phantom page created"),e.set("viewportSize",n._viewportSize||{width:800,height:600}),s(e))})}catch(c){l(),a(c)}})}},t.exports=l},{"./browserEnvironment":4,"./runWorkerPool":19,debug:void 0,phantom:void 0,url:void 0}],15:[function(e,t,n){"use strict";var i=function(){function e(e,t){for(var n in t){var i=t[n];i.configurable=!0,i.value&&(i.writable=!0)}Object.defineProperties(e,t)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},a=function(){function e(t,n,i){s(this,e),this.type=t.type,this.path=t.path,this.content=n,this.maps=[],this.config=i}return i(e,{rename:{value:function(e){return this.newPath=e,this}},changeExt:{value:function(e){var t=this.newPath||this.path;return this.newPath=t.substr(0,t.lastIndexOf(".")+1)+e,this}}}),e}();t.exports=a},{}],16:[function(e,t,n){function i(e){this.process=a.fork(e,["worker"]),this.pid=this.process.pid,this.status=WorkerState.STARTING,this.process.once("message",this.onReady.bind(this)),r.EventEmitter.call(this)}function s(e,t){function n(){var t=new i(e);t.on("ready",s._run.bind(s)),t.process.on("exit",function(e){if(0!==e){for(var i=0;i<s.workers.length;i++)s.workers[i].pid===t.pid&&s.workers.splice(i,1);n()}}),s.workers.push(t)}this.workers=[],this.queue=[];var s=this;t=t||o.cpus().length;for(var a=0;t>a;a++)n()}var a=e("child_process"),r=e("events"),o=e("os"),l=e("util");WorkerState={STARTING:"STARTING",READY:"READY",BUSY:"BUSY"},l.inherits(i,r.EventEmitter),i.prototype.onReady=function(){this.status===WorkerState.STARTING&&(this.status=WorkerState.READY,this.emit("ready",this))},i.prototype.onMessage=function(e,t){e(t),this.status=WorkerState.READY,this.emit("ready",this)},i.prototype.send=function(e,t){this.status=WorkerState.BUSY,this.emit("busy"),this.process.once("message",this.onMessage.bind(this,t)),this.process.send(e)},s.prototype.enqueue=function(e,t){this.queue.push({task:e,callback:t}),process.nextTick(this._run.bind(this))},s.prototype.stop=function(){_.each(this.workers,function(e){e.process.send({type:"exit"})})},s.prototype._run=function(e){if(0!==this.queue.length){if(!e)for(var t=0;t<this.workers.length;t++)if(this.workers[t].status===WorkerState.READY){e=this.workers[t];break}if(e){var n=this.queue.shift();e.send(n.task,n.callback)}}},t.exports={_queue:void 0,start:function(e){this._queue||(this._queue=new s(e))},run:function(e){var t=this;return t._queue?Q.promise(function(n,i){try{t._queue.enqueue(e,function(e){n(e)})}catch(s){i(s)}}):Q.reject(new Error("Processor pool is not started"))},stop:function(){this._queue&&(this._queue.stop(),delete this._queue)}}},{child_process:void 0,events:void 0,os:void 0,util:void 0}],17:[function(e,t,n){"use strict";var i,s,a=function(){function e(e,t){for(var n in t){var i=t[n];i.configurable=!0,i.value&&(i.writable=!0)}Object.defineProperties(e,t)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=e("path"),l=e("minimatch"),c=e("./config"),u=e("./preprocessedFile"),h=!1,d="Processor must pass a string, an object with code property or an error to done function.",f="Processor must be an async function with two params, where last param is done callback, or sync function with one param and returning the result.",v=function(){function t(n,s){r(this,t),this._config=n,this._settingsAreReady=_.isObject(this._config),this._root=s,this._localRoot=this._settingsAreReady?process.cwd():o.dirname(n),i=e("debug")("wallaby:processor")}return a(t,{run:{value:function(e,t,n){var s=this,a=this;return(this._settingsAreReady?Q.when(this._config):c(this._config,this._root)).then(function(r){var o=a._processors(r,t,n);if(!o.length)return i("No %s found for %s",n?"compilers":"preprocessors",t.path),Q.when({content:e,noProcessors:!0});n&&(o=[o[0]]);var l=new u(t,e,r);l.additionalPreset=s._additionalPreset(r);var c=Q.when(l);return i("Running %s processor(s) for %s",o.length,t.path),o.forEach(function(e){c=c.then(function(n){return Q.promise(function(s,a){try{var r=function(e){i("Finished running one processor for %s",t.path);var r;if(e instanceof Error)return void a(e);if(_.isObject(e)){if(!_.isString(e.code))return void a(new Error(d));r=e.code;var o=e.map||e.sourceMap;o&&n.maps.push(o),e.ranges&&(n.ranges=e.ranges)}else{if(!_.isString(e))return void a(new Error(d));r=e}n.content=r,s(n)};if(1===e.length){var o=void 0;try{o=e(n)}catch(l){o=l}finally{r(o)}}else 2===e.length?e(n,r):a(new Error(f))}catch(c){a(c)}})})}),c})}},_additionalPreset:{value:function(t){if(!h){if(t.testFramework&&t.testFramework.version&&0===t.testFramework.version.indexOf("jest"))try{s=e(o.join(this._localRoot,"node_modules/babel-preset-jest"))}catch(n){try{s=e(o.join(this._localRoot,"node_modules/react-scripts/node_modules/babel-preset-jest"))}catch(a){i("WARNING: could not find and load babel-preset-jest preset, it is required for correct jest.mock(...) calls hoisting")}}h=!0}return s}},_processors:{value:function(e,t,n){var i=[],s=n?e.compilers:e.preprocessors;return _.each(s,function(e,n){if(!_.isString(n))throw new Error("Processor patterns object keys must be strings.");if(!_.isArray(e)&&!_.isFunction(e))throw new Error('Processor(s) for "'+n+'" is specified incorrectly, must be an array of functions or a function.');_.isFunction(e)&&(e=[e]),l(t.path,n)&&(i=i.concat(_.map(e,function(e){if(!_.isFunction(e))throw new Error('Processor for "'+n+'" is specified incorrectly, must be an array of functions or a function.');return e})))}),i}}}),t}();t.exports=function(e){return new v(e.config,e.root).run(e.content,e.file,"compiler"===e.type)}},{"./config":6,"./preprocessedFile":15,debug:void 0,minimatch:void 0,path:void 0}],18:[function(require,module,exports){var path=require("path"),Module=require("module").Module,configure=require("./config"),utils=require("./utils"),instrument=require("./instrumentor"),processor=require("./processor"),TestTask=require("./testTask").TestTask,Tracker=require("./tracking"),runPriority=require("./testTask").runPriority,minimatch=require("minimatch"),SourceMapConsumer=require("source-map").SourceMapConsumer,debug,cp=require("child_process"),spawn=cp.spawn,spawnedProcesses={};cp.spawn=function(){"cmd"===arguments[0]&&arguments[1]&&arguments[1].length>=3&&"/d"===arguments[1][0]&&"/c"===arguments[1][1]&&(arguments[0]=arguments[1][2],arguments[1].splice(0,3));var e=spawn.apply(this,arguments);try{var t=e.pid;e.on("exit",function(){t&&delete spawnedProcesses[t]}),spawnedProcesses[t]=e}catch(n){}return e};var testPathSeparator="^#^",runAlways=1,runOneTime=2,bundleFileId="bundle",Project=function(e){var t=this;t._structureFileFormatVersion=12,t._wallabyEmail="wallabyjs@gmail.com",t._diffMatchPatch=e.diffMatchPatch,t._processorPool=e.processorPool,t._runnerResolver=e.runnerResolver,t._fileStructureCachePromise=e.fileStructureCachePromise,t._fileStatPromise=e.fileStatPromise,t._readFilePromise=e.readFilePromise,t._writeFilePromise=e.writeFilePromise,t._unlinkFilePromise=e.unlinkFilePromise,t._unlinkFileSync=e.unlinkFileSync,t._readFileSync=e.readFileSync,t._writeFileSync=e.writeFileSync,t._fileExistsSync=e.fileExistsSync,t._dirRemovePromise=e.dirRemovePromise,t._dirRemoveSync=e.dirRemoveSync,t._dirEnsurePromise=e.dirEnsurePromise,t._dirEnsureSync=e.dirEnsureSync,t._lruCache=require("lru-cache")({max:52428800,length:function(e){return e.length}});var n,i;t._configFile=e.configPath,t._phantomjs=e.phantomjs,process.env.quokka?(require("os").homedir||(require("os").homedir=function(e){var t=process.env["win32"===process.platform?"USERPROFILE":"HOME"];return e?path.join(t,e):t}),t._quokkaGlobalSettingsDir=path.join(require("os").homedir(),".quokka"),t._quokkaTempDir=path.join(t._quokkaGlobalSettingsDir,"data",utils.randomId()),t._quokkaGlobalSettingsFile=path.join(t._quokkaGlobalSettingsDir,"config.json"),t._root="quokka_fake_path",t._localRoot=process.cwd(),t._originalRoot=path.join("quokka_fake_path","original"),t._instrumentedRoot=path.join("quokka_fake_path","instrumented"),t._phantomjs=path.join("quokka_fake_path","phantomjs"),t._editorTypeScript=e.editorTypeScript,t._quokkaFileName=e.quokka,t._writeFileSync(path.join(t._localRoot,t._quokkaFileName)," "),t._writeFileSync(path.join(t._originalRoot,t._quokkaFileName)," "),t._fullInstrumentedPathForTestRunner=function(e){return e.instrumentedPath.replace(t._instrumentedRoot,t._localRoot)}):(t._root=e.projectCachePath,t._configFile=e.configPath,t._localRoot=path.dirname(t._configFile),t._phantomjs=e.phantomjs,t._originalRoot=path.join(t._root,"original"),t._instrumentedRoot=path.join(t._root,"instrumented")),n=path.join(t._localRoot,"node_modules"),t._nodeModules=t._fileExistsSync(n)?n:void 0,t._packageJson=path.join(t._localRoot,"package.json"),t._babelrc=path.join(t._localRoot,".babelrc"),t._localProjectDir=t._localRoot+path.sep,i=path.join(t._instrumentedRoot,"node_modules"),t._screenPath=path.join(t._instrumentedRoot,"screen.png"),t._structureFile="structure.json",!process.env.quokka&&t._nodeModules&&e.nodeModulesLookup(function(e){e.push(n)},function(e){return e.replace(i,n)}),process.env.quokka&&(e.dirEnsureSync(t._quokkaGlobalSettingsDir),e.dirEnsureSync(t._quokkaTempDir),e.dirEnsureSync(path.join(t._quokkaTempDir,"node_modules")),e.cidFile=path.join(t._quokkaGlobalSettingsDir,".qid"),t._fileExistsSync(t._quokkaGlobalSettingsFile)||t._writeFileSync(t._quokkaGlobalSettingsFile,"{}"),t._loadQuokkaSettings(),e.edition=t._quokkaSettings.quokka.edition||""),t._live=!1,t._sourceFileCache={},t._changeQueue={},t._testTask=new TestTask(t),t._tracker=new Tracker(e,process.env.quokka?path.dirname(process.mainModule.filename):t._root),t._init=e._init,t._coreVersion=e.coreVersion};Project.prototype=_.extend(Object.create(EventEmitter.prototype),{configure:function(e){var t=function(){return e.apply(this,arguments)};return t.toString=function(){return e.toString()},t}(function(){var e=this;return(process.env.quokka?Q.when(e._quokkaSettings):configure(e._configFile,e._instrumentedRoot,e._forceConfigUpdate)).then(function(t){e._settings=t,e._settings&&e._settings.debug&&(process.env.DEBUG="wallaby:.*",process.env.DEBUG_FD=1),debug=require("debug")("wallaby:project"),process.env.quokka||(debug("Wallaby config: %s",e._configFile),_.isArray(t.postprocessor)&&(t.postprocessor=e._configureComplexPostprocessor(t.postprocessor)),t.configCode=e._readFileSync(e._configFile)),t.telemetry&&e._tracker.start(),t.extensions&&t.extensions.javascript&&t.extensions.javascript.length||(e._isJavaScriptWithCustomExtension=function(){return!1});var n=t.files.length;e._emit({type:"projectConfigured",name:t.name,browser:"browser"===t.env.type,editDelay:t.delays.edit,files:_.map(t.files.concat(t.tests),function(e,t){return t>=n&&(e.test=!0),e})})}).fail(function(t){e._cleanStack(t,e._configFile),console.error("Failed to load configuration file: ",t&&(t.stack||t.message)),e._emitTestRunError(t&&(t.stack||t.message))})}),_loadQuokkaSettings:function(e){try{var t={globalConfigFile:this._quokkaGlobalSettingsFile,tempDir:this._quokkaTempDir};try{_.merge(t,require(this._quokkaGlobalSettingsFile))}catch(n){}try{_.merge(t,require(this._packageJson).quokka)}catch(n){}if(e&&_.merge(t,e),this._quokkaSettings={quokka:{edition:t.pro?"pro":"",installPackage:{command:t.installPackageCommand||"npm install {packageName}",dir:t.tempDir}},files:[],tests:[{pattern:this._quokkaFileName,ignore:!1,instrument:!0,trigger:!0,load:!0}],env:{type:"node",runner:process.execPath,params:{}},compilers:{},preprocessors:{},testFramework:{version:"quokka@1.0.0",configurator:"",reporter:"",starter:""},delays:{edit:0},workers:{recycle:!1,regular:1,initial:1},maxConsoleMessagesPerTest:1/0,autoConsoleLog:!0,debug:t.debug,reportConsoleErrorAsError:!0,telemetry:!0},_.endsWith(this._quokkaFileName,".ts")||_.endsWith(this._quokkaFileName,".tsx")){delete t.babel;var i;t.ts=t.ts||{},_.isObject(t.ts)||(t.ts={});var s=t.ts.compilerOptions||{},a=t.ts.path;if(a){a=path.resolve(a);try{i=require(a),t.ts.path=a}catch(n){return void(this._quokkaSettings.error='Configured to use "'+a+'" as TypeScript path, but can not find the `typescript` module')}}if(!i)try{a=path.join(this._localRoot,"node_modules","typescript"),i=require(a)}catch(r){try{a=path.join(this._quokkaGlobalSettingsDir,"node_modules","typescript"),i=require(a)}catch(o){try{a=path.resolve(this._editorTypeScript),i=require(a)}catch(l){i=require("typescript"),a=path.join(path.dirname(process.mainModule.filename),"node_modules/typescript")}}}s.module="commonjs",process.env.TS_NODE_COMPILER=a,process.env.TS_NODE_COMPILER_OPTIONS=JSON.stringify(s);var c={typescript:i,files:{"**/*.ts?(x)":s}};this._quokkaSettings.postprocessor=require("./typeScriptPostprocessor")(this._localRoot)(c),t.ts.path=a,t.ts.version=i.version;var u=path.join(this._quokkaGlobalSettingsDir,"node_modules","ts-node"),h=path.join(this._localRoot,"node_modules","ts-node");if(this._quokkaGlobalSettingsDir!==this._localRoot||this._fileExistsSync(u)){var d=u;this._fileExistsSync(d)||(d=h,this._fileExistsSync(d)||(t.ts.tsNode=!1,d=!1)),d&&(t.ts.tsNode={path:d})}else t.ts.tsNode=!1}else if(t.babel){delete t.ts,_.isObject(t.babel)||(t.babel={}),process.env.BABEL_ENV||(process.env.BABEL_ENV=t.babel.env||"test");var f;try{var v=t.babel.path&&path.resolve(t.babel.path)||path.join(this._localRoot,"node_modules","babel-core");this._fileExistsSync(v)||(v=path.join(this._quokkaGlobalSettingsDir,"node_modules","babel-core")),f=require(v),t.babel.path=v}catch(n){return void(this._quokkaSettings.error="Configured to use babel, but can not find babel-core module")}this._quokkaSettings.compilers[this._quokkaFileName]=require("./babelCompiler")(this._localRoot)(_.extend({babel:f},_.omit(t.babel,"env","path","polyfill"))),t.babel.version=f.version}else delete t.babel,delete t.ts;process.env.quokka=JSON.stringify(t)}catch(n){this._quokkaSettings=this._quokkaSettings||{},this._quokkaSettings.error=n.message}this._emitInternal(_.extend({type:"configChanged",settings:this._quokkaSettings},t,{nodeVersion:process.version}))},_configureComplexPostprocessor:function(e){var t=this;if(2!=e.length)throw new Error("Only TypeScript postprocessor chaining is supported");var n=e[0],i=!1;n.filePatterns&&n.filePatterns.length>1&&(i=!0,t._overrideFileType=function(e,t,s){return"ts"!==e&&i&&t!==s&&n.filePatterns&&_.find(n.filePatterns,function(e){return minimatch(t,e)})?"ts":void 0});var s=e[1];return function(e){return _.each(e.affectedFiles,function(e){var n=t._structure.filesById[e.id];n&&!t._isOriginallyVue(n)&&t._deleteDependantFilesMetadata(n)}),n(e).then(function(n){if(n.removePostprocessor)t._settings.postprocessor=s,debug("TypeScript postprocessor is removed as requested by itself"),i=!1;else{var a=function(e){var n=t._createPostProcessorInputFile(e);return e.originalId&&(n.id=e.originalId,n.originalType=e.originalType),n},r=function(e){return e&&(_.isEmpty(e.dependant)&&(!e.tmp||e.originalId&&!t._isOriginallyVue(t._structure.filesById[e.originalId]))||t._isOriginallyVue(e))},o=function(e){var n=t._structure.filesById[e.id];return!n||_.isEmpty(n.dependant)||t._isOriginallyVue(n)?n:_.values(n.dependant)[0]};t._updateFileOrder();var l=_.chain(t._structure.testFilesInOrder).filter(r).map(a).value(),c=_.chain(t._structure.sourceFilesInOrder).filter(r).map(a).value().concat(l),u=_.chain(e.affectedFiles).map(o).filter(r).map(a).value(),h=_.chain(e.affectedTestFiles).map(o).filter(r).map(a).value();e=_.extend(e,{allTestFiles:l,allFiles:c,affectedFiles:u,affectedTestFiles:h})}return s(e)})}},configFilePath:function(){return this._configFile},coreVersion:function(){return this._coreVersion},projectName:function(){return this._settings.name||path.basename(this._localRoot)},start:function(e){var t=this,n=t._init(e,t);return t._emitInternal({type:"starting",files:e.files}),n.then(function(){return t._live&&t.stop(),Q.when(!0)}).then(function(){return debug("File cache: %s",t._root),t._live=!1,Q.all([t._dirEnsurePromise(t._originalRoot),t._dirEnsurePromise(t._instrumentedRoot)])}).fail(function(e){return t._cleanStack(e),t._emitTestRunError(e.stack||e.message),Q.reject({error:e})}).then(function(){return t._fileStructureCachePromise(path.join(t._root,t._structureFile))}).fail(function(e){return e&&e.error?Q.reject(e.error):Q.when({})}).then(function(e){var n=function(){return t._dirRemovePromise(t._instrumentedRoot).then(function(){return t._dirEnsurePromise(t._instrumentedRoot)})};return Q.all([t._fileStatPromise(t._packageJson).then(function(e){return Q.when(e.mtime.getTime())}).fail(function(){return Q.when(0)}),t._fileStatPromise(t._babelrc).then(function(e){return Q.when(e.mtime.getTime())}).fail(function(){return Q.when(0)})]).then(function(i){var s=i[0],a=i[1];return e.invalidateCache?(debug("Invalidating local cache as requested"),n().then(function(){return Q.when({packageJsonTimestamp:s,babelrcTimestamp:a})})):s!==e.packageJsonTimestamp?(debug("package.json file change detected, invalidating local cache"),n().then(function(){return Q.when({packageJsonTimestamp:s,babelrcTimestamp:a})})):a!==e.babelrcTimestamp?(debug(".babelrc file change detected, invalidating local cache"),n().then(function(){return Q.when({packageJsonTimestamp:s,babelrcTimestamp:a})})):e.configCode!==t._settings.configCode||t._structureFileFormatVersion!==e.version?(debug("Config file change detected, invalidating local cache"),n().then(function(){return Q.when({packageJsonTimestamp:s,babelrcTimestamp:a})})):(e.packageJsonTimestamp=s,e.babelrcTimestamp=a,Q.when(e))})}).then(function(n){t._structure=_.extend({filesByPath:{},
filesRenamed:{},filesById:{},testFilesById:{},awaitingFiles:[],configCode:t._settings.configCode},n),t._structure.awaitingFiles=[],t._structure.sourceFilesInOrder=[],t._structure.testFilesInOrder=[],t._structure.notifiedAboutWallabyApp||(process.env.quokka||console.log("Wallaby App available at: http://wallabyjs.com/app/#/files"),t._structure.notifiedAboutWallabyApp=!0);var i=_.reduce(e.files,function(e,t){return e[t.path]=!0,e},{});_.each(t._structure.filesByPath,function(e){if(!i[e.path]){var n=t._deleteFileMetadata(e);n&&(t._unlinkFilePromise(n.originalPath),t._unlinkFilePromise(n.instrumentedPath))}});var s=[],a=!!process.env.quokka;_.each(e.files,function(e){var n=e.path;if(e.test||_.find(t._settings.tests,function(t){return t.ignore&&minimatch(e.path,t.pattern)}))a=!0;else{var i=_.find(t._settings.tests,function(t){return!t.ignore&&minimatch(e.path,t.pattern)});i&&console.error("File/pattern "+e.path+" is specified in the files list but also found in the tests list: "+i.pattern+".\r\n	If it's a test, make sure to exclude it from the files list, for example by adding { pattern: '"+i.pattern+"', ignore: true } to the files list.\r\n	If it's not a test, remove it from the tests list.")}var r=t._structure.filesByPath[n],o=r&&r.id===e.id,l=!1;r?(r=t._createFileMetadata(r,e.id),e.order&&(r.order=e.order),r.ts!==e.ts&&(t._structure.awaitingFiles.push(e.id),l=!0)):(r=t._createFileMetadata(e,e.id),t._structure.awaitingFiles.push(e.id),l=!0),l||s.push(t._readFilePromise(r.originalPath).fail(function(){return debug("No cached file "+e.path+", requesting it from IDE"),t._structure.awaitingFiles.push(e.id),Q.when(!1)}).then(function(n){return n===!1?Q.when(!1):(n=n?r.binary?n.toString("base64"):n.toString():"",o?t._readFilePromise(r.instrumentedPath).fail(function(){return debug("No instrumented file "+e.path+", re-instrumenting original file"),t._processFile(r,n,void 0,!0,!1)}):(debug("Re-instrumenting original file because its ID has changed"),t._processFile(r,n,void 0,!0,!1)))}))}),a||console.error("No files with tests found, check your tests list patterns."),t._fileOrderUpdatePending=!0;var r=t._runnerResolver(t._settings.env.type,t._settings.env.kind);return t._testRunner=new r(t),Q.all(s.concat([t._testRunner.start()]))}).fail(function(e){return t._signalIfBecameLive(),t._emitTestRunError(e.message),t._cleanStack(e),Q.reject(e)}).then(function(){t._signalIfBecameLive()?(debug("File cache is up-to-date, starting full test run"),t._queueTestRunFromFileChanges(null,!0),t._scheduleTestRun()):(debug("File cache requires some updates, waiting required files from IDE"),t._emit({type:"filesRequired",files:t._structure.awaitingFiles}))})},file:function(e){var t=this;return t._emitInternal({type:"file",file:e.file,"delete":e["delete"]}),process.env.quokka&&!e.inEditor?void t._filesAreUpToDate([e.file.id]):Q.promise(function(n,i){try{t._tryCancelActiveTestRun(runPriority.fileChangePriority),t._queueFileChange(e),t._scheduleChangedQueueProcessing(),n()}catch(s){i(s)}})},runTests:function(e){var t=this;t._tryCancelActiveTestRun(e.notManualRun?runPriority.fileChangePriority:runPriority.testRunPriority),e.tests?t._queueRequestedTestRun(e.tests):t._queueFullTestRun(),e.notManualRun||t._testTask.setManualRun(),t._scheduleTestRun()},screen:function(e){var t=this;return t._settings&&"browser"===t._settings.env.type?t._testRunner._screenShotReady.then(function(){return t._readFilePromise(t._screenPath)}).fail(function(){return debug("Unable to load test run screen shot"),Q.when(!1)}).then(function(n){n&&t._emit({type:"screen",screen:new Buffer(n).toString("base64")},e)}):Q.when(!1)},stop:function(){var e=this;if(e._live=!1,e._tracker.dispose(),e._quokkaTempDir)try{e._dirRemoveSync(e._quokkaTempDir)}catch(t){}(debug=debug||_.noop)("Stopping wallaby.js");try{e._unlinkFileSync(path.join(e._root,e._structureFile))}catch(t){}if(debug("Killing %s spawned process(es)",_.keys(spawnedProcesses).length),_.each(spawnedProcesses,function(e){try{e.kill()}catch(t){}}),e._multicaster&&e._multicaster.stop(),e._flushSourceFileCacheSync(),e._uiService&&e._uiService.stop(),debug("Stopping test runner"),e._testRunner&&e._testRunner.stop(),e._structure){var n={version:e._structureFileFormatVersion,filesByPath:e._structure.filesByPath,configCode:e._structure.configCode,packageJsonTimestamp:e._structure.packageJsonTimestamp,babelrcTimestamp:e._structure.babelrcTimestamp,invalidateCache:e._invalidateCache,notifiedAboutWallabyApp:e._structure.notifiedAboutWallabyApp};_.each(n.filesByPath,function(t,i){delete t.changeTs,delete t.changeStart,delete t.changePosition,delete t.numberOfFunctionsChanged,delete t.lastChangeIsComplex,delete t.relatedFilesWithTests,delete t.lastSingleChangeTest,delete t.dependant,delete t.tmpLineMap,delete t.noCompilers,delete t.noPreprocessors,delete t.sourceMap,delete t.testFilesLoadedFrom,delete t.tests,t.tmp&&!t.notStored&&(delete n.filesByPath[i],e._unlinkFileSync(t.instrumentedPath))});var i=JSON.stringify(n);debug("Saving file structure"),e._writeFileSync(path.join(e._root,e._structureFile),i)}},idByPath:function(e){var t=this._structure.filesByPath[e];if(t)return t.id},invalidateCache:function(){this._invalidateCache=!0},settings:function(){return this._settings},_cleanStack:function(e,t){if(e){if(t){if(e.stack&&_.isString(e.stack)){var n=path.basename(t),i=e.stack.toString().match(new RegExp("[\\s\\S]*"+n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+"[^\\)]*\\)","i"));i&&i[0]?e.stack=i[0]:e.stack=""}}else if(e.stack&&_.isString(e.stack)){var s=path.dirname(process.mainModule.filename),a=!1;e.stack=this._cleanMessage(_.filter(e.stack.split("\n"),function(e,t){return a||(a=_.contains(e,"quokkaStackTraceMarker")),!(a||t&&(_.contains(e,s)||_.contains(e,"From previous event:")))}).join("\n"))}else e.stack="";return e}},_cleanMessage:function(e){return e&&_.isString(e)?e.replace(this._instrumentedRoot,"."):e},_startProcessorPool:function(){var e=this;debug("Starting processor pool (if not yet started)"),e._processorPool.start(process.mainModule.filename)},_tryCancelActiveTestRun:function(e){var t=this;t._runCancelRequester=e;var n=t._testRunner&&t._testRunner.cancel(e);n?debug("Test run was cancelled"):n===!1&&debug("Test run is not cancelled because cancel requester does not have enough priority to cancel the run")},_originalLineByFileId:function(e,t){var n=this,i=n._structure.filesById[e];return i&&i.getFileLineMap()?i.getFileLineMap()[t]:t},_originalLineByFilePath:function(e,t){var n=this,i=n._structure.filesByPath[e];return i&&i.getFileLineMap()?i.getFileLineMap()[t]:t},stackEntryByFileId:function(e,t){var n=this;if(e===bundleFileId){var i=n._structure.filesById[bundleFileId];if(!i)return;var s=i.fileAndLineByLine(t);if(!s||!_.isNumber(s[0])||!n._structure.filesById[s[0]])return;e=s[0],t=s[1]}var a={file:e};return a.line=n._originalLineByFileId(a.file,t),a},stackEntryByFilePath:function(e,t){var n=this,i=n._structure.filesByPath[e]||n._structure.filesByPath[n._structure.filesRenamed[e]||""];if(i&&(!i.tmp||(i=n._structure.filesById[i.originalId]))){e=i.path;var s={file:i.id};return s.line=n._originalLineByFilePath(e,t),s}},_emit:function(e,t){t&&t.id&&(e.id=t.id),this.emit("message",e)},_emitInternal:function(e,t){e._internal=!0,this._emit(e,t)},_isJavaScript:function(e){var t=this;return this._isOriginallyJavaScript(e)||"js"===e.instrumentedType||"jsx"===e.instrumentedType||"es6"===e.instrumentedType||this._isJavaScriptWithCustomExtension(e.instrumentedType)||_.find(e.dependant,function(e){return t._isJavaScript(e)})},_isOriginallyJavaScript:function(e){return"js"===e.type||"jsx"===e.type||"es6"===e.type||this._isJavaScriptWithCustomExtension(e.type)},_isJavaScriptWithCustomExtension:function(e){return _.find((this._settings.extensions||{}).javascript||[],function(t){return t===e})},_isOriginallyVue:function(e){return e&&"vue"===e.type},_isOriginallyCoffeeScript:function(e){return"coffee"===e.type||/\.(litcoffee|coffee\.md)$/.test(e.originalPath)},_isOriginallyTypeScript:function(e){return"ts"===e.type},_runTests:function(e){var t=this,n=e.isFullRun(),i=e.isManualRun(),s=e.isFileChangedRun(),a=e.files(),r=e.testData(),o=r&&r.files,l=r&&r.names,c=e.getPriority();if(n&&debug("Running all tests"),s&&o&&_.isEmpty(o)&&!_.find(a,function(e){return t._isJavaScript(e)}))return Q.when({queueAgain:!0});t._updateFileOrder();var u=t._structure.sourceFilesInOrder,h=o?t._orderFilesByConfig(t._expandDependantFiles(o)):t._structure.testFilesInOrder,d=_.find(u.concat(h),function(e){return t._isJavaScript(e)&&!e.validSyntax&&e.coverable});if(d)return Q.when({queueAgain:!0,file:d.path});var f=t._selectRunnerFiles(h),v=t._selectRunnerFiles(u);if(!f.length&&a){var p=_.map(a,function(e){return e.id});_.isEqual(p,t._lastChangedFileIds)||(t._lastChangedFileIds=p),t._settings.loose?console.log("Can't determine tests to run for the change, try re-running all tests.\nTo perform a full test run when can not determine tests to run, remove the `loose` configuration option."):(console.log("Can't determine tests to run for the change, re-running all tests.\nTo prevent the full test run when can not determine tests to run, use `loose: true` configuration option."),f=t._selectRunnerFiles(t._structure.testFilesInOrder),l=void 0,n=!0,c=e.getFullRunPriority(),debug("Test task priority upgraded to full run"))}else delete t._lastChangedFileIds;var g;return process.env.quokka&&t._recycleRunner&&(delete t._recycleRunner,g=!0),t._testRunner.run({framework:t._settings.testFramework,fullRun:n,screen:t._screenPath,filesToLoad:_.filter(v,function(e){return e.include}),allFiles:v,testFilesToLoad:_.filter(f,function(e){return e.include}),allTestFiles:f,tests:l,priority:c,manualRun:i,recycleBeforeRun:g}).then(function(e){return _.each(a,function(e){delete e.testFilesLoadedFrom}),e.testFiles=_.filter(f,function(e){return!e.tmp}),Q.when(e)})},_expandDependantFiles:function(e){return _.each(e,function(t){_.extend(e,t.dependant||{})}),e},_fullInstrumentedPathForTestRunner:function(e){return e.instrumentedPath},_selectRunnerFiles:function(e){var t=this;return _.map(e,function(e){var n=path.relative(t._instrumentedRoot,e.instrumentedPath);return{path:t._fullInstrumentedPathForTestRunner(e),relativePath:n,normalizedRelativePath:t.normalizePath(n),ts:e.changeTs,id:e.id,tmp:e.tmp,originalId:e.originalId,originalType:e.originalType,include:e.include,type:e.instrumentedType||e.type,rangesLength:e.ranges&&e.ranges.length||0,shadowed:!_.isEmpty(e.dependant),content:process.env.quokka?t._getInstrumentedFileContent(e):void 0}})},_queueFileChange:function(e){var t=this;if(!e.file)throw new Error("File is missing");var n=e.file.id;if(!n)throw new Error("File id is missing");var i=t._changeQueue[n]=t._changeQueue[n]||[];i.push(e)},_emitBusy:function(){this._emit({type:"busy"}),this._tracker.busy()},_scheduleChangedQueueProcessing:function(){var e=this;e._emitBusy(),e._changedQueueTimeout&&clearTimeout(e._changedQueueTimeout),e._changedQueueTimeout=setTimeout(function(){if(e._fileChangesInProcess||e._testRunInProgress||!e._structure)return void e._scheduleChangedQueueProcessing();e._emitBusy(),delete e._changedQueueTimeout,e._fileChangesInProcess=!0;var t=!e._live;e._processChangedQueue().then(function(n){e._fileChangesInProcess=!1,n.length&&_.find(n,function(e){return e.file.triggersTests})?(e._queueTestRunFromFileChanges(n,t&&e._live),!e._pendingChanges()&&e._live&&e._scheduleTestRun()):debug("Changes did not trigger any tests")}).fail(function(t){debug("Test queueing failure: "+t&&(t.stack||t.message)),e._cleanStack(t),e._emitTestRunError(t&&t.message)})},e._settings.delays.update)},_pendingChanges:function(){return!_.isEmpty(this._changeQueue)},_queueTestRunFromFileChanges:function(e,t){var n=this;if(t)n._queueFullTestRun();else if(!n._testTask.isFullRun()){n._testTask.setFileChangeRunPriority();var i=!1,s=!1;_.each(e,function(e){i=i||e.added,s=s||e.deleted;var t=e.file;e.deleted?n._testTask.addTests(e.tests):n._testTask.addChangedFile(t,e.tests)}),i&&n._testTask.filesAdded(),s&&n._testTask.filesDeleted()}},_queueRequestedTestRun:function(e){var t=this;t._testTask.addTests(e),t._testTask.setTestRunPriority()},_queueFullTestRun:function(){var e=this;e._testTask=new TestTask(e),e._testTask.setFullRunPriority()},_scheduleTestRun:function(){var e=this;e._emitBusy(),e._testTask&&process.env.quokka&&e._testTask.setFileChangeRunPriority(),e._testRunTimeout&&clearTimeout(e._testRunTimeout),e._testRunTimeout=setTimeout(function(){if(e._fileChangesInProcess||e._testRunInProgress)return void e._scheduleTestRun();e._emitBusy(),delete e._testRunTimeout,delete e._runCancelRequester,e._testRunInProgress=!0;var t=e._testTask;e._testTask=new TestTask(e),t&&t.anyFilesAdded()&&e._removedPostprocessor&&!e._settings.postprocessor&&_.find(t.files(),function(t){return e._isOriginallyTypeScript(t)})&&(debug("TypeScript file has been added, re-activating TypeScript postprocessor"),e._settings.postprocessor=e._removedPostprocessor,delete e._removedPostprocessor);var n={},i=[];(e._settings.postprocessor?Q.promise(function(n,s){try{if(t.isManualRun()&&!t.isFullRun())return void n();debug("Running postprocessor");var a=t.testData(),r=e._settings.env.bundle&&(t.anyFilesAdded()||t.anyFilesDeleted()),o=e._createPostProcessorArgument({bundleAllowed:r,affectedFiles:_.values(t.files()),affectedTestFiles:a&&a.files,anyFilesAdded:t.anyFilesAdded(),anyFilesDeleted:t.anyFilesDeleted(),logger:{error:function(t){var n={stack:t};e._cleanStack(n),i.push({message:n.stack})}}});!o.anyFilesAdded&&!o.anyFilesDeleted||e._settings.postprocessor.ts||e._deleteTmpFiles(),n(e._settings.postprocessor(o).then(function(t){return r&&o.bundle.length?e._buildBundle(o.bundle).then(function(){return t}):t})["catch"](function(e){return Q.reject(e)}))}catch(l){s(l)}}).fail(function(n){return e._runCancelRequester>=t.getPriority()?Q.reject({runCancelled:!0}):(debug("Postprocessor run failure: "+n&&(n.stack||n.message)),n.postprocessor=!0,Q.reject(n))}).then(function(i){return e._runCancelRequester>=t.getPriority()?Q.reject({runCancelled:!0}):(i&&(debug("Postprocessor execution finished"),i.removePostprocessor&&(debug("Postprocessor is removed as requested by itself"),e._removedPostprocessor=e._settings.postprocessor,delete e._settings.postprocessor),_.isEmpty(i.testDependencies)||(n=i.testDependencies)),Q.when(!0))}):Q.when(!0)).then(function(){return debug("Test run started; run priority: %s",t.getPriority()),e._runTests(t)}).fail(function(t){return t.runCancelled?(debug("Test run cancelled, re-queueing run data"),Q.when({queueAgain:!0,rerun:t.rerun})):t.postprocessor?(e._emitTestRunError("Postprocessor run failure: "+(t&&t.message)),Q.when({queueAgain:!0,testErrorReported:!0})):(e._emitTestRunError("Test run failure: "+(t&&t.message)),Q.when(!1))}).then(function(s){if(debug("Test run finished"),_.isEmpty(n)||_.each(s.loadingSequence,function(e,t){s.loadingSequence[t]=_.keys(_.reduce((e||[]).concat(n[t]||[]),function(e,t){return e[t]=!0,e},{}))}),delete e._runCancelRequester,e._testRunInProgress=!1,s)if(i.length&&(s.globalErrors=(s.globalErrors||[]).concat(i)),s.queueAgain)s.file&&(debug("File has invalid syntax: "+s.file),e._emitTestRunError("Test run failure: file "+s.file+" has invalid syntax"),s.testErrorReported=!0),(!s.file||t.hasFiles())&&(e._testTask.mergeTask(t),debug("Test run data re-queued"),e._emit({type:"testRunReQueued",rerunScheduled:s.rerun,testErrorReported:s.testErrorReported})),s.rerun&&e._scheduleTestRun();else{var a=s.globalErrors&&s.globalErrors.length,r=a||e._hadGlobalErrorsPreviousRun;e._hadGlobalErrorsPreviousRun=a,a&&s.testFiles&&(e._lastAffectedTestFileIds=_.map(s.testFiles,function(e){return e.id})),s.changed=t.isFullRun()?!0:_.reduce(t.files(),function(e,t){var n=!!t.lastSingleChangeTest;return delete t.lastSingleChangeTest,e[t.id]={singleTestChange:!r&&n},e},{}),e._emit(e._processCoverageResult({time:s.time,type:"testResults",fullRun:t.isFullRun()},s)),debug("Test run result processed and sent to IDE")}}).fail(function(e){debug("Failed to process test run results",e.stack),console.error("Failed to process test run results",e.message)})},e._settings.delays.run)},_buildBundle:function(e){var t=this,n=1/0,i="",s=[],a=1;_.each(e,function(e){e.file.include=!1,e.file.notStored=!0;var t=e.content+"\n";n=Math.min(n,e.file.order);var r=utils.textLines(t).length,o=a,l=a-1+r-1,c=[o,l];c.file=e.file.originalId,s.push(c),a=l+1,i+=t});var r={id:bundleFileId,path:"____wallaby-bundle.js",ts:+new Date,tmp:!0,type:"js",instrumentedType:"js",include:!0,order:n,test:!1},o=t._createFileMetadata(r,r.id);return o.originalId=r.id,o.fileAndLineByLine=function(e){for(var t,n=0,i=s.length-1;i>=n;){t=Math.floor((i+n)/2);var a=s[t];if(e>=a[0]&&e<=a[1])return[a.file,e-a[0]+1];e>a[1]?n=t+1:i=t-1}},t._fileOrderUpdatePending=!0,t._doWriteFileWithLruCache(o.instrumentedPath,i)},hadGlobalErrorsPreviousRun:function(){return this._hadGlobalErrorsPreviousRun},_emitTestRunError:function(e){var t=this;t._emit({type:"testRunError",message:t._cleanMessage(e)})},_deleteDependantFiles:function(e,t){var n=this;return t||(t=[]),_.each(e.dependant,function(e){t.push(n._unlinkFilePromise(e.instrumentedPath).fail(function(){return Q.when()})),n._deleteDependantFiles(e,t)}),t},_processChangedQueue:function(){var e=this,t=[],n=[];_.each(e._changeQueue,function(i,s){s=parseInt(s,10);var a=!1,r=!1,o=e._structure.filesById[s],l=[],c=[];if(_.each(i,function(e){return e["delete"]?void(a=e):(l.push(e),c=c.concat(e.file.affectedTests||[]),void(r=e.file.test||o&&o.test))}),c.length||r&&a||(c=r?[[s]]:o&&_.map(o.tests,function(e,t){return e===runOneTime&&delete o.tests[t],t.split(testPathSeparator)})||[]),r&&(e._lastAffectedTestFileIds=a?void 0:[s]),a){var u=e._structure.filesByPath[a.file.path];if(u){if(t=t.concat(e._deleteDependantFiles(u)),e._deleteFileMetadata(a.file),r){var h=u.path;_.each(e._structure.filesById,function(e){_.each(e.tests,function(t){(t===h||_.startsWith(t,h+testPathSeparator))&&delete e.tests[t]})})}t.push(e._deleteSourceFile(u.originalPath)),t.push(e._unlinkFilePromise(u.instrumentedPath)),n.push({file:u,deleted:!0,tests:u.test?[]:c})}}else if(l.length){var d=_.last(l),f=e._getOrCreateFileMetadata(d.file);t.push(e._writeFileChanges(f,_.map(l,function(e){return e.file.content}),d.file.ts)),n.push({file:f,tests:c,added:!o})}}),e._changeQueue={};var i=function(){e._filesAreUpToDate(_.map(n,function(e){return e.file.id}))};return Q.all(t).then(function(){return i(),Q.when(n)}).fail(function(t){return debug("File system update failure: "+t&&(t.stack||t.message)),i(),e._cleanStack(t),e._emitTestRunError(t&&t.message),Q.when([])})},normalizePath:function(e){return e?e.split(path.sep).join("/"):e},_createPostProcessorArgument:function(e){var t=this;e=e||{};var n=t._createPostProcessorInputFile.bind(t),i=function(e){return!e.tmp};t._updateFileOrder();var s=_.chain(t._structure.testFilesInOrder).filter(i).map(n).value(),a=_.chain(t._structure.sourceFilesInOrder).filter(i).map(n).value().concat(s),r=e.affectedFiles&&e.affectedFiles.length&&_.chain(e.affectedFiles).filter(i).map(n).value()||a,o=e.affectedTestFiles&&e.affectedTestFiles.length&&_.chain(e.affectedTestFiles).filter(i).map(n).value()||s;delete e.affectedFiles,delete e.affectedTestFiles;var l=e.bundleAllowed;return _.extend({},{bundle:[],anyFilesAdded:!0,anyFilesDeleted:!1,allFiles:a,allTestFiles:s,affectedFiles:r,affectedTestFiles:o,nodeModulesDir:t._nodeModules,baseDir:t._instrumentedRoot,tsPostprocessorOnly:t._settings.postprocessor.ts,setFileOrder:function(e){if(e.file&&e.file.id){t._fileOrderUpdatePending=!0;var n=t._getFileMetadataById(e.file.id);n&&(n.order=e.order)}return Q.when(e.order)},createFile:function(e){var n=this,i=_.ltrim(path.extname(e.path),"."),s=t.normalizePath(e.path),a=_.extend(e,{id:s,path:s,ts:e.ts||+new Date,tmp:!0,type:i,instrumentedType:i,include:e.load!==!1,order:e.order||0,test:e.test||e.test!==!1&&e.original&&e.original.test}),r=t._createFileMetadata(a,a.id);t._fileOrderUpdatePending=!0;var o=l&&!r.test&&"original"in e&&e.content&&0===e.content.indexOf("window.__moduleBundler.cache"),c=e.original&&e.original.id&&e.ranges&&e.sourceMap;if(e.original&&e.original.id){var u=t._structure.filesById[e.original.id];r.originalId=u.id,r.originalType=u.type,r.ranges=u.ranges,u.dependant||(u.dependant={}),delete u.dependant[r.id];var h=_.values(u.dependant)[0];h&&(h.noCompilers===!1?t._deleteFileMetadata(h):h=void 0),u.dependant[r.id]=r,e.sourceMap&&!c&&(u.tmpLineMap=t._updateFileMap(h&&u.tmpLineMap||u.lineMap,[e.sourceMap])),c&&(r.noCompilers=!1,r.sourceMap=e.sourceMap,r.ranges=e.ranges,r.type="js",r.lineMap=t._updateFileMap(r.lineMap,[e.sourceMap]),r.coverable=u.coverable,r.numberOfFunctions=u.numberOfFunctions,r.changePosition=_.textIndexPosition(t._getInstrumentedFileContent(u),u.changeStart))}return(c?t._processFile(r,e.content,void 0,!1,!0,o).then(function(e){return u.tmpLineMap=r.lineMap,u.ranges=r.ranges,u.validSyntax=r.validSyntax,u.include=!1,u.numberOfFunctionsChanged=r.numberOfFunctionsChanged,u.numberOfFunctions=r.numberOfFunctions,u.lastSingleChangeTest=r.lastSingleChangeTest,delete r.lineMap,Q.when(e)}):o?Q.when(e.content):t._doWriteFileWithLruCache(r.instrumentedPath,e.content)).then(function(e){return o&&n.bundle.push({file:r,content:e}),Q.when(e)})}},e,{logger:t._createLogger("postprocessor",e.logger)})},_createLogger:function(e,t){return t=t||{},{debug:require("debug")("wallaby:"+e),error:t.error||console.error.bind(console),log:t.log||console.log.bind(console)}},_createPostProcessorInputFile:function(e){var t=this;return{path:t.normalizePath(path.relative(t._instrumentedRoot,e.instrumentedPath)),fullPath:e.instrumentedPath,binary:e.binary,ts:e.changeTs,id:e.id,type:e.instrumentedType||e.type,load:e.include,initialLoad:e.initialInclude,instrument:e.coverable,test:e.test,order:e.order,getContent:function(){var n=t._lruCache.get(e.instrumentedPath);return n?Q.when(n):t._readFilePromise(e.instrumentedPath)},getContentSync:function(){return t._getInstrumentedFileContent(e)},setOrder:function(n,i){t._fileOrderUpdatePending=!0,i&&_.each(e.dependant,function(e){e.order=n}),e.order=n}}},_getInstrumentedFileContent:function(e){var t=this,n=t._lruCache.get(e.instrumentedPath);return n||t._readFileSync(e.instrumentedPath)},getInstrumentedJavaScriptFileContentByPath:function(e){var t=this._structure.filesByPath[e],n={};return n[t.path]=t,t=_.find(this._expandDependantFiles(n),function(e){return _.isEmpty(e.dependant)&&"js"===e.type}),t&&this._getInstrumentedFileContent(t)},findTestFile:function(e){for(var t,n=this,i=e.files||[],s=0,a=i.length;a>s;s++){var r=i[s];if(t=n._structure.testFilesById[r])return t}if(e.testFile&&(t=n._structure.testFilesById[e.testFile]))return t;if(r=n._structure.filesById[i[0]]){var o=_.keys(r.testFilesLoadedFrom||{})[0];if(o)return t=n._structure.testFilesById[o],t&&debug('Test "%s" without test file id mapped to %s (%s)',e.name,t.path,JSON.stringify({log:e.log,filesInvolved:_.map(e.files,function(e){var t=n._structure.filesById[e];return t?t.path:"unknown or deleted file"})})),t}},resolveLogEntryRange:function(e){if(("log"===e.type||"autoLog"===e.type||"diff"===e.type)&&_.isNumber(e.file)&&_.isNumber(e.range)){var t=this._getFileMetadataById(e.file),n=e.range;return t&&(e.range=t.ranges[n],e.range.length||(e.range=t.ranges[n-1]),e.range&&e.range.length||delete e.range),!0}return!1},_processCoverageResult:function(e,t){var n=this;e.ts=Date.now(),e.files=[],e.tests=[],e.log=t.log,e.globalErrors=t.globalErrors;var i=n._settings.reportConsoleErrorAsError&&{};e.log=_.filter(e.log,function(t){if(!n.resolveLogEntryRange(t)&&"error"===t.type&&i){var s={message:"\n"!==t.text&&t.text||"[console.error without any message]",stack:[]};if(t.spec){var a=i[t.spec]=i[t.spec]||[];a.push(s)}else e.globalErrors||(e.globalErrors=[]),e.globalErrors.push(s);return!1}return!0}),debug("Processed console.log entries"),_.each(t.loadingSequence,function(e,t){_.each(e,function(e){var i=n._structure.filesById[e];i&&(i.testFilesLoadedFrom=i.testFilesLoadedFrom||{},i.testFilesLoadedFrom[t]=runAlways)})}),debug("Processed loading sequences");var s={},a={},r=!1;_.each(t.tests,function(t){if(!t.skipped){if(i){var o=i[t.id];o&&(t.log=(t.log||[]).concat(o))}for(var l=e.tests,c=e,u=0,h=t.suite.length;h>u;u++){var d=t.suite[u];c=_.find(l,function(e){return e.name===d&&e.tests}),c||(c={name:d,tests:[]},l.push(c)),l=c.tests}var f=!(!t.log||!t.log.length),v=n.findTestFile(t);if(!v)return console.warn("Test without test file id, most likely the test did not run, OR the test/test body is in the file that is not in the `tests` list in the configuration file",{testFileIdCanNotBeDetermined:t.name,id:t.id,log:t.log,filesInvolved:_.map(t.files,function(e){var t=n._structure.filesById[e];return t?t.path:"unknown or deleted file"})}),void(f&&(r=!0));var p=v.id,g=t.suite.slice();g.unshift(v.path),g.push(t.name);var m=g.join(testPathSeparator);f&&n._testTask.failingTest(p,g);var y=a[m];y?(debug("Test name duplicate: "+t.name),t.name+=" #"+y,a[m]=y+1):a[m]=1;var T={name:t.name,id:t.id,fileId:p,log:t.log,time:t.time,slow:t.slow};c.tests.push(T),s[t.id]={out:T,timeRange:t.timeRange},_.each(t.files,function(e){var t=n._structure.filesById[e];t&&(t.tests[m]=runAlways)}),_.each(t.log,function(e){e.external&&e.stack&&(_.each(e.stack,function(e){var t=n._structure.filesById[e[0]];t&&(t.tests[m]=t.tests[m]||runOneTime)}),delete e.external)})}}),r&&(e.globalErrors||(e.globalErrors=[]),e.globalErrors.unshift({message:"Some of the failing tests can not be reported, check the wallaby console for more details"})),debug("Processed executed tests"),n._updateFileOrder(),_.each(t.changed===!0?n._structure.sourceFilesInOrder.concat(n._structure.testFilesInOrder):_.map(t.changed,function(e,t){return n._getFileMetadataById(t)}),function(e){if(e){var i=e.id;_.isNumber(i)&&!t.coverage[i]&&n._isJavaScript(e)&&(t.coverage[i]=[])}});var o={};if(_.each(t.coverage,function(i,a){a=parseInt(a,10);var r=t.changed[a],l={id:a,ranges:[],changed:t.changed===!0||!!r,singleTestChanged:!(!r||!r.singleTestChange)||void 0};o[a]=l;var c,u=n._getFileMetadataById(a),h=u.ranges,d={},f={};_.each(h,function(t,r){if(t.length){var o=t.join("."),h=!1,v=i[r],p=_.map(v,function(i,r){if(r=parseInt(r,10),!r)return null;var o=s[r];if(!o)return null;var l=o.timeRange;return l?(l[0]===i&&(u.test&&n._looksLikeTestDeclarationRange(c,t)&&e.log.push({type:"autoLog",text:_.isNumber(o.out.time)?o.out.time+"ms":"",file:a,range:c,context:""}),o.out.start=t[0],a!==o.out.fileId&&(f[o.out.fileId]=!0)),h=!0,r):r});if(c=t,l.changed||p.length||u.relatedFilesWithTests){var g={items:t,hits:p},m=d[o];m?h&&(m.hits=p):(d[o]=g,l.ranges.push(g))}}}),_.isEmpty(f)||(u.relatedFilesWithTests=f,_.each(f,function(e,t){var i=n._getFileMetadataById(t);i&&(i.relatedFilesWithTests=i.relatedFilesWithTests||{},i.relatedFilesWithTests[u.id]=!0)})),e.files.push(l)}),_.isObject(t.changed)){var l=function(e){var t=o[e];t&&(t.changed=!0,t.singleTestChanged=void 0)},c={},u=function(e){var t=function(t){return e.apply(this,arguments)};return t.toString=function(){return e.toString()},t}(function(e){if(!c[e]){c[e]=!0;var t=n._getFileMetadataById(e);t&&t.relatedFilesWithTests&&(l(t.id),_.each(t.relatedFilesWithTests,function(e,t){l(t),u(t)}))}});_.each(t.changed,function(e,t){u(t)})}return debug("Processed code coverage"),e},_looksLikeTestDeclarationRange:function(e,t){return e&&t&&e[0]<=t[0]&&e[2]>=t[2]},_filesAreUpToDate:function(e){var t=this;return t._structure.awaitingFiles=_.without.bind(null,t._structure.awaitingFiles).apply(null,e),t._signalIfBecameLive()},_filesAreRequired:function(e){var t=this;t._structure.awaitingFiles=_.union(t._structure.awaitingFiles,e),t._structure.awaitingFiles.length&&(t._live=!0,t._emit({type:"filesRequired",files:t._structure.awaitingFiles}))},_signalIfBecameLive:function(){var e=this;if(e._structure&&!e._structure.awaitingFiles.length&&!e._live){e._live=!0;var t={type:"live"};return e._emit(t),process.env.quokka&&this._emitInternal(_.extend({type:"configChanged",settings:this._quokkaSettings},JSON.parse(process.env.quokka),{nodeVersion:process.version})),debug("Stopping process pool"),e._processorPool.stop(),!0}},_writeFileChanges:function(e,t,n){var i=this;e.changeTs=+new Date;var s,a=[];_.each(t,function(e){var t=_.isPatch(e);t?a.push(e):(s=e,a.length=0)});var r=a.length===t.length;return debug("File %s changes are patches only: %s",e.path,r),Q.all([r?i._readSourceFile(e.id,e.originalPath):Q.when(!1),i._dirEnsurePromise(path.dirname(e.originalPath)),i._dirEnsurePromise(path.dirname(e.instrumentedPath))]).then(function(t){r&&(s=t[0]);var n=void 0;return delete e.lastChangeIsComplex,_.each(a,function(t){var r=i._diffMatchPatch.patch_fromText(t),o=1===a.length&&3===t.split("@@").length;o?e.test&&_.each(r,function(e){e.diffs&&e.diffs.length&&2==e.diffs[0].length&&!e.diffs[0][0]&&(n=e.start2+e.diffs[0][1].length)}):e.lastChangeIsComplex=!0,s=i._diffMatchPatch.patch_apply(r,s)[0]}),process.env.quokka&&i._quokkaFileChanged(s),Q.all([e.binary?i._doWriteFile(e.originalPath,new Buffer(s,"base64")):i._writeSourceFile(e.originalPath,s),i._processFile(e,s,n,!i._live,!1)])}).then(function(){return e.ts=n,debug("File %s changes saved, store ts: %s, change ts: %s",e.path,e.ts,e.changeTs),Q.when(!0)})},_quokkaFileChanged:function _quokkaFileChanged(content){var inlineConfig,inlineConfigString;if(content){var match=/^\s*(\s*\/\/.*?\r?\n)*\s*\(?{/.exec(content);if(match&&match[0]){for(var braceStack=[],start=match[0].length-1,i=start,len=content.length;len>i;i++){var character=content[i];if("{"===character?braceStack.push(character):"}"===character&&braceStack.pop(),!braceStack.length)break}try{inlineConfig=eval("("+content.substring(start,i+1)+")"),inlineConfigString=JSON.stringify(inlineConfig)}catch(e){}}}if(this._settings._previousInlineQuokkaConfig!==inlineConfigString){this._loadQuokkaSettings(inlineConfig),this._settings=this._quokkaSettings,this._settings._previousInlineQuokkaConfig=inlineConfigString;var file=this._structure.filesByPath[this._quokkaFileName];delete file.noCompilers,delete file.noPreprocessors,this._recycleRunner=!0}},_processFile:function(e,t,n,i,s,a){var r=this;if(process.env.quokka&&(i=!1,r._settings.error))throw new Error(r._settings.error);if(e.changeStart=n,debug("Preparing to process %s",e.path),t=t&&t.toString()||"","node"===r.settings().env.type&&r._isJavaScript(e)&&(t=t.replace(/^\#\!.*/,""),r._settings.testFramework.jsPreprocessor&&(t=r._settings.testFramework.jsPreprocessor(t))),"snap"===e.type){var o=r._structure.filesByPath[path.join(path.dirname(e.path),"..",path.basename(e.path,".snap"))];o&&(e.testFilesLoadedFrom=e.testFilesLoadedFrom||{},e.testFilesLoadedFrom[o.id]=runAlways)}i&&r._startProcessorPool(),!e.changeStart||e.noCompilers||e.binary||(e.changePosition=_.textIndexPosition(t,e.changeStart));var l=function(){return debug("File "+e.path+" is not instrumented by core"),e.ranges=[],e.validSyntax=!0,Q.when({code:t})};return(e.binary||!e.coverable&&!e.test?Q.fcall(l):(s?Q.when(t):r._runThroughProcessors(e,t,i,!0).fail(function(t){return r._cleanStack(t),Q.reject(new Error("Failed to run compilers on "+e.path+", "+(t&&(t.stack||t.message))))})).then(function(t){if(!e.noCompilers){debug("Processing compiled "+e.path),e.instrumentedType="js";var n=e.sourceMap,s=new SourceMapConsumer(n);delete e.sourceMap;var a=_.reduce(e.ranges,function(e,t){var n=e[t[0]]=e[t[0]]||[];return n.push(t),e},{});if(e.changePosition){e.changePosition.source=n.sources&&n.sources[0]||".";var o=r._findClosestRange(a,e.changePosition,!0);o&&(e.changePosition.column=o[1]),e.changePosition.bias=2,e.changeStart=s.generatedPositionFor(e.changePosition)}var c=r._isOriginallyCoffeeScript(e),u=function(t){_.each(t,function(t){var n={line:t[0],column:t[1]},i=s.originalPositionFor(n);if(5===t.length){var o="_extends"===t[4]||"React.createElement"===t[4];if(t.length=4,i.source&&!o){var l={line:t[0],column:t[1],bias:2},u=s.originalPositionFor(l);
u.source&&i.line<u.line&&(i=u)}i.source||(n.column+=7,i=s.originalPositionFor(n),i.source||(c?(n.column+=7,i=s.originalPositionFor(n)):(n.column+=26,i=s.originalPositionFor(n))))}if(i.source)var h=r._findClosestRange(a,i);h?(e.lineMap[t[0]]=h[0],t[0]=h[0],t[1]=h[1],t[2]=h[2],t[3]=h[3]):t.length=0})}}return!r._isOriginallyJavaScript(e)&&e.noCompilers?Q.fcall(l):(debug("Instrumenting "+e.path+", via process pool: "+i),r._instrument(t,{file:e.tmp?e.originalId:e.id,testFileChangeStart:e.changeStart,fullMap:!e.noCompilers,hints:e.test?_.omit(r._settings.hints,"ignoreCoverage"):r._settings.hints,recordValues:r._settings.autoConsoleLog,sequenceExpressionToDiff:!!process.env.quokka},i).then(function(t){if(t.error)throw t.error;return u&&u(t.ranges),e.validSyntax=!0,e.ranges=t.ranges,e.lineMap=e.noCompilers?t.map:r._updateFileMap(e.lineMap,[JSON.parse(t.map)]),delete e.tmpLineMap,e.numberOfFunctionsChanged=e.numberOfFunctions!==t.numberOfFunctions,e.numberOfFunctions=t.numberOfFunctions,e.lastSingleChangeTest=e.test&&e.changeStart&&!e.numberOfFunctionsChanged&&t.testName,e.lastSingleChangeTest&&debug("Detected single test [%s] change",t.testName),Q.when(t)}).fail(function(t){return e.validSyntax=!1,r._cleanStack(t),Q.when(new Error("Failed to parse "+e.path+", "+(t&&(t.stack||t.message))))}))})).then(function(t){return t instanceof Error?Q.when(t):r._runThroughProcessors(e,t.code,i,!1).then(function(t){return a?Q.when(t):(debug("Writing to disk and caching processed file %s",e.path),e.binary?r._doWriteFile(e.instrumentedPath,new Buffer(t,"base64")):r._doWriteFileWithLruCache(e.instrumentedPath,t))}).fail(function(t){return r._cleanStack(t),Q.when(new Error("Failed to run preprocessors on "+e.path+", "+(t&&(t.stack||t.message))))})}).then(function(e){return e instanceof Error?Q.reject(e):Q.when(e)})},_findClosestRange:function(e,t,n){var i=e[t.line];if(i)for(var s,a=1/0,r=0;r<i.length;r++){var o=i[r],l=Math.abs(o[1]-t.column);a>l&&(!n||o[1]<=t.column)&&(a=l,s=o)}return s},_runThroughProcessors:function(e,t,n,i){var s=this;if(!Object.keys(i?s._settings.compilers:s._settings.preprocessors).length||(i?e.noCompilers:e.noPreprocessors))return debug("No %s configured for %s",i?"compilers":"preprocessors",e.path),i?e.noCompilers=!0:e.noPreprocessors=!0,Q.when(t);var a={content:t,config:process.env.quokka?s._settings:s._configFile,file:e,root:s._instrumentedRoot,type:i?"compiler":"preprocessor"};return(n?s._processorPool.run(a):processor(a)).then(function(t){if(t.error)throw t.error;return i?e.noCompilers=t.noProcessors:e.noPreprocessors=t.noProcessors,s._updateInstrumentedFile(t,e,i&&!e.noCompilers),Q.when(t.content)})},_updateInstrumentedFile:function(e,t,n){var i=this;n&&delete t.lineMap,e.maps&&e.maps.length&&(t.lineMap=i._updateFileMap(t.lineMap,e.maps)),e.newPath&&(t.instrumentedPath=path.resolve(i._instrumentedRoot,e.newPath),t.instrumentedType=_.trim(path.extname(t.instrumentedPath),"."),i._structure.filesRenamed[e.newPath]=t.path),n&&(t.ranges=e.ranges,t.sourceMap=e.maps&&e.maps[0],t.ranges&&t.ranges.length||debug("Compiler did not set ranges for file [%s]",t.path),t.sourceMap||debug("Compiler did not set source map for file [%s]",t.path))},_updateFileMap:function(e,t){e=e||{};var n=_.extend({},e);return _.each(t,function(e){var t=new SourceMapConsumer(e),i={},s=_.isEmpty(n),a=_.extend({},n);t.eachMapping(function(e){if(e.generatedLine&&e.originalLine){var t=i[e.generatedLine],r=a[e.originalLine];if(!t||e.name){var o=r||t;o?i[e.generatedLine]=o:s&&(i[e.generatedLine]=e.originalLine),"__awaiter"===e.name&&delete i[e.generatedLine]}r&&delete n[e.originalLine]}}),n=_.extend({},n,i)}),n},_instrument:function(e,t,n){var i=this;return n?i._processorPool.run({content:e,opts:t,type:"instrumentor"}):Q.fcall(function(){return instrument(e,t)})},_writeSourceFile:function(e,t){var n=this,i=n._sourceFileCache[e];return i?(i.content=t,Q.when(!0)):n._doWriteFile(e,t)},_doWriteFile:function(e,t){var n=this;return n._dirEnsurePromise(path.dirname(e)).then(function(){return n._writeFilePromise(e,t)})},_doWriteFileWithLruCache:function(e,t){var n=this;return n._dirEnsurePromise(path.dirname(e)).then(function(){return n._writeFilePromise(e,t)}).then(function(){return n._lruCache.set(e,t),Q.when(!0)})},_deleteSourceFile:function(e){var t=this;return delete t._sourceFileCache[e],t._unlinkFilePromise(e)},readSourceFile:function(e){var t=this._getFileMetadataById(e);return t&&this._readSourceFile(e,t.originalPath)},_readSourceFile:function(e,t){var n=this,i=n._sourceFileCache[t];return i?(debug("Returning previously cached file [%s] from memory",e),Q.when(i.content)):n._readFilePromise(t).then(function(i){var s=Q.when(!0),a=_.keys(n._sourceFileCache);if(a.length>=2){var r=a[0],o=n._sourceFileCache[r];delete n._sourceFileCache[r],n._structure.filesById[o.id]?(s=n._doWriteFile(r,o.content),debug("Writing previously cached file [%s] to disk",r)):debug("Previously cached file [%s] was deleted and does not need saving to disk",r)}return debug("Caching file [%s] in memory",e),n._sourceFileCache[t]={content:i,id:e},s.then(function(){return Q.when(i)})})},_flushSourceFileCacheSync:function(){var e=this;try{_.each(e._sourceFileCache,function(t,n){e._dirEnsureSync(path.dirname(n)),e._writeFileSync(n,t.content)})}catch(t){_.each(e._sourceFileCache,function(t){var n=e._structure.filesById[t.id];n&&(n.ts=0)})}},_getOrCreateFileMetadata:function(e){var t=this,n=t._structure.filesByPath[e.path];if(!n){var i=t._createFileMetadata(e,e.id);return t._fileOrderUpdatePending=!0,i}return n},_getFileMetadataById:function(e){var t=this;return t._structure.filesById[e]},_overrideFileType:function(e,t,n){},_createFileMetadata:function(e,t){var n=this;if(path.resolve(e.path)===path.normalize(e.path).replace(new RegExp(path.sep+"$"),""))throw new Error("Configured file paths must be relative: "+e.path);var i=path.join(n._originalRoot,e.path),s=path.join(n._instrumentedRoot,e.path),a=n._overrideFileType(e.type,e.path,e.id)||e.type,r={id:t,path:e.path,type:a||"js",binary:e.binary||void 0,tmp:e.tmp||void 0,instrumentedType:e.instrumentedType||a||"js",order:e.order,originalPath:i,instrumentedPath:s,ts:e.ts,changeTs:e.ts,triggersTests:e.triggersTests,include:e.include,initialInclude:_.isBoolean(e.initialInclude)?e.initialInclude:e.include,coverable:e.coverable,test:e.test,tests:e.tests||{},ranges:e.ranges||void 0,lineMap:e.lineMap||void 0,tmpLineMap:e.tmpLineMap||void 0,validSyntax:e.validSyntax||void 0,numberOfFunctions:e.numberOfFunctions||void 0,getFileLineMap:function(){return this.tmpLineMap||this.lineMap}};return n._updateFileStructure(r),r},_deleteTmpFiles:function(){var e=this;this._deleteDependantFilesMetadata(),_.each(e._structure.filesByPath,function(t){return t.tmp&&e._deleteFileMetadata(t)}),e._fileOrderUpdatePending=!0},_deleteDependantFilesMetadata:function(e){var t=this;e?(_.each(e.dependant,function(e){return t._deleteFileMetadata(e)}),e.dependant={}):_.each(t._structure.filesByPath,function(e){return t._deleteDependantFilesMetadata(e)})},_deleteFileMetadata:function(e){var t=this,n=t._structure.filesByPath[e.path];return n?(t._updateFileStructure(n,!0),t._fileOrderUpdatePending=!0,n):void 0},_updateFileStructure:function(e,t){var n=this;t?(n._deleteDependantFilesMetadata(e),delete n._structure.filesById[e.id],delete n._structure.testFilesById[e.id],delete n._structure.filesByPath[e.path]):(n._structure.filesById[e.id]=e,n._structure.filesByPath[e.path]=e,e.test&&(n._structure.testFilesById[e.id]=e))},_updateFileOrder:function(){var e=this;e._fileOrderUpdatePending&&(e._structure.testFilesInOrder=[],e._structure.sourceFilesInOrder=[],_.each(e._orderFilesByConfig(e._structure.filesByPath),function(t){t.test?e._structure.testFilesInOrder.push(t):e._structure.sourceFilesInOrder.push(t)}),delete e._fileOrderUpdatePending)},_orderFilesByConfig:function(e){return _.chain(e).sortBy(function(e){return e.path}).sortBy(function(e){return e.order}).value()}}),module.exports=Project},{"./babelCompiler":3,"./config":6,"./instrumentor":11,"./processor":17,"./testTask":20,"./tracking":22,"./typeScriptPostprocessor":24,"./utils":26,child_process:void 0,debug:void 0,"lru-cache":void 0,minimatch:void 0,module:void 0,os:void 0,path:void 0,"source-map":void 0,typescript:void 0}],19:[function(e,t,n){var i,s=e("os"),a=e("path"),r=e("http"),o=e("ws").Server,l=/^win/.test(process.platform),c=5e3,u=200,h="&wallabyFileId=",d="Wallaby.js cache is corrupted, please restart wallaby.js",f=function(t,n){var s=this;i=e("debug")("wallaby:workers"),s._project=t,s._opts=t.settings(),s._extension=n,process.env.quokka&&(s.reportConsoleOutput=function(e){var n=_.extend({},e);t.resolveLogEntryRange(n),t._emitInternal({type:"consoleOutput",data:n})}),s._sessions={},s._executedTestNumber=0,s._workers={},s._connectingWorkers={},s._calculateNumberOfParallelWorkers();for(var r=0;r<Math.max(s._maxWorkers,s._minWorkers);r++)s.getWorker(r);s._wallabyServerPath=a.dirname(process.mainModule.filename)};f.prototype={start:function(e){var t=this,n=e?r.createServer(e):r.createServer();return n.listen(0),Q.promise(function(e,s){n.on("listening",function(){try{t._receiverPort=n.address().port,i("Web server is listening at "+t._receiverPort),t._wss=new o({server:n,verifyClient:function(e){return _.verifyLocalOrigin(e.origin)}}),t._wss.on("connection",function(e){e.on("message",function(n){var s;try{s=JSON.parse(n)}catch(a){return void console.error("Failed to deserialize message from worker: "+n+", "+(a&&a.message))}if(s.worker){var r=t._workers[s.worker];if(!r)return;if(r.onConnected)r.onConnected(e);else if(process.env.quokka&&r.instance){if(r.instance.channel)try{r.instance.channel.close(),r.instance.channel.removeAllListeners()}catch(a){}r.instance.channel=e}try{e.send(JSON.stringify({type:"in:connected"}))}catch(a){console.error('Failed to send the "connected" message to worker. '+a.message)}}else if(s.session){var o=t._sessions[s.session],l=!o||o._disposing||t._cancelled;if("console"===s.type&&s.data){if("debugLog"===s.data.type)return void i(s.data.text);(s.data.spec||process.env.quokka)&&!l||"autoLog"===s.data.type||console.log("console."+s.data.type+": "+s.data.text)}if(l)return;try{o[s.type](s.data)}catch(a){console.error("Failed to process message "+s.type+" from worker, "+(a&&a.message)),o.reject(a)}}})}),e()}catch(a){s(a)}})})},wallabyFileIdPrefix:function(e){var t=function(){return e.apply(this,arguments)};return t.toString=function(){return e.toString()},t}(function(){return h}),receiverPort:function(){return this._receiverPort},setFileRoot:function(e){this._fileRoot=e},run:function(e){var t=this;return t._cancelled=!1,t._executedTestNumber=0,t._runPriority=e.priority,e.recycleBeforeRun&&_.each(t._workers,function(e,n){t.recycleWorker(n)}),i("Starting test run, priority: "+t._runPriority),(e.fullRun&&t._maxWorkers>1&&e.testFilesToLoad.length>1?t._runInParallel(e,t._maxWorkers):t._minWorkers>1&&e.testFilesToLoad.length>1&&!(e.fullRun&&t._maxWorkers<t._minWorkers)?t._runInParallel(e,t._minWorkers):t._extension.prepare(e,0).then(function(e){return t._runTests(e)})).then(function(e){return t._executedTestNumber&&console.log("Finished executing "+t._executedTestNumber+" affected test(s)"),Q.when(e)})},_handleError:function(e,t,n,s,a,r,o){var l=this;r===o&&(r=o=void 0),i("Sandbox (%s) [%s] error: %s",e.active()?"active":"inactive",t,n);var c=l._reportableError(n,s),u="SyntaxError: Parse error"===n&&_.isEmpty(s);if(l._corruptedCache(c))return l._project.invalidateCache(),e.reject(new Error(d)),void e.recycleWorker();if(process.env.quokka?i("Runtime error: "+c):console.error("Runtime error: "+c),e.active()){if(e.scheduleCompleteIfNotActiveFor(100),!s)return void e.reject(new Error(n));if(!u)try{var h={message:n,stack:_.isString(s)?s:_.reduce(s,function(e,t){return e+t.file+":"+t.line+"\n"},""),external:!0,actual:r,expected:o},f=[h];l._processTestLog(f),h.stack&&h.stack.length||(h.message=c,h.stack=[]),a?e._globalErrors.push(h):e.addToTestLog(h)}catch(v){e.reject(new Error(n+", "+(v&&v.message)))}}},_runTests:function(e){var t=this;if(t.cancelled())return Q.reject({runCancelled:!0});i("Running tests in sandbox [%s]",e.name);var n=e.sessionId,s=e.workerId;return Q.promise(function(i,a){t.cancelled()&&a({runCancelled:!0});try{var r=t._createSession(n,s,e.instance,i,a);e.instance.start(function(e){return t.cancelled()?(r.reject({runCancelled:!0}),!1):"success"!==e?(r.reject(new Error("Sandbox load failed, status: "+e)),!1):!0},function(e,i,s,a){t._handleError(r,n,e,i,!1,s,a)})}catch(o){a(o)}}).then(function(e){if(e.session){var t=e.session,n=t._coverage,i=t._loadingSequence,s=t._tests,a=t._log,r=t._globalErrors.concat(t._executingTestLog);return r.length||(r=void 0),_.each(_.keys(t),function(e){e&&"_"===e[0]&&!_.isFunction(t[e])&&"_disposing"!==e&&delete t[e]}),delete e.session,Q.when({coverage:n,tests:s,log:a,globalErrors:r,loadingSequence:i,time:e.time})}return Q.when(e)})},_reportableError:function(e,t){var n=this;if(_.isString(t)){var i={stack:t};return n._project._cleanStack(i),t=i.stack}return e},cancel:function(e){var t=this;if(!_.isEmpty(t._sessions))return e>=t._runPriority?(_.each(t._sessions,function(e){e.reject({runCancelled:!0})}),t._cancelled=!0,i("Cancelling test run, cancel requester priority: %s, current run priority: %s",e,t._runPriority),!0):!1},cancelled:function(){return this._cancelled},_createSession:function(e,t,n,s,a){var r=this;return r._sessions[e]={_coverage:{},_tests:[],_loadingSequence:{},_log:[],_executingTestLog:[],_globalErrors:[],_total:0,_skipped:0,_disposing:!1,_exceededMaxTestAllowedLogLimit:!1,_onFinished:n.closing,_messagesPerTest:{},_closeByErrorTimeout:0,_longRunningWarningTimeout:0,_longRunningPingTimeout:0,_executingFiles:{},_executingTest:void 0,started:function(e){var t=this;i("Loaded %s test(s)",e.total),this._total=e.total,_.each(e.loadingSequence,function(e){e.length>1&&(t._loadingSequence[e[0]]=e.slice(1))})},active:function(){return!this._disposing&&!r._cancelled},scheduleCompleteIfNotActiveFor:function(e){var t=this;clearTimeout(t._closeByErrorTimeout),t._closeByErrorTimeout=setTimeout(function(){t.complete()},e)},addToTestLog:function(e){var t=this._executingTestLog[this._executingTestLog.length-1];t&&t.message===e.message&&t.stack&&e.stack&&t.stack.length>0&&e.stack.length>0&&_.isEqual(e.stack[0],t.stack[0])?e.stack.length>t.stack.length&&(t.stack=e.stack):this._executingTestLog.push(e)},complete:function(e){var t=this;clearTimeout(this._closeByErrorTimeout),clearTimeout(this._longRunningWarningTimeout),clearTimeout(this._longRunningPingTimeout),t._onFinished(),this._dispose(function(){r._cancelled?a({runCancelled:!0}):s({session:t,time:e&&e.time})}),i("Run %s test(s), skipped %s test(s)",this._tests.length-this._skipped,this._skipped)},globalError:function(t){r._handleError(this,e,t.message,t.stack,t.declaration,t.actual,t.expected)},programScopeStart:function(e){this._executingFiles[e]=1,this._setTimeoutForLongRunningOperation()},programScopeEnd:function(e){delete this._executingFiles[e],_.isEmpty(this._executingFiles)&&!this._executingTest&&(clearTimeout(this._longRunningWarningTimeout),clearTimeout(this._longRunningPingTimeout))},preTest:function(e){this._setTimeoutForLongRunningOperation(),this._executingTest=e},_setTimeoutForLongRunningOperation:function(){if(!process.env.quokka){var e=this;clearTimeout(this._longRunningWarningTimeout),clearTimeout(this._longRunningPingTimeout),this._longRunningWarningTimeout=setTimeout(function(){var t="Some long running code has been detected: ",i=e._executingTest,s=!_.isEmpty(e._executingFiles);if(t+=(i?'test "'+i+'"':"one of your "+(s?"files":"tests"))+" is taking more than "+c+"ms to execute.",s&&(t+="\nExecution of the following files has started but has not finished:",_.each(e._executingFiles,function(e,n){var i=r._project._getFileMetadataById(n);t+="\n- "+(i?i.path:"unknown")})),e._log.length&&(t+="\nThe last recorded console.log: "+_.last(e._log).text),i||s){t+="\nTry commenting out the test or excluding the test file from the `tests` list in your wallaby config,\nand restarting wallaby to make sure that it is this test/file causing the issue and not something else.",i&&(t+="\nAlso review your recent changes to the code that the test covers, as well as its `before` and `after` hooks."),t+="\nPinging test runner sandbox...";try{n.ping(function(){clearTimeout(e._longRunningPingTimeout),e.active()&&console.warn("Sandbox is responsive. The issue may have the asynchronous nature, like a missing callback.")}),e._longRunningPingTimeout=setTimeout(function(){console.warn("The sandbox is not responsive. Check for possibly recently introduced infinite loops.")},u)}catch(a){t+="\nThe sandbox ping failed: "+a.message}}console.warn(t)},c)}},test:function(e){var t=function(t){return e.apply(this,arguments)};return t.toString=function(){return e.toString()},t}(function(e){var t=this;return delete this._executingTest,clearTimeout(this._closeByErrorTimeout),this._setTimeoutForLongRunningOperation(),e.hook&&e.log?(r._processTestLog(e.log),_.isString(e.hook)&&_.each(e.log,function(t){t.message=e.hook+(t.message?": ":"")+t.message}),void(this._globalErrors=this._globalErrors.concat(e.log))):(e.skipped?(this._skipped++,r._processTestLog(e.log)):(i("Test executed: "+e.name),r._processTestLog(e.log),e.log&&_.each(e.log,function(e){return t.addToTestLog(e)}),this._executingTestLog.length&&(e.log=this._executingTestLog.slice()),_.isUndefined(e.slow)&&(e.slow=e.time>r._opts.slowTestThreshold),e.slow=e.slow||void 0,this._executingTestLog.length=0,++r._executedTestNumber%50||console.log("Execution progress: "+r._executedTestNumber+" tests")),void this._tests.push(e))}),coverage:function(e){this._coverage[e.id]=e.ranges},console:function(e){var t=function(t){return e.apply(this,arguments)};return t.toString=function(){return e.toString()},t}(function(e){var t=r._opts.maxConsoleMessagesPerTest,n=this._messagesPerTest[e.spec]=(this._messagesPerTest[e.spec]||0)+1;n===t+1?console.warn("Number of console messages per test exceeded maximum allowed value ("+t+"), current test console messages recording stopped.\nYou may increase the limit by adding `maxConsoleMessagesPerTest` setting to your config file."):t>=n&&this._log.push(e),r.reportConsoleOutput(e)}),resume:function(){i("Sandbox requested early screen shot capture"),this._onFinished(),this._onFinished=_.noop,n.resume()},reject:function(e){var t=function(t){return e.apply(this,arguments)};return t.toString=function(){return e.toString()},t}(function(e){this._disposing||this._dispose(function(){a(r._cancelled?{runCancelled:!0}:e)})}),recycleWorker:function(){r.recycleWorker(t)},_dispose:function(s){this._disposing=!0,clearTimeout(this._closeByErrorTimeout),clearTimeout(this._longRunningWarningTimeout),clearTimeout(this._longRunningPingTimeout);var a=!1,o=!1,l=function(){o=!0,a&&clearTimeout(a),delete r._sessions[e],s()},c=function(){o||(i("Sandbox [%s] is not responsive, recycling worker instance",e),r._tryClosingSandbox(n.close),r.recycleWorker(t),l())};try{n.ping(function(){o||(i("Sandbox [%s] is responsive, closing it",e),r._tryClosingSandbox(n.close),l())})}catch(u){return i("Sandbox [%s] can not be pinged: %s",e,u&&u.message),void c()}a=setTimeout(function(){c()},1e3)}}},_tryClosingSandbox:function(e,t){try{e()}catch(n){i("Sandbox [%s] closing error, %s",t,n.message)}},_corruptedCache:function(e){return e&&e.match(/evaluating '[a-z]\.\$_\$coverage\[/)},_processTestLog:function(e){var t=this,n=h.length;_.each(e,function(e){var s=e.message,r=s&&s.indexOf(" in file:///")||-1;if(~r&&(e.message=s.substring(0,r)),t._corruptedCache(e.message)&&(t._project.invalidateCache(),e.message=d),e.stack&&_.isString(e.stack)){var o,l,c=[],u={},f=e.stack.split("\n");f&&t._corruptedCache(f[0])&&(t._project.invalidateCache(),e.message=d),_.each(f,function(e){var i=e.lastIndexOf(h);if(~i){var s=e.substr(i+n).split(":");s.length>=2&&(o=t._project.stackEntryByFileId(parseInt(s[0],10)||s[0],parseInt(s[1],10)),o&&o.line&&(l=t._extractBrowserStackLineContext(e),l&&(u[c.length]=l),c.push([o.file,o.line])))}else if(process.env.quokka){if(process.env.quokka)if(_.contains(e,t._wallabyServerPath)){if(_.contains(e,"quokkaStackTraceMarker"))return!1}else{var r,d,f=e;e=e.replace(t._project._localRoot,".");var v=f!==e?f.lastIndexOf(t._project._localRoot):e.lastIndexOf("(")+1;if(m=f!==e?e.substr(v).split(":"):e.substring(v,e.lastIndexOf(")")-1).split(":"),3===m.length){l=t._extractNodeStackLineContext(e,v);var p=parseInt(m[1],10);o=t._project.stackEntryByFilePath(t._project.normalizePath(_.ltrim(m[0],"."+a.sep)),p),o&&o.line?(r=o.file,d=o.line):(r=m[0],d=p),l&&(u[c.length]=l),c.push([r,d])}}}else{var g=t._fileRoot?e.lastIndexOf(t._fileRoot):-1;if(~g){var m=_.rtrim(e.substr(g+t._fileRoot.length),")").split(":");3===m.length&&(o=t._project.stackEntryByFilePath(t._project.normalizePath(_.ltrim(m[0],a.sep)),parseInt(m[1],10)),o&&o.line&&(l=t._extractNodeStackLineContext(e,g),l&&(u[c.length]=l),c.push([o.file,o.line])))}}}),c.length||i("Failed to map the stack to user code, entry message: %s, stack: %s",e.message&&e.message.substring(0,1024),e.stack.substring(0,1024)),e.stack=c,_.isEmpty(u)||(e.context=u)}process.env.quokka&&e.message&&(e.message=e.message.replace(t._project._localRoot,"."))})},_extractNodeStackLineContext:function(e,t){if(t>4&&"("===e[t-1]){var n=e.substr(0,t-2)||"";return n.split("at ")[1]}},_extractBrowserStackLineContext:function(e){var t=e.split(" (http");return t.length>=2?(t[0]||"").split("at ")[1]:(t=e.split("@http"),t.length>=2?t[0]:void 0)},_runInParallel:function(e,t){var n=this,s=e.testFilesToLoad,a={};i("Distributing tests between %s workers",t);for(var r=0;t>r;r++){var o=_.omit(e,"testFiles");o.testFilesToLoad=[],a[r]={opts:o,workerId:r,ranges:0}}return _.each(s,function(e){var t=_.sortBy(a,function(e){return e.ranges})[0];t.opts.testFilesToLoad.push(e),t.ranges+=e.rangesLength}),i("Running tests in parallel"),Q.all(_.chain(a).filter(function(e){return e.ranges}).map(function(e){return n._extension.prepare(e.opts,e.workerId).then(function(e){return n._runTests(e)})}).value()).then(function(e){i("Merging parallel test run results");var t=_.reduce(e,function(e,t){e.runCancelled=t.runCancelled||e.runCancelled,e.tests=e.tests.concat(t.tests||[]),e.log=e.log.concat(t.log||[]),e.globalErrors=e.globalErrors.concat(t.globalErrors||[]),e.error=t instanceof Error||e.error,e.loadingSequence=_.extend(e.loadingSequence,t.loadingSequence||{});var n=e.coverage;return _.isEmpty(n)?(e.coverage=t.coverage,e):(_.each(t.coverage,function(e,t){var i=n[t];return i?void _.each(e,function(e,t){var n=i[t];return n?void _.extend(n,e):void(i[t]=e)}):void(n[t]=e)}),e)},{coverage:{},tests:[],log:[],globalErrors:[],loadingSequence:{}});return t.runCancelled?Q.reject(t):t.error?Q.reject(t.error):Q.when(t)})},getWorker:function(e){var t=this,n=t._workers[e];return n||(n=t._workers[e]={id:e,promise:Q.promise(function(n,s){var a=t._workers[e];if(a)if(a.instance){if(t._extension.healthy(a.instance))return void n(a);i("Found inactive run worker instance #%s, recycling",e),t.recycleWorker(e)}else if(a.promise)return a.promise;i("Starting run worker instance #"+e);try{t._extension.create(e,function(a){if(!a)return void s(new Error("Failed to create worker instance"));var r=t._workers[e]=t._workers[e]||{id:e};if(a.onConnected){r.onConnected=_.bind(a.onConnected,r),delete a.onConnected;var o,l;r.promise=Q.promise(function(e,t){o=e,l=t});var c=!1,u=setTimeout(function(){if(!c){h();var n=t._workers[e];n&&n._connected?t._extension.recycle(a):t.recycleWorker(e),i("Worker is not created in time, recycling it"),l&&l({runCancelled:!0,rerun:!0}),s({runCancelled:!0,rerun:!0})}},1e4),h=function(){c=!0,clearTimeout(u)},d=t._connectingWorkers[e];d&&t._extension.recycle(d),t._connectingWorkers[e]=a,r.onConnected(function(s){delete t._connectingWorkers[e],c||(h(),i("Started run worker instance (delayed) #"+e),r.instance=a,r._connected=!0,a.channel=s,r.promise=Q.when(a),o&&o(a),n(a))})}else i("Started run worker instance (immediate) #"+e),r.instance=a,r.promise=Q.when(a),n(a)})}catch(r){s(r)}})}),n.promise},reportConsoleOutput:function(e){},recycleWorker:function(e){var t=this;try{var n=t._workers[e];n&&n.instance&&t._extension.recycle(n.instance)}catch(s){i("Error while recycling run worker instance #%s: %s",e,s&&(s.stack||s.message))}finally{delete t._workers[e]}},stop:function(){var e=this;_.each(e._workers,function(t,n){e.recycleWorker(n)}),e._wss&&e._wss.close()},_calculateNumberOfParallelWorkers:function(){var e=this;e._maxWorkers=Math.max(1,e._opts.workers.initial||Math.max(s.cpus().length-2,2)),l&&!e._opts.workers.initial&&"phantomjs"===e._opts.env.kind&&(e._maxWorkers=Math.min(16,e._maxWorkers)),e._minWorkers=Math.max(1,e._opts.workers.regular||Math.max(Math.floor(e._maxWorkers/2),2)),i("Parallelism for initial run: %s, for regular run: %s",e._maxWorkers,e._minWorkers)}},t.exports=f},{debug:void 0,http:void 0,os:void 0,path:void 0,ws:void 0}],20:[function(e,t,n){"use strict";var i=function(){function e(e,t){for(var n in t){var i=t[n];i.configurable=!0,i.value&&(i.writable=!0)}Object.defineProperties(e,t)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},a={testRunPriority:1,fileChangePriority:2,fullRunPriority:3},r=function(){function t(e){s(this,t),this._filesAndAffectedTests={},this._failingTests={},this._tests=[],this._priority=0,this._project=e}return i(t,{files:{value:function(){return _.reduce(this._filesAndAffectedTests,function(e,t){return e[t.file.id]=t.file,e},{})}},hasFiles:{value:function(){return _.keys(this._filesAndAffectedTests).length>1}},addTests:{value:function(e){this._tests=this._tests.concat(e)}},addChangedFile:{value:function(e,t){this._mergeAffectedTests(e.id,{file:e,tests:t,testFilesLoadedFrom:e.testFilesLoadedFrom})}},setTestRunPriority:{value:function(){this._priority=a.testRunPriority}},setFileChangeRunPriority:{value:function(){this._priority=a.fileChangePriority}},setFullRunPriority:{value:function(){this._priority=a.fullRunPriority}},setManualRun:{value:function(){this._manualRun=!0}},getFullRunPriority:{value:function(){return a.fullRunPriority}},getPriority:{value:function(){return this._priority}},isFullRun:{value:function(){return this._priority===a.fullRunPriority}},isFileChangedRun:{value:function(){return this._priority===a.fileChangePriority}},isManualRun:{value:function(){return this._priority===a.testRunPriority||this._manualRun}},filesAdded:{value:function(){this._anyFilesAdded=!0}},filesDeleted:{value:function(){this._anyFilesDeleted=!0}},anyFilesAdded:{value:function(){return this.isFullRun()||this._anyFilesAdded}},anyFilesDeleted:{value:function(){return this._anyFilesDeleted}},mergeTask:{value:function(e){var t=this;t._priority=Math.max(t._priority,e._priority),_.each(e._filesAndAffectedTests,function(e,n){t._mergeAffectedTests(n,e)}),t._failingTests=_.extend({},e._failingTests,t._failingTests),t._tests=t._tests.concat(e._tests),t._anyFilesAdded=t._anyFilesAdded||e._anyFilesAdded,t._anyFilesDeleted=t._anyFilesDeleted||e._anyFilesDeleted}},_mergeAffectedTests:{value:function(e,t){var n=this,i=n._filesAndAffectedTests[e];i?(i.tests=i.tests?i.tests.concat(t.tests):t.tests,i.testFilesLoadedFrom=_.extend(i.testFilesLoadedFrom||{},t.testFilesLoadedFrom||{})):n._filesAndAffectedTests[e]=t}},failingTest:{value:function(e,t){var n=this._failingTests[e]=this._failingTests[e]||[];n.push(t)}},_getAllTests:{value:function(){var t=this,n=[],i=!1,s={},a={},r=0,o=0,l=0,c=0,u=0;if(_.each(t._filesAndAffectedTests,function(e){var o=e.file;e.tests=_.map(e.tests,function(e){var n=t._getTestFileId(e);return s[n]||(s[n]=1,r++),o.numberOfFunctionsChanged||o.lastChangeIsComplex||o.relatedFilesWithTests?[e[0]]:e}),o.test&&(i=!0),o.test&&o.lastSingleChangeTest&&!o.relatedFilesWithTests&&!t._project.hadGlobalErrorsPreviousRun()&&(e.tests=[[o.id,"?",o.lastSingleChangeTest]]),n=n.concat(e.tests),_.extend(a,e.testFilesLoadedFrom||{})}),_.each(t._tests,function(e){var n=t._getTestFileId(e);s[n]||(s[n]=1,o++)}),n=n.concat(t._tests),!n.length&&t._project._lastAffectedTestFileIds&&(n=n.concat(_.map(t._project._lastAffectedTestFileIds,function(e){return s[e]||(s[e]=1,l++),[e]}))),_.each(a,function(e,t){t=parseInt(t,10),s[t]||(s[t]=1,n.push([t]),c++)}),!(i&&1===_.size(t._filesAndAffectedTests)||t.isManualRun())){var h=[],d={};_.each(n,function(e){var n=t._getTestFileId(e);if(!d[n]){var i=t._failingTests[n];i&&(h=h.concat(i),s[n]=1,d[n]=1,u++)}}),n=n.concat(h)}return e("debug")("wallaby:testTask")("Test files from affected: %s, from deleted or manually requested: %s, from recently changed: %s, from loaded by: %s, from failing: %s",r,o,l,c,u),this._project.settings().runAllTestsInAffectedTestFile&&_.each(n,function(e){e&&(e.length=1)}),n}},testData:{value:function(){return this._getTestRunData()}},_getTestRunData:{value:function(){var e=this;if(!this.isFullRun()){var t=e._getAllTests();if(t){var n={},i={};return _.each(t,function(t){var s=n,a=e._getTestFileId(t);if(a){var r=e._project._structure.testFilesById[a];if(r&&(i[r.id]=r,1===t.length&&(n="*"),"*"!==n))for(var o=1,l=t.length;l>o;o++){var c=t[o],u=s[":"+c],h=o===l-1;if((!u||h)&&(u=s[":"+c]=h?"*":{}),"*"===u)break;s=u}}}),{files:i,names:n}}}}},_getTestFileId:{value:function(e){var t=e&&e[0];if(t)return _.isNumber(t)?t:(this._project._structure.filesByPath[t]||{}).id}}}),t}();t.exports={TestTask:r,runPriority:a}},{debug:void 0}],21:[function(e,t,n){!function(e){e.addEventListener&&(e.addEventListener("beforeunload",function(){throw new Error("One of your tests is trying to unload window object.")}),e.$_$reportUnhanledPromises&&e.addEventListener("unhandledrejection",function(e){if(e&&e.reason){var t=new Error;throw e.reason.stack&&(t.stack=e.reason.stack),t.message="Unhandled promise rejection: "+(e.reason.message||e.reason),t}}));var t,n=/%[sdj%]/g;"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(e){var t=Array.prototype.slice.call(arguments,1),n=this,i=function(){},s=function(){return n.apply(this instanceof i?this:e||{},t.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype||{},s.prototype=new i,s});var i=function(){var t=this;t._noOp=function(){},t._maxLogEntrySize=16384,t._undefined=e.undefined,t._setTimeout=e.setTimeout,t._Date=e.Date,t._Error=e.Error,t._JSONStringify=JSON.stringify,t._XMLHttpRequest=e.XMLHttpRequest,t._replacedConsoleLog=e.console.log=function(){t._suppressConsoleLog||t._doWhenReceiverIsReady(function(e){t._log.apply(t,e)},arguments)},e.console.warn=function(){t._doWhenReceiverIsReady(function(e){t._warn.apply(t,e)},arguments)},e.console.error=function(){t._doWhenReceiverIsReady(function(e){t._error.apply(t,e)},arguments)},e.console.dir=function(){t._doWhenReceiverIsReady(function(e){t._dir.apply(t,e)},arguments)},t._receiver=e.$_$receiver||new e.WebSocket("ws://127.0.0.1:"+e.$_$receiverPort),t._onReceiverReady=[function(){t._receiverReady=!0}],t._receiver.onopen=function(){for(var e=0,n=t._onReceiverReady.length;n>e;e++)t._onReceiverReady[e]()},t._receiver.onerror=function(e){throw new Error("Sandbox receiver error: "+e.message)},t.reset()};i.prototype={setGlobalErrorHandler:function(){var t=this;e.$_$reuseableTracer||(e.onerror=function(){t._globalBrowserError.apply(t,arguments)})},_globalBrowserError:function(){var e=this;e._doWhenReceiverIsReady(function(t){e._sendBrowserGlobalError.apply(e,t)},arguments)},reportDeclarationError:function(){var e=this;e._doWhenReceiverIsReady(function(t){e._sendDeclarationError.apply(e,t)},arguments)},initialSpecId:function(){return e.$_$initialSpecId},start:function(t){var n=this;if(t||!(n._delayStart||n._startRequested&&!e.$_$reuseableTracer))if(n.reset(),t)this._onStart=t,this._patchFrameworks();else{if(!this._onStart)throw new Error("Missing tracer start subscription");n._startRequested=!0,this._receiverReady?this._onStart():this._onReceiverReady.push(this._onStart);
}},isInitialized:function(){return!!e.$_$coverage},statement:function(n,i){e.$_$coverage[n][i][this._spec]=t++},scopeStart:function(e){this._fileEncounter[e]||(this._fileEncounterSequence.push(e),this._fileEncounter[e]=1)},programScopeStartLoading:function(e){this._testFileIds[e]&&this._resetFileData(),this.scopeStart(e)},programScopeEndLoading:function(e){this._testFileIds[e]&&(this._saveCurrentTestLoadingSequence(),this._resetFileData())},_saveCurrentTestLoadingSequence:function(){this._fileEncounterSequence.length&&this._testLoadingSequence.push(this._fileEncounterSequence.slice())},entryFile:function(){return this._fileEncounterSequence[0]},started:function(t){t=t||{},t.loadingSequence=this._testLoadingSequence.slice(),this._resetLoadingData(),this._resetFileData(),e.$_$wp=this._original_$_$wp,e.$_$wpe=this._original_$_$wpe,this._send("started",t)},specStart:function(e,t){var n=this;this._doWhenReceiverIsReady(function(){n._sendWithHighPriority("preTest","string"==typeof t?t:n._format(t))}),this._spec=e,this._resetFileData()},specSyncStart:function(){this._specRangeStart=t},specSyncEnd:function(){this._specRangeEnd=t-1},specEnd:function(e){var t=function(){return e.apply(this,arguments)};return t.toString=function(){return e.toString()},t}(function(){this._spec=0;var e=this._specRangeStart,n=this._specRangeEnd;return this._specRangeStart=0,this._specRangeEnd=0,[e,n||t]}),needToNotifySingleTestRun:function(){if(this._paused||this._onResumed||!this.hasSpecFilter()||e.$_$reuseableTracer)return!1;for(var t=e.$_$tests;"*"!==t;){var n=Object.keys(t);if(1!=n.length)return!1;t=t[n[0]]}return!0},notifySingleTestAfterEach:function(t){return this._paused||this._onResumed||e.$_$reuseableTracer?void t():(this._paused=!0,this._onResumed=t,void this._send("resume"))},resume:function(){this._paused&&(this._paused=!1,this._onResumed&&(this._onResumed(),delete this._onResumed))},paused:function(){return this._paused},hasSpecFilter:function(){return!!e.$_$tests&&"*"!==e.$_$tests},specFilter:function(t){var n=e.$_$tests[":?"];if(n&&n[":"+t[t.length-1]])return!0;for(var i=e.$_$tests,s=0,a=t.length;a>s;s++){var r=t[s];if(i=i[":"+r],!i)return!1;if("*"===i)return!0}return!1},complete:function(t){if(e.$_$coverage){var n,i;for(n=0,i=e.$_$coverage.length;i>n;n++){var a=e.$_$coverage[n];a&&a.length&&this._send("coverage",{id:n,ranges:a})}var r=Object.keys(s._autoTimeHits);for(n=0,i=r.length;i>n;n++){var o=s._autoTimeHits[r[n]];o.fileId&&this._sendLog("autoLog",o.value?this._formatTime(o.value)+"ms":"Σ "+this._formatTime(o.total)+"ms, μ "+this._formatTime(o.total/o.n)+"ms, ⋀ "+this._formatTime(o.min)+"ms, ⋁ "+this._formatTime(o.max)+"ms",o.context,o.fileId,o.rangeId)}this._send("complete",t),e.$_$reuseableTracer||this._receiver.close()}},_formatTime:function(e){return e.toFixed(3)},result:function(e){e.files=this._fileEncounterSequence,this._send("test",e)},_patchFrameworks:function(){var t=this;if(!t._patchedFrameworks){t._patchedFrameworks=!0;var n=e.requirejs&&"function"==typeof e.requirejs.load,i=e.System&&e.System.transpiler;if(t._shouldReportProgramScope=t._shouldReportProgramScope||n||i,n){var s=e.requirejs.load;e.requirejs.load=function(e,n,i){return s.call(this,e,n,t._urlWithFileData(i))}}if(i){var a=e.System.fetch;e.System.fetch=function(){var e=arguments[0]&&arguments[0].address;return e&&(arguments[0].address=t._urlWithFileData(e)),a.apply(this,arguments)};var r=e.fetch;r&&(e.fetch=function(){var e=arguments[0];return e&&(arguments[0]=t._urlWithFileData(e)),r.apply(this,arguments)});var o=e.System["import"];e.System["import"]=function(){var e=arguments[0];return e&&(arguments[0]=t._urlWithFileData(e)),o.apply(this,arguments)}}if(t._XMLHttpRequest){var l=t._XMLHttpRequest.prototype.open;t._XMLHttpRequest.prototype.open=function(e,n){arguments[1]=t._urlWithFileData(n),l.apply(this,arguments)}}t._Error&&!t._Error.captureStackTrace&&e.navigator&&e.navigator.userAgent&&/PhantomJS\/2/.test(e.navigator.userAgent)&&(t._Error.captureStackTrace=function(){})}},_urlWithFileData:function(e){var t=this;if(e&&~e.indexOf("wallabyFileId"))return e;for(var n=[],i=e.replace(/\\/g,"/").split("/"),s=0;s<i.length;s++)"."!==i[s]&&(".."===i[s]&&n.length&&".."!==n[n.length-1]?n.pop():n.push(i[s]));return e=n.join("/"),e=t._appendFileData(e)},_appendFileData:function(t){var n=this,i="/"===t.charAt(0)?t.substr(1):t,s=e.location&&e.location.host&&t.indexOf(e.location.host);s>=0&&(i=i.substr(s+e.location.host.length+1));var a=t.lastIndexOf("?");a>=0&&(i=i.substring(0,a));var r=i&&n._getFileMetadata(i);return r?t+(~a?"&":"?")+r.ts+"&wallabyFileId="+r.id:t},_getFileMetadata:function(t){return e.$_$files[t]||e.$_$files[t.split("\\").join("/")]},_doWhenReceiverIsReady:function(e,t){var n=this;n._receiverReady?e(t):n._onReceiverReady.push(function(){e(t)})},_log:function(){this._sendLog("log",this._format.apply(this,arguments))},_warn:function(){this._sendLog("warn",this._format.apply(this,arguments))},_error:function(){this._sendLog("error",this._format.apply(this,arguments))},_dir:function(e){this._sendLog("dir",this._inspect(e))},_debugLog:function(){this._sendLog("debugLog",this._format.apply(this,arguments))},_sendBrowserGlobalError:function(e,t,n){e=e&&e.toString()||"",t=t&&t.toString()||"",n=n&&n.toString()||"",this._send("globalError",{message:e,stack:e+"\nat "+t+":"+n})},_sendDeclarationError:function(e){this._send("globalError",{message:e.message,stack:e.stack,declaration:!0})},debugLog:function(){var e=this;e._doWhenReceiverIsReady(function(t){e._debugLog.apply(e,t)},arguments)},log:function(){var t=this;if(t._replacedConsoleLog!==e.console.log){for(var n=[],i=arguments.length-3,s=0;i>s;s++)n.push(arguments[s]);t._suppressConsoleLog=!0,e.console.log.apply(console,n),t._suppressConsoleLog=!1}t._doWhenReceiverIsReady(function(e){for(var n=[],i=e.length-3,s=0;i>s;s++)n.push(e[s]);t._sendLog("log",t._format.apply(t,n)||"",e[i],e[i+1],e[i+2])},arguments)},setAssertionData:function(e,t){try{var n=Object.prototype.toString.call(e.actual);e.showDiff===!0&&n==Object.prototype.toString.call(e.expected)&&void 0!==e.expected&&"[object Boolean]"!==n&&"[object Number]"!==n&&"[object Function]"!==n&&("string"!=typeof e.actual&&(e.actual=this._inspect(e.actual,5),e.expected=this._inspect(e.expected,5)),t.actual=e.actual,t.expected=e.expected),"UnexpectedError"===e.name&&e.getErrorMessage&&(t.formattedDiff=e.getErrorMessage("ansi").toString()),e.actual&&e.actual.stack&&"string"==typeof e.actual.stack&&(t.stack=t.stack||"",t.stack+="\nFrom actual error object:\n"+e.actual.stack)}catch(i){}return t},diff:function(e,t,n,i,s){var a=this;a._doWhenReceiverIsReady(function(){var r=a.setAssertionData({showDiff:!0,expected:e,actual:t},{});a._sendLog("diff","",n,i,s,r.expected,r.actual)},arguments)},_sendLog:function(e,t,n,i,s,a,r){var o=t?t.length:0;t&&o>this._maxLogEntrySize&&(t=t.slice(0,this._maxLogEntrySize)+"...\n(truncated, total length: "+o+")"),this._send("console",{type:e,text:t||"",spec:this._spec,file:i,range:s,context:n,expected:a,actual:r})},_send:function(e,t){this._receiver.send(this._JSONStringify(this._createMessage(e,t)))},_createMessage:function(t,n){return{type:t,data:n,session:e.$_$session}},_sendWithHighPriority:function(e,t){if(this._highPriorityReceiver){var n=this._createMessage(e,t);n._p="###wpm###",this._highPriorityReceiver.send(this._JSONStringify(n)+"\n")}else this._send(e,t)},_resetLoadingData:function(){this._testLoadingSequence=this._safeObject([])},_resetFileData:function(){this._fileEncounterSequence=this._safeObject([]),this._fileEncounter=this._safeObject([])},reset:function(){var e=this;t=1,e._formattingOpts={},e._autoConsoleHits={},e._autoTimeHits={},e._spec=0,e._specRangeStart=0,e._specRangeEnd=0,e._resetFileData()},_safeObject:function(e){return e.toJSON=this._undefined,e},_format:function(e){var t,i=this._formattingOpts.depth||2,s=this._formattingOpts.maxElementsPerLevel||5e3;if("string"!=typeof e){var a=[];for(t=0;t<arguments.length;t++)a.push(this._inspect(arguments[t],i,s));return a.join(" ")}t=1;for(var r=arguments,o=r.length,l=String(e).replace(n,function(e){if("%%"===e)return"%";if(t>=o)return e;switch(e){case"%s":return String(r[t++]);case"%d":return Number(r[t++]);case"%j":return JSON.stringify(r[t++]);default:return e}}),c=r[t];o>t;c=r[++t])l+=null===c||"object"!=typeof c?" "+c:" "+this._inspect(c,i,s);return l},_inspect:function(e,t,n){var i={seen:[],showHidden:!1,depth:t||2,stylize:function(e){return e},maxElementsPerLevel:n||5e3};return this._formatValue(i,e,i.depth)},_formatValue:function(e,t,n){var i=this,s=this._formatPrimitive(e,t);if(s)return s;var a=Object.keys(t),r=this._arrayToHash(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),0===a.length){if("function"==typeof t){var o=t.name?": "+t.name:"";return e.stylize("[λ"+o+"]","special")}if(this._isRegExp(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(this._isDate(t))return e.stylize(Date.prototype.toString.call(t),"date");if(this._isError(t))return this._formatError(t)}var l="",c=!1,u=!1,h=!1,d=["{","}"],f=t&&t.constructor&&t.constructor.name||void 0;if("Object"===f&&(f=void 0),this._isArray(t)?(f=void 0,c=!0,d=["[","]"]):this._isSet(t)?u=!0:this._isMap(t)&&(h=!0),"function"==typeof t){var _=t.name?": "+t.name:"";l=" [λ"+_+"]"}if(this._isRegExp(t)&&(l=" "+RegExp.prototype.toString.call(t)),this._isDate(t)&&(l=" "+Date.prototype.toUTCString.call(t)),this._isError(t)&&(l=" "+this._formatError(t)),""===l&&f&&(d[0]=f+" "+d[0]),c||!this._isIterator(t)||h||u||(l=" [Iterator] "),!(0!==a.length||c&&0!=t.length||u||h))return d[0]+l+d[1];if(0>n)return this._isRegExp(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var v,p=!1;return a.length>e.maxElementsPerLevel&&(a.length=e.maxElementsPerLevel,c&&t&&(t=t.slice(0,e.maxElementsPerLevel)),p=!0),v=c?this._formatArray(e,t,n,r,a):u?this._formatSet(e,t,n,r,a,p):h?this._formatMap(e,t,n,r,a,p):a.map(function(s){return i._formatProperty(e,t,n,r,s,c)}),p&&v.push("..."),e.seen.pop(),this._reduceToSingleString(v,l,d)},_isArray:function(e){return Array.isArray(e)||"object"==typeof e&&"[object Array]"===this._objectToString(e)},_isSet:function(t){return!!(t&&e.Set&&"[object Set]"===this._objectToString(t)&&t.forEach)},_isMap:function(t){return!!(t&&e.Map&&"[object Map]"===this._objectToString(t)&&t.forEach)},_isIterator:function(t){return!!(t&&e.Symbol&&e.Symbol.iterator&&"function"==typeof t[e.Symbol.iterator])},_isRegExp:function(e){return"object"==typeof e&&"[object RegExp]"===this._objectToString(e)},_isDate:function(e){return"object"==typeof e&&"[object Date]"===this._objectToString(e)},_isError:function(e){return"object"==typeof e&&("[object Error]"===this._objectToString(e)||e instanceof Error)},_objectToString:function(e){return Object.prototype.toString.call(e)},_reduceToSingleString:function(e,t,n){var i=0,s=e.reduce(function(e,t){return i++,t.indexOf("\n")>=0&&i++,e+t.length+1},0);return s>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]},_formatPrimitive:function(e,t){switch(typeof t){case"undefined":return e.stylize("undefined","undefined");case"string":var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string");case"number":return e.stylize(""+t,"number");case"boolean":return e.stylize(""+t,"boolean")}return null===t?e.stylize("null","null"):void 0},_formatError:function(e){return"["+Error.prototype.toString.call(e)+"]"},_formatSet:function(e,t,n,i,s,a){var r=this,o=[];t.forEach(function(t){if(!(o.length>e.maxElementsPerLevel)){var i=null===n?null:n-1,s=r._formatValue(e,t,i);o.push(s)}}),!a&&o.length>e.maxElementsPerLevel&&o.push("...");for(var l=0;l<s.length;l++)o.push(r._formatProperty(e,t,n,i,s[l],!1));return o},_formatMap:function(e,t,n,i,s,a){var r=this,o=[];t.forEach(function(t,i){if(!(o.length>e.maxElementsPerLevel)){var s=null===n?null:n-1,a=r._formatValue(e,i,s);a+=" => ",a+=r._formatValue(e,t,s),o.push(a)}}),!a&&o.length>e.maxElementsPerLevel&&o.push("...");for(var l=0;l<s.length;l++)o.push(r._formatProperty(e,t,n,i,s[l],!1));return o},_formatArray:function(e,t,n,i,s){for(var a=this,r=[],o=0,l=t.length;l>o;++o)this._hasOwnProperty(t,String(o))?r.push(this._formatProperty(e,t,n,i,String(o),!0)):r.push("");return s.forEach(function(s){s.match(/^\d+$/)||r.push(a._formatProperty(e,t,n,i,s,!0))}),r},_formatProperty:function(e,t,n,i,s,a){var r,o,l;if(l=Object.getOwnPropertyDescriptor(t,s)||{value:t[s]},l.get?o=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(o=e.stylize("[Setter]","special")),this._hasOwnProperty(i,s)||(r="["+s+"]"),o||(e.seen.indexOf(l.value)<0?(o=null===n?this._formatValue(e,l.value,null):this._formatValue(e,l.value,n-1),o.indexOf("\n")>-1&&(o=a?o.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+o.split("\n").map(function(e){return"   "+e}).join("\n"))):o=e.stylize("[Circular]","special")),"undefined"==typeof r){if(a&&s.match(/^\d+$/))return o;r=JSON.stringify(""+s),r.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(r=r.substr(1,r.length-2),r=e.stylize(r,"name")):(r=r.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),r=e.stylize(r,"string"))}return r+": "+o},_arrayToHash:function(e){var t={};return e.forEach(function(e){t[e]=!0}),t},_hasOwnProperty:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},initLoadingPhase:function(){var t=this;this._resetLoadingData(),delete this._loadingSequence,this._testFileIds=this._safeObject({}),(e.$_$testFiles||[]).forEach(function(e){t._testFileIds[e.id]=1}),t._original_$_$wp=e.$_$wp,t._original_$_$wpe=e.$_$wpe,e.$_$wp=function(e){t._reportProgramScope("programScopeStart",e),t.programScopeStartLoading(e)},e.$_$wpe=function(e){t._reportProgramScope("programScopeEnd",e),t.programScopeEndLoading(e)}},_reportProgramScope:function(e,t){var n=this;this._shouldReportProgramScope&&this._doWhenReceiverIsReady(function(){n._sendWithHighPriority(e,t)})}};var s=new i;s.setGlobalErrorHandler();var a=function(e,t){return t-e};e.performance?s._time=function(){return e.performance.now()}:e.process&&e.process.hrtime?(s._time=function(){return e.process.hrtime()},a=function(e,t){return 1e3*(t[0]-e[0])+(t[1]-e[1])/1e6}):s._time=function(){return+new Date},s._logTime=function(e,t,n,i,r,o,l){var c=a(r,l),u=s._autoTimeHits[n];return u?(u.value&&(u.n=1,u.min=u.value,u.max=u.value,u.total=u.value,delete u.value),u.min=Math.min(u.min,c),u.max=Math.max(u.max,c),u.total+=c,u.n+=1):s._autoTimeHits[n]={value:c,context:i,fileId:e,rangeId:t},o},e.$_$w=function(e,t){s.statement(e,t)},e.$_$wp=function(e){s._reportProgramScope("programScopeStart",e),s.scopeStart(e)},e.$_$wpe=function(e){s._reportProgramScope("programScopeEnd",e)},e.$_$wf=function(e){s.scopeStart(e)},e.$_$wv=function(e,t,n,i,a,r,o){return o&&s._autoConsoleHits[n]||(s._doWhenReceiverIsReady(function(){s._formattingOpts={maxElementsPerLevel:o?10:100},s._sendLog("autoLog",s._format("$_$ne"===r?a:r(a))||"",i,e,t),s._formattingOpts={}},arguments),s._autoConsoleHits[n]=1),a},e.$_$tracer=s,e.$_$coverage=e.$_$coverage||[];var r=function(e){return e.path},o=function(e){return e?e.replace(/\\/g,"/"):e},l=e.$_$testFiles&&(e.$_$testFiles||[]).map(r).map(o),c=e.$_$testFiles&&e.$_$testFiles.filter(function(e){return e.loaded}).map(r);s.initLoadingPhase(),e.wallaby={delayStart:function(){s._patchFrameworks(),s._delayStart=!0},start:function(){s._delayStart=!1,s.start()},_startWhenReceiverIsReady:function(e){s._shouldReportProgramScope=!0,s._doWhenReceiverIsReady(function(){e()})},tests:l,loadedTests:c,baseDir:e.$_$baseDir,slowTestThreshold:e.$_$slow||75}}(function(){return this}()||global)},{}],22:[function(e,t,n){"use strict";var i=function(){function e(e,t){for(var n in t){var i=t[n];i.configurable=!0,i.value&&(i.writable=!0)}Object.defineProperties(e,t)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},a=e("path"),r=e("node-uuid"),o=e("querystring"),l=e("http"),c={Atom:"AT",VSCode:"VSC",Sublime:"ST",IntelliJ:"IJ",VS:"VS"},u=function(){function e(t,n){if(s(this,e),t&&_.isString(n)){var i=t.client&&c[t.client];i&&t.edition&&(i=i+"-"+t.edition.toUpperCase());var o=t.cidFile;this._client=i||(~n.indexOf("wallaby-vscode")?"VSC":~n.indexOf(".wallaby")?"VS":~n.indexOf("atom-wallaby")?"AT":~n.indexOf("Sublime")?"ST":"IJ"),o||(o="VS"===this._client?a.join(n,"..","..","t.id"):"VSC"===this._client?a.join(n,"..","..","..",".wtid"):a.join(n,"..","t.id"));var l=void 0;try{l=t.readFileSync(o)}catch(u){l=r.v4();try{t.writeFileSync(o,l)}catch(h){}}this._cid=l||r.v4(),this._tid=process.env.quokka?"UA-58409118-5":"UA-58409118-3",this._sendHeartbeat=!0}}return i(e,{start:{value:function(){var e=this;this._heartbeatInterval=setInterval(function(){return e._heartbeat()},3e5),e._heartbeat()}},dispose:{value:function(){clearInterval(this._heartbeatInterval)}},busy:{value:function(){this._sendHeartbeat=!0}},_heartbeat:{value:function(){this._sendHeartbeat&&this._event("Heartbeat","Active",this._client),delete this._sendHeartbeat}},_event:{value:function(e,t,n){try{var i=o.stringify({v:1,tid:this._tid,cid:this._cid,t:"event",ec:e,ea:t,el:n}),s={hostname:"www.google-analytics.com",path:"/collect",method:"POST",headers:{"Content-Length":i.length}},a=l.request(s,function(e){e.on("data",_.noop),e.on("end",_.noop)});a.on("error",_.noop),a.write(i),a.end()}catch(r){}}}}),e}();t.exports=u},{http:void 0,"node-uuid":void 0,path:void 0,querystring:void 0}],23:[function(e,t,n){"use strict";var i,s=function(){function e(e,t){for(var n in t){var i=t[n];i.configurable=!0,i.value&&(i.writable=!0)}Object.defineProperties(e,t)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=e("./typeScriptVisitor"),o=e("semver"),l="1.5.3",c=function(){function e(t){a(this,e),this._opts=t||{},this._opts=_.extend({noLib:!0,noResolve:!0,removeComments:!0},t||{},{sourceMap:!0}),this._noRename=this._opts.noFileRename,delete this._opts.noFileRename,delete this._opts.forceFileLevelCompiler,this._visitor=new r(i)}return s(e,{run:{value:function(e){var t=this,n=e.content,s=e.path;this._code="",this._ranges=[];var a=i.createProgram([s],this._opts,{getSourceFile:function(e){var s=i.createSourceFile(e,n,t._opts.target);return t._ranges=t._visitor.visit(s),s},writeFile:function(e,n){t._code=n},useCaseSensitiveFileNames:function(){return!1},getCanonicalFileName:function(e){return e},getCurrentDirectory:function(){return""},getNewLine:function(){return"\n"}}),r=a.emit(),o=r.diagnostics;if(!o.length){var l=r.sourceMaps[0];if(!l)throw new Error("Cannot find the file source map. If it is a definition file, you may need to exclude it in your files list.");var c={version:3,file:l.sourceMapFile,sourceRoot:l.sourceMapSourceRoot,sources:l.sourceMapSources,names:l.sourceMapNames,mappings:l.sourceMapMappings};return t._noRename||e.changeExt("js"),{map:c,code:this._code,ranges:this._ranges}}throw new Error("Typescript compiler errors: "+_.reduce(o,function(e,t){return e+"\n"+t.messageText},""))}}}),e}();t.exports=function(t){return i=t.typescript?t.typescript:e("typescript"),o.valid(i.version)&&o.lt(i.version,l)?void console.error("TypeScript version for compiler must be >= "+l):(delete t.typescript,function(e){return new c(t).run(e)})}},{"./typeScriptVisitor":25,semver:void 0,typescript:void 0}],24:[function(e,t,n){"use strict";var i,s=function(){function e(e,t){for(var n in t){var i=t[n];i.configurable=!0,i.value&&(i.writable=!0)}Object.defineProperties(e,t)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=e("path"),o=e("graceful-fs"),l=e("minimatch"),c=e("semver"),u=e("./typeScriptVisitor"),h="1.5.3",d=function(){function t(e,n){a(this,t);var s=this;e=e||{},this._filePatterns=[],this._optionDeclarations=_.reduce(i.optionDeclarations,function(e,t){return e[t.name]=t,e},{}),this._localProjectDir=n,this._useTsconfigFile=!0,e.files?(this._opts=!1,_.each(e.files,function(e,t){s._filePatterns.push(t),e=e||{};var n=s._createOptions(e);s._opts||(s._opts=n)})):(this._filePatterns.push("**/*.ts?(x)"),this._opts=this._createOptions(e)),this._allTrackedFiles={},this._allFiles={},this._visitor=new u(i)}return s(t,{_createOptions:{value:function(e){return e&&(this._orderFilesByReferenceComments||(this._orderFilesByReferenceComments=e.orderFilesByReferenceComments),delete e.orderFilesByReferenceComments,this._useTsconfigFile&&(this._useTsconfigFile=e.tsconfig!==!1),delete e.tsconfig),_.extend({noLib:!0,noResolve:!0,declaration:!1,noEmit:!1,removeComments:!1},this._normaliseOptions(e)||{},{sourceMap:!0,inlineSourceMap:!1,inlineSources:!1,outDir:void 0,rootDir:void 0,mapRoot:void 0,noEmitOnError:!1,outFile:void 0})}},_normaliseOptions:{value:function(e){var t=this;if(e)return _.each(e,function(n,i){var s=t._optionDeclarations[i];s&&_.isObject(s.type)&&_.isString(n)&&(e[i]=_.isFunction(s.type.get)?s.type.get(n.toLowerCase()):s.type[n.toLowerCase()])}),e}},_mergeTsConfigOptions:{value:function(t,n){var s,a=r.join(this._localProjectDir,"tsconfig.json");try{s=i.parseJsonConfigFileContent?i.parseJsonConfigFileContent(i.parseConfigFileTextToJson(a,o.readFileSync(a).toString()).config,_.extend(i.createCompilerHost(i.getDefaultCompilerOptions()),{readDirectory:i.sys.readDirectory}),i.getDirectoryPath(i.normalizePath(a)),{},a).options:i.readConfigFile(a,function(e){return o.readFileSync(e).toString()}).config.compilerOptions}catch(l){n.debug("Error parsing tsconfig file "+a+"\n("+l.message+")");try{s=e(a).compilerOptions}catch(c){n.debug("Error reading tsconfig file from "+a+"\n("+c.message+")")}}return s?_.extend({},this._normaliseOptions(s)||{},t):t}},createPostprocessor:{value:function(){var e=this,t=this,n=function(n){var i=n.logger,s=t._filesToBeCompiled(n.affectedFiles);if(!t._compiler||n.anyFilesAdded||n.anyFilesDeleted)if(t._compiler?n.tsPostprocessorOnly||i.debug("TypeScript language service is being re-created because some tracked files were added or deleted"):i.debug("New TypeScript language service is required"),t._allTrackedFiles=t._filesToBeCompiled(n.allFiles,function(e){return t._allFiles[e.fullPath]=e}),t._compiler&&n.tsPostprocessorOnly)n.anyFilesDeleted&&(n.affectedFiles||[]).length===(n.allFiles||[]).length&&(s={});else{if(s=t._allTrackedFiles,_.isEmpty(s))return i.debug("TypeScript postprocessor will be removed because in %s project files none were found by patterns: %s",n.allFiles.length,t._filePatterns),Q.when({removePostprocessor:!0});i.debug("TypeScript compiler options module (before tsconfig.json): %s",(t._opts||{}).module),t._useTsconfigFile&&(t._opts=t._mergeTsConfigOptions(t._opts,i),i.debug("TypeScript compiler options module (after tsconfig.json): %s",(t._opts||{}).module)),t._compiler=t._createLanguageService(n.baseDir)}else _.each(s,function(e){var n=t._allTrackedFiles[e.fullPath];n&&(n.ts=e.ts)});var a=[];return _.each(s,function(s){if(t._orderFilesByReferenceComments&&t._dependencies){var o=t._dependencies.files[s.path];o&&o.hash!==t._getFileDependencies(s).hash&&delete t._dependencies}var l=t._compiler.getEmitOutput(s.fullPath),c=t._compiler.getSyntacticDiagnostics(s.fullPath);if(l.emitSkipped){var u=c.concat(t._compiler.getSemanticDiagnostics(s.fullPath));e._logErrors(i,u)}else c&&c.length&&e._logErrors(i,c);var h=t._visitor.visit(t._compiler.getSourceFile?t._compiler.getSourceFile(s.fullPath):t._compiler.getProgram().getSourceFile(s.fullPath)),d={};l.outputFiles.forEach(function(e){var t=r.extname(e.name);".map"===t?d.sourceMap=e.text:".js"===t||".jsx"===t?d.code=e.text:i.debug("Unexpected output file: %s",e.name)}),d.sourceMap&&a.push(n.createFile({path:_.isUndefined(t._opts.module)||t._opts.module?t._changeExtToJs(s.path):s.path+".compiled.js",original:s,content:d.code,sourceMap:JSON.parse(d.sourceMap),ranges:h,order:s.order,load:s.initialLoad}))}),t._orderFilesByReferenceComments&&!t._dependencies&&t._updateFileOrder(),Q.all(a)};return n.filePatterns=t._filePatterns,n.ts=!0,n}},_logErrors:{value:function(e,t){t.forEach(function(t){var n=i.flattenDiagnosticMessageText(t.messageText,"\n");if(t.file){var s=t.file.getLineAndCharacterOfPosition(t.start);e.error("Error "+t.file.fileName+" ("+(s.line+1)+","+(s.character+1)+"): "+n)}else e.error("Error: "+n)})}},_updateFileOrder:{value:function(){var e=this;e._dependencies={files:{},min:Number.POSITIVE_INFINITY},_.each(e._allTrackedFiles,function(t){return e._orderFilesByReferences(t,e._dependencies,{})});var t=e._dependencies.min;_.each(e._dependencies.files,function(e){e.file.test||e.file.setOrder(t++,!0)})}},_orderFilesByReferences:{value:function(e,t,n){var i=this;if(!n[e.path]&&(n[e.path]=!0,!t.files[e.path])){e.test||(t.min=Math.min(t.min,e.order));var s=i._getFileDependencies(e);_.each(s.items,function(e){return i._orderFilesByReferences(e,t,n)}),t.files[e.path]||(t.files[e.path]={hash:s.hash,file:e})}}},_getFileDependencies:{value:function(e){var t,n=this,s="";try{t=i.preProcessFile(e.getContentSync()).referencedFiles}catch(a){throw new Error("Failed to get file dependencies: "+a.stack)}var o,l,c,u=_(t).map(function(t){return n._allTrackedFiles[r.join(r.dirname(e.fullPath),t.fileName)]}).filter(function(e){return!_.isUndefined(e)}).map(function(e){return s+=e.path,e}).value(),h=0;if(s.length>0)for(o=0,c=s.length;c>o;o++)l=s.charCodeAt(o),h=(h<<5)-h+l,h|=0;return{items:u,hash:h}}},_changeExtToJs:{value:function(e){return e.substr(0,e.lastIndexOf(".")+1)+(this._filePatterns.length>1&&_.endsWith(e,".js")?"jsts":"js")}},_createLanguageService:{value:function(e){var t=this;return i.createLanguageService({getScriptFileNames:function(){return Object.keys(t._allTrackedFiles)},getScriptVersion:function(e){var n=t._allTrackedFiles[e];return n&&n.ts.toString()},getScriptSnapshot:function(e){var n=t._allFiles[e];return n&&i.ScriptSnapshot.fromString(n.getContentSync())},getCurrentDirectory:function(){return e},getCompilationSettings:function(){return t._opts},getDefaultLibFileName:function(e){return i.getDefaultLibFilePath(e)}},i.createDocumentRegistry())}},_filesToBeCompiled:{value:function(e,t){var n=this;return t=t||function(){},_.reduce(e,function(e,i){return _.find(n._filePatterns,function(e){return l(i.path,e)})&&(e[i.fullPath]=i),t(i),e},{})}}}),t}();t.exports=function(t){return function(n){if(n.typescript)i=n.typescript;else try{i=e(r.join(t,"node_modules","typescript"))}catch(s){i=e("typescript")}if(c.valid(i.version)&&c.lt(i.version,h))throw new Error("TypeScript version for compiler must be >= "+h);return delete n.typescript,new d(n,t).createPostprocessor()}}},{"./typeScriptVisitor":25,"graceful-fs":void 0,minimatch:void 0,path:void 0,semver:void 0,typescript:void 0}],25:[function(e,t,n){"use strict";var i=function(){function e(e,t){for(var n in t){var i=t[n];i.configurable=!0,i.value&&(i.writable=!0)}Object.defineProperties(e,t)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},a=function(){function e(t){s(this,e);var n=this,i={};this._ts=t,i[t.SyntaxKind.DoStatement]=i[t.SyntaxKind.WhileStatement]=i[t.SyntaxKind.IfStatement]=i[t.SyntaxKind.SwitchStatement]=function(e){e.expression&&n._pushRange(e.expression)},i[t.SyntaxKind.ForStatement]=function(e){e.condition&&n._pushRange(e.condition)},i[t.SyntaxKind.ForInStatement]=i[t.SyntaxKind.ForOfStatement]=function(e){e.expression&&n._pushRange(e.expression)},i[t.SyntaxKind.BreakStatement]=i[t.SyntaxKind.ContinueStatement]=i[t.SyntaxKind.ThrowStatement]=function(e){n._pushRange(e)},i[t.SyntaxKind.VariableStatement]=function(e){(!n._parent||n._parent.kind!==t.SyntaxKind.ForStatement&&n._parent.kind!==t.SyntaxKind.ForInStatement&&n._parent.kind!==t.SyntaxKind.ExportAssignment)&&n._pushRange(e)},i[t.SyntaxKind.ExpressionStatement]=i[t.SyntaxKind.ReturnStatement]=function(e){n._pushRange(e)},i[t.SyntaxKind.ConditionalExpression]=function(e){n._pushRange(e.whenTrue),n._pushRange(e.whenFalse)},i[t.SyntaxKind.BinaryExpression]=function(e){n._pushRange(e.left),n._pushRange(e.right)},i[t.SyntaxKind.ArrowFunction]=function(e){e.body.statements||n._pushRange(e.body)},n._visit=function(e){var s=i[e.kind];s&&s(e),n._parent=e,t.forEachChild(e,n._visit)}}return i(e,{visit:{value:function(e){var t=this;return t._ranges=[],t._parent=null,t._sourceFile=e,t._visit(e),t._parent=null,t._sourceFile=null,t._ranges.slice()}},_pushRange:{value:function(e){this._ranges.push(this._getRange(e))}},_getRange:{value:function(e){var t=this._ts.getLineAndCharacterOfPosition(this._sourceFile,e.getStart(this._sourceFile)),n=this._ts.getLineAndCharacterOfPosition(this._sourceFile,e.getEnd());return[t.line+1,t.character,n.line+1,n.character]}}}),e}();t.exports=a},{}],26:[function(e,t,n){t.exports={randomId:function(){return Math.random().toString(36).substr(2,5)},noopTrue:function(){return!0},noopTruePromise:function(){return Q.fcall(this.noopTrue)},isPatch:function(e){return e&&e.length>2&&"@"===e[0]&&"@"===e[1]},textIndexPosition:function(e,t){var n=this.textLines(e,t);return{line:n.length,column:n[n.length-1].length}},textLines:function(e,t){return e=_.isUndefined(t)?e:e.substr(0,t),e.split(/\r\n|\r|\n/)},verifyLocalOrigin:function(t,n){if(!t)return!0;var i=!1;try{var s=e("url").parse(t).hostname;i="localhost"===s||"0.0.0.0"===s||"127.0.0.1"===s||"::1"===s}catch(a){}return i||n||console.error("wallaby.js refused to accept connection from "+t),i}}},{url:void 0}],27:[function(e,t,n){t.exports={name:"Wallaby.js",version:"1.0.444",author:"Wallaby.js",license:"Proprietary",homepage:"http://wallabyjs.com",dependencies:{acorn:"4.0.3","acorn-jsx":"3.0.1",chokidar:"1.0.3","coffee-script":"1.10.0",commander:"2.5.0",debug:"2.1.0","escodegen-wallaby":"1.6.11",express:"4.11.2","fs-extra":"0.12.0","graceful-fs":"4.1.3",lodash:"3.0.0","lru-cache":"2.5.0",minimatch:"2.0.1","node-uuid":"1.4.3",phantom:"0.7.2",q:"1.0.1",semver:"4.3.3","source-map":"0.4.3",typescript:"2.1.5","underscore.string":"2.3.3",ws:"1.1.1"},devDependencies:{"browserify-transform-tools":"1.5.0",escodegen:"1.6.1","expect.js":"0.3.1",grunt:"*","grunt-babel":"4.0.0","grunt-browserify":"*","grunt-bump":"0.0.16","grunt-contrib-clean":"*","grunt-contrib-compress":"0.12.0","grunt-contrib-copy":"*","grunt-contrib-uglify":"*"},"private":!0}},{}],28:[function(e,t,n){var i,s,a,r=e("path"),o=function(t,n){var i=e("module").Module,s=i.prototype,a=i._nodeModulePaths,r=s.require;i._nodeModulePaths=function(e){var n=a.call(this,e);return t(n,e,a,this),n},n&&(s.require=function(e){return r.call(this,n(e))})};try{Error.stackTraceLimit=50}catch(l){}if(process.env&&process.env.NODE_MODULES_OVERRIDE&&(console.warn(" ---- Using node modules from: "+process.env.NODE_MODULES_OVERRIDE+" ---- "),o(function(e){e.unshift(process.env.NODE_MODULES_OVERRIDE)})),"worker"!==process.argv[2]&&"runner"!==process.argv[2]){process.noDeprecation=!0,i=e("graceful-fs");var c=e("fs-extra"),u=e("./lib/app"),h=e("commander"),d=!1;h.unknownOption=function(){},h.option("-p, --port <port>","specify port").option("-l, --projectCachePath <projectCachePath>","specify project cache location").option("-l, --configPath <configPath>","specify config file location").option("-r, --phantomjs <phantomjs>","specify phantomjs location").option("-k, --lkp [lkp]","specify lkp location").option("-c, --client [client]","specify client").option("-q, --quokka [quokka]","specify quokka").option("-q, --editorTypeScript [editorTypeScript]","specify editorTypeScript").parse(process.argv);var f={port:47878,location:r.join(__dirname,"lib","project")};if(h.port&&(f.port=h.port),h.projectCachePath&&(f.projectCachePath=h.projectCachePath),h.configPath&&(f.configPath=h.configPath),h.phantomjs&&(f.phantomjs=h.phantomjs),h.editorTypeScript&&(f.editorTypeScript=h.editorTypeScript),
d=h.quokka,d&&(process.env.quokka=!0),f.runnerResolver=function(t,n){return e("browser"===t?"electron"===n?"./lib/electronRunner.js":"./lib/phantomRunner.js":"./lib/nodeRunner.js")},f.processorPool=e("./lib/processPool"),f.fileStructureCachePromise=function(e){return Q.nfcall(i.readFile,e).then(function(e){return Q.when(JSON.parse(e))})},f.fileStatPromise=function(e){return Q.nfcall(i.stat,e)},f.readFilePromise=function(e){return Q.nfcall(i.readFile,e)},f.writeFilePromise=function(e,t){return Q.nfcall(i.writeFile,e,t)},f.unlinkFilePromise=function(e){return Q.nfcall(i.unlink,e)},f.unlinkFileSync=function(e){return i.unlinkSync(e)},f.writeFileSync=function(e,t){return i.writeFileSync(e,t)},f.readFileSync=function(e){return i.readFileSync(e).toString("utf8")},f.fileExistsSync=function(e){return i.existsSync(e)},f.realpathSync=function(e){return i.realpathSync(e)},f.dirRemovePromise=function(e){return Q.nfcall(c.remove,e)},f.dirRemoveSync=function(e){return c.removeSync(e)},f.dirEnsurePromise=function(e){return Q.nfcall(c.ensureDir,e)},f.dirEnsureSync=function(e){return c.ensureDirSync(e)},d){var v={},p=function(e){return!(!e||!~e.indexOf("quokka_fake_path")&&!~e.indexOf(r.join(process.cwd(),d.substr(0,d.lastIndexOf(".")))))};f.fileStructureCachePromise=function(e){return f.readFilePromise(e).then(function(e){return Q.when(JSON.parse(e))})};var g=f.fileStatPromise;f.fileStatPromise=function(e){return p(e)?v[e]?Q.when({}):Q.reject(new Error("File "+e+" not found")):g(e)};var m=f.readFilePromise;f.readFilePromise=function(e){if(p(e)){var t=v[e];return t?Q.when(t.content):Q.reject(new Error("File "+e+" not found"))}return m(e)};var y=f.writeFilePromise;f.writeFilePromise=function(e,t){return p(e)?(v[e]={content:t},Q.when(!0)):y(e,t)};var T=f.unlinkFilePromise;f.unlinkFilePromise=function(e){return p(e)?(delete v[e],Q.when(!0)):T(e)};var b=f.unlinkFileSync;f.unlinkFileSync=function(e){return p(e)?void delete v[e]:b(e)};var R=f.writeFileSync;f.writeFileSync=function(e,t){return p(e)?void(v[e]={content:t}):R(e,t)};var V=f.readFileSync;f.readFileSync=function(e){if(p(e)){var t=v[e];if(!t)throw new Error("File "+e+" not found");return t.content}return V(e)};var F=f.fileExistsSync;f.fileExistsSync=function(e){return p(e)?!!v[e]:F(e)};var k=f.realpathSync;f.realpathSync=function(e){return p(e)?e:k(e)};var N=f.dirRemovePromise;f.dirRemovePromise=function(e){return p(e)?Q.when(e):N(e)};var j=f.dirRemoveSync;f.dirRemoveSync=function(e){return p(e)?e:j(e)};var w=f.dirEnsurePromise;f.dirEnsurePromise=function(e){return p(e)?Q.when(e):w(e)};var U=f.dirEnsureSync;f.dirEnsureSync=function(e){return p(e)?e:U(e)}}f.nodeModulesLookup=o,f.onStart=_.noop,f.onConnected=_.noop;var E=e("phantom/receiver");if(f._init=E.create,f.coreVersion=e("./package.json").version,"extended-core"===process.argv[2]||"extended-core-ws"===process.argv[2]||d)if("extended-core"!==process.argv[2]){f.quokka=d,f.client=h.client||"Sublime",f.lkp=h.lkp,f.Receiver=E.create();var Z=e("ws").Server,x=new Z({port:f.port,verifyClient:function(e){return _.verifyLocalOrigin(e.origin)}},function(){console.log(f.quokka?"quokka.js started":"wallaby.js started")});x.on("connection",function(t){var n={send:function(e){t.send(JSON.stringify(e))},receive:_.noop};f.onConnected(n),t.on("message",function(e){var t=JSON.parse(e);n.receive(t),"stop"===t.type&&process.exit()}),n.send({type:"started",version:e("./package.json").version})})}else{f.client=h.client||"Atom",f.lkp=h.lkp;e("util");f.Receiver=E.create(),process.nextTick(function(){var e={send:function(e){process.send(e)},receive:_.noop};process.on("message",function(t){if("connection"===t.type)f.onConnected(e);else try{e.receive(t)}finally{"stop"===t.type&&process.exit()}}),e.send({type:"started",version:f.coreVersion})})}else{f.Receiver=e("./lib/project");var M=e("ws").Server,S=new M({port:f.port,verifyClient:function(e){return _.verifyLocalOrigin(e.origin)}},function(){console.log("wallaby.js started"),console.log("core v"+f.coreVersion)});S.on("connection",function(e){var t={send:function(t){e.send(JSON.stringify(t))},receive:_.noop};f.onConnected(t),e.on("message",function(e){t.receive(JSON.parse(e))})})}u.start(f)}else if("runner"!==process.argv[2])process.noDeprecation=!0,e("./lib/global"),process.on("message",function(t){if(t&&"exit"===t.type)return void process.exit(0);if("instrumentor"===t.type){var n=e("./lib/instrumentor");try{var i=n(t.content,t.opts);process.send(i)}catch(s){process.send({error:{message:s&&s.message,stack:s&&s.stack}})}}else if("preprocessor"===t.type||"compiler"===t.type){var a=e("./lib/processor");try{a(t).fail(function(e){process.send({error:{message:e&&e.message,stack:e&&e.stack}})}).then(function(e){process.send(e)})}catch(s){process.send({error:{message:s&&s.message,stack:s&&s.stack}})}}}),process.send("READY");else{if(s=process.argv[7],s&&!process.env.quokka){i=e("fs");var W=process.cwd(),C=r.dirname(s);a=r.join(W,"node_modules"),o(function(e,t,n,i){var a=!1;e&&e[0]&&0===e[0].indexOf(W)&&(a=!0,Array.prototype.splice.apply(e,[0,e.length].concat(n.call(i,t.replace(W,C)).concat(e)))),a||e.push(s)},function(e){var t=e.replace(a,s);return t===e||i.existsSync(t)?t:e})}e("./lib/nodeTestWorker")(process.argv[3],process.argv[4],process.argv[5],process.argv[6],s)}},{"./lib/app":2,"./lib/electronRunner.js":8,"./lib/global":10,"./lib/instrumentor":11,"./lib/nodeRunner.js":12,"./lib/nodeTestWorker":13,"./lib/phantomRunner.js":14,"./lib/processPool":16,"./lib/processor":17,"./lib/project":18,"./package.json":27,commander:void 0,fs:void 0,"fs-extra":void 0,"graceful-fs":void 0,module:void 0,path:void 0,"phantom/receiver":void 0,util:void 0,ws:void 0}]},{},[28]);